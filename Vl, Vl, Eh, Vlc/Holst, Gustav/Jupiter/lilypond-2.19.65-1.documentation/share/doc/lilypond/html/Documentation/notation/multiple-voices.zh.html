<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Copyright C 1998-2015 by the authors.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.1
or any later version published by the Free Software Foundation;
with no Invariant Sections.
A copy of the license is included in the section entitled "GNU
Free Documentation License".

 -->
<!-- Created on August 6, 2017 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>LilyPond Notation Reference: 1.5.2 Multiple voices</title>

<meta name="description" content="LilyPond Notation Reference: 1.5.2 Multiple voices">
<meta name="keywords" content="LilyPond Notation Reference: 1.5.2 Multiple voices">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.zh.html#index" rel="start" title="LilyPond &mdash; Notation Reference">
<link href="lilypond-command-index.zh.html#lilypond-command-index" rel="index" title="D. LilyPond command index">
<link href="index_toc.zh.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="index_abt.zh.html#SEC_About" rel="help" title="About This Document">
<link href="simultaneous-notes.zh.html#simultaneous-notes" rel="up" title="1.5 Simultaneous notes">
<link href="lilypond-index.zh.html#lilypond-index" rel="next" title="E. LilyPond index">
<link href="single-voice.zh.html#single-voice" rel="previous" title="1.5.1 Single voice">
<link rel="stylesheet" type="text/css" title="Default style" href="../../Documentation/css/lilypond-manuals.css">
<!--[if lte IE 7]>
<link href="../../Documentation/css/lilypond-manuals-ie-fixes.css" rel="stylesheet" type="text/css">
<![endif]-->


</head>

<body lang="en" class="notation devStatus">


<div id="main">
<a name="Multiple-voices"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="musical-notation.zh.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Musical notation&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.zh.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.zh.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-command-index.zh.html" title="Index" rel="index">Index</a>][<a href="index_abt.zh.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="specialist-notation.zh.html" title="Next chapter">&nbsp;Specialist notation &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="single-voice.zh.html#clusters" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Clusters&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="simultaneous-notes.zh.html" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Simultaneous notes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#single_002dstaff-polyphony" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Single-staff polyphony &gt; </a>]</td></tr></table>
<a name="multiple-voices"></a>
<h3 class="subsection">1.5.2 Multiple voices</h3>

<p>This section discusses simultaneous notes in multiple voices or
multiple staves.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#single_002dstaff-polyphony" accesskey="1">Single-staff polyphony</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#voice-styles" accesskey="2">Voice styles</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#collision-resolution" accesskey="3">Collision resolution</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#merging-rests" accesskey="4">Merging rests</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#automatic-part-combining" accesskey="5">Automatic part combining</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#writing-music-in-parallel" accesskey="6">Writing music in parallel</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Single_002dstaff-polyphony"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="musical-notation.zh.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Musical notation&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.zh.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.zh.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-command-index.zh.html" title="Index" rel="index">Index</a>][<a href="index_abt.zh.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="specialist-notation.zh.html" title="Next chapter">&nbsp;Specialist notation &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#multiple-voices" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Multiple voices&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#multiple-voices" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Multiple voices&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#voice-styles" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Voice styles &gt; </a>]</td></tr></table>
<a name="single_002dstaff-polyphony"></a>
<h4 class="unnumberedsubsubsec">Single-staff polyphony</h4>

<a name="index-single_002dstaff-polyphony"></a>
<a name="index-polyphony_002c-single_002dstaff"></a>
<a name="index-voice-4"></a>
<a name="index-lyrics-assigned-to-one-voice"></a>

<a name="index-_005cvoiceOne"></a>
<a name="index-_005cvoiceOne-1"></a>
<a name="index-_005cvoiceOne-_002e_002e_002e-_005cvoiceFour"></a>
<a name="index-_005cvoiceOne-_002e_002e_002e-_005cvoiceFour-1"></a>
<a name="index-Voice-2"></a>
<a name="index-Voice-3"></a>
<a name="index-_005coneVoice"></a>
<a name="index-_005coneVoice-1"></a>

<a name="-Explicitly-instantiating-voices"></a>
<h4 class="subsubheading"><i> Explicitly instantiating voices</i></h4>

<p>The basic structure needed to achieve multiple independent
voices in a single staff is illustrated in the following example:
</p>
<blockquote><pre class="verbatim">\new Staff &lt;&lt;
  \new Voice = &quot;first&quot;
    \relative { \voiceOne r8 r16 g'' e8. f16 g8[ c,] f e16 d }
  \new Voice= &quot;second&quot;
    \relative { \voiceTwo d''16 c d8~ 16 b c8~ 16 b c8~ 16 b8. }
&gt;&gt;
</pre><p>
 <a href="../87/lily-a6949c64.ly">
  <img align="middle"
       border="0"
       src="../87/lily-a6949c64.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Here, voices are instantiated explicitly and are given names.  The
<code>\voiceOne</code> &hellip; <code>\voiceFour</code> commands set up the voices
so that first and third voices get stems up, second and fourth
voices get stems down, third and fourth voice note heads are
horizontally shifted, and rests in the respective voices are
automatically moved to avoid collisions.  The <code>\oneVoice</code>
command returns all the voice settings to the neutral default
directions.
</p>
<a name="-Temporary-polyphonic-passages"></a>
<h4 class="subsubheading"><i> Temporary polyphonic passages</i></h4>

<p>A temporary polyphonic passage can be created with the following
construct:
</p>
<blockquote><pre class="example">&lt;&lt; { \voiceOne &hellip; }
  \new Voice { \voiceTwo &hellip; }
&gt;&gt; \oneVoice
</pre></blockquote>

<p>Here, the first expression within a temporary polyphonic passage is
placed into the <code>Voice</code> context which was in use immediately
before the polyphonic passage, and that same <code>Voice</code> context
continues after the temporary section.  Other expressions within
the angle brackets are assigned to distinct temporary voices.
This allows lyrics to be assigned to one continuing voice before,
during and after a polyphonic section:
</p>
<blockquote><pre class="verbatim">\relative &lt;&lt;
  \new Voice = &quot;melody&quot; {
    a'4
    &lt;&lt;
      {
        \voiceOne
        g f
      }
      \new Voice {
        \voiceTwo
        d2
      }
    &gt;&gt;
    \oneVoice
    e4
  }
  \new Lyrics \lyricsto &quot;melody&quot; {
  This is my song.
  }
&gt;&gt;
</pre><p>
 <a href="../ca/lily-057f9e47.ly">
  <img align="middle"
       border="0"
       src="../ca/lily-057f9e47.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Here, the <code>\voiceOne</code> and <code>\voiceTwo</code> commands are
required to define the settings of each voice.
</p>
<a name="-The-double-backslash-construct"></a>
<h4 class="subsubheading"><i> The double backslash construct</i></h4>

<p>The <code>&lt;&lt; {&hellip;} \\ {&hellip;} &gt;&gt;</code> construct, where the two (or
more) expressions are separated by double backslashes, behaves
differently to the similar construct without the double backslashes:
<em>all</em> the expressions within this construct are assigned
to new <code>Voice</code> contexts.  These new <code>Voice</code> contexts
are created implicitly and are given the fixed names <code>&quot;1&quot;</code>,
<code>&quot;2&quot;</code>, etc.
</p>
<p>The first example could be typeset as follows:
</p>
<blockquote><pre class="verbatim">&lt;&lt;
  \relative { r8 r16 g'' e8. f16 g8[ c,] f e16 d }
  \\
  \relative { d''16 c d8~ 16 b c8~ 16 b c8~ 16 b8. }
&gt;&gt;
</pre><p>
 <a href="../ac/lily-939bd245.ly">
  <img align="middle"
       border="0"
       src="../ac/lily-939bd245.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>This syntax can be used where it does not matter that temporary
voices are created and then discarded.  These implicitly created
voices are given the settings equivalent to the effect of the
<code>\voiceOne</code> &hellip; <code>\voiceFour</code> commands, in the order in
which they appear in the code.
</p>
<p>In the following example, the intermediate voice has stems up,
therefore we enter it in the third place, so it becomes voice
three, which has the stems up as desired.  Spacer rests are
used to avoid printing doubled rests.
</p>
<blockquote><pre class="verbatim">&lt;&lt;
  \relative { r8 g'' g  g g f16 ees f8 d }
  \\
  \relative { ees'8 r ees r d r d r }
  \\
  \relative { d''8 s c s bes s a s }
&gt;&gt;
</pre><p>
 <a href="../86/lily-cf0f8966.ly">
  <img align="middle"
       border="0"
       src="../86/lily-cf0f8966.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>In all but the simplest works it is advisable to create explicit
<code>Voice</code> contexts as explained in <a name="index-Contexts-and-engravers"></a>
<a href="../learning/contexts-and-engravers.zh.html">Contexts and engravers</a> and
<a name="index-Explicitly-instantiating-voices"></a>
<a href="../learning/explicitly-instantiating-voices.zh.html">Explicitly instantiating voices</a>.
</p>
<a name="-Voice-order"></a>
<h4 class="subsubheading"><i> Voice order</i></h4>

<p>When entering multiple voices in the input file, use the following
order:
</p>
<blockquote><pre class="example">Voice 1: highest
Voice 2: lowest
Voice 3: second highest
Voice 4: second lowest
Voice 5: third highest
Voice 6: third lowest
etc.
</pre></blockquote>

<p>Though this may seem counterintuitive, it simplifies the automatic
layout process.  Note that the odd-numbered voices are given
upstems, and the even-numbered voices are given downstems:
</p>
<blockquote><pre class="verbatim">\new Staff &lt;&lt;
  \time 2/4
  { f''2 }  % 1: highest
  \\
  { c'2  }  % 2: lowest
  \\
  { d''2 }  % 3: second-highest
  \\
  { e'2  }  % 4: second-lowest
  \\
  { b'2  }  % 5: third-highest
  \\
  { g'2  }  % 6: third-lowest
&gt;&gt;
</pre><p>
 <a href="../c6/lily-5f695672.ly">
  <img align="middle"
       border="0"
       src="../c6/lily-5f695672.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<a name="index-_005cvoices"></a>
<a name="index-_005cvoices-1"></a>
<p>When a different voice entry order is desired, the command
<code>\voices</code> may be convenient:
</p>
<blockquote><pre class="verbatim">\new Staff \voices 1,3,5,6,4,2 &lt;&lt;
  \time 2/4
  { f''2 }  % 1: highest
  \\
  { d''2 }  % 3: second-highest
  \\
  { b'2  }  % 5: third-highest
  \\
  { g'2  }  % 6: third-lowest
  \\
  { e'2  }  % 4: second-lowest
  \\
  { c'2  }  % 2: lowest
&gt;&gt;
</pre><p>
 <a href="../47/lily-e3d4cc7f.ly">
  <img align="middle"
       border="0"
       src="../47/lily-e3d4cc7f.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>




<div class="warning"><p><strong>Note:</strong> Lyrics and spanners (such as slurs, ties, hairpins, etc.) cannot
be created &lsquo;across&rsquo; voices.
</p>
</div>
<a name="-Identical-rhythms"></a>
<h4 class="subsubheading"><i> Identical rhythms</i></h4>

<p>In the special case that we want to typeset parallel pieces of music
that have the same rhythm, we can combine them into a single
<code>Voice</code> context, thus forming chords.  To achieve this, enclose
them in a simple simultaneous music construct within an explicit voice:
</p>
<blockquote><pre class="verbatim">\new Voice &lt;&lt;
  \relative { e''4 f8 d e16 f g8 d4 }
  \relative { c''4 d8 b c16 d e8 b4 }
&gt;&gt;
</pre><p>
 <a href="../db/lily-203dc579.ly">
  <img align="middle"
       border="0"
       src="../db/lily-203dc579.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>This method leads to strange beamings and warnings if the pieces of
music do not have the same rhythm.
</p>

<a name="Predefined-commands-8"></a>
<h4 class="subsubheading">Predefined commands</h4>
<p><code>\voiceOne</code>,
<code>\voiceTwo</code>,
<code>\voiceThree</code>,
<code>\voiceFour</code>,
<code>\oneVoice</code>.
</p>
<a name="See-also-15"></a>
<h4 class="subsubheading">See also</h4>
<p>Learning Manual:
<a name="index-Voices-contain-music"></a>
<a href="../learning/voices-contain-music.zh.html">Voices contain music</a>,
<a name="index-Explicitly-instantiating-voices-1"></a>
<a href="../learning/explicitly-instantiating-voices.zh.html">Explicitly instantiating voices</a>.
</p>
<p>Notation Reference:
<a href="common-notation-for-percussion.zh.html#percussion-staves">Percussion staves</a>,
<a href="writing-rests.zh.html#invisible-rests">Invisible rests</a>,
<a href="inside-the-staff.zh.html#stems">Stems</a>.
</p>
<p>Snippets:
<a href="../snippets/simultaneous-notes.zh.html">Simultaneous notes</a>.
</p>

<hr size="6">
<a name="Voice-styles"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="musical-notation.zh.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Musical notation&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.zh.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.zh.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-command-index.zh.html" title="Index" rel="index">Index</a>][<a href="index_abt.zh.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="specialist-notation.zh.html" title="Next chapter">&nbsp;Specialist notation &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#single_002dstaff-polyphony" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Single-staff polyphony&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#multiple-voices" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Multiple voices&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#collision-resolution" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Collision resolution &gt; </a>]</td></tr></table>
<a name="voice-styles"></a>
<h4 class="unnumberedsubsubsec">Voice styles</h4>

<a name="index-voice-styles"></a>
<a name="index-styles_002c-voice"></a>
<a name="index-coloring-voices"></a>
<a name="index-_005cvoiceOneStyle"></a>
<a name="index-_005cvoiceOneStyle-1"></a>
<a name="index-_005cvoiceTwoStyle"></a>
<a name="index-_005cvoiceTwoStyle-1"></a>
<a name="index-_005cvoiceThreeStyle"></a>
<a name="index-_005cvoiceThreeStyle-1"></a>
<a name="index-_005cvoiceFourStyle"></a>
<a name="index-_005cvoiceFourStyle-1"></a>
<a name="index-_005cvoiceNeutralStyle"></a>
<a name="index-_005cvoiceNeutralStyle-1"></a>

<p>Voices may be given distinct colors and shapes, allowing them to be
easily identified:
</p>
<blockquote><pre class="verbatim">&lt;&lt;
  \relative { \voiceOneStyle d''4 c2 b4 }
  \\
  \relative { \voiceTwoStyle e'2 e }
  \\
  \relative { \voiceThreeStyle b2. c4 }
  \\
  \relative { \voiceFourStyle g'2 g }
&gt;&gt;
</pre><p>
 <a href="../8b/lily-e0e6eeb9.ly">
  <img align="middle"
       border="0"
       src="../8b/lily-e0e6eeb9.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>The <code>\voiceNeutralStyle</code> command is used to revert to the
standard presentation.
</p>

<a name="Predefined-commands-32"></a>
<h4 class="subsubheading">Predefined commands</h4>
<p><code>\voiceOneStyle</code>,
<code>\voiceTwoStyle</code>,
<code>\voiceThreeStyle</code>,
<code>\voiceFourStyle</code>,
<code>\voiceNeutralStyle</code>.
</p>
<a name="See-also-130"></a>
<h4 class="subsubheading">See also</h4>
<p>Learning Manual:
<a name="index-I_0027m-hearing-Voices"></a>
<a href="../learning/i_0027m-hearing-voices.zh.html">I'm hearing Voices</a>,
<a name="index-Other-sources-of-information"></a>
<a href="../learning/other-sources-of-information.zh.html">Other sources of information</a>.
</p>
<p>Snippets:
<a href="../snippets/simultaneous-notes.zh.html">Simultaneous notes</a>.
</p>

<hr size="6">
<a name="Collision-resolution"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="musical-notation.zh.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Musical notation&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.zh.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.zh.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-command-index.zh.html" title="Index" rel="index">Index</a>][<a href="index_abt.zh.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="specialist-notation.zh.html" title="Next chapter">&nbsp;Specialist notation &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#voice-styles" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Voice styles&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#multiple-voices" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Multiple voices&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#merging-rests" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Merging rests &gt; </a>]</td></tr></table>
<a name="collision-resolution"></a>
<h4 class="unnumberedsubsubsec">Collision resolution</h4>

<a name="index-merging-notes"></a>
<a name="index-note-collisions"></a>
<a name="index-collisions"></a>
<a name="index-shift-note"></a>
<a name="index-multiple-voices"></a>
<a name="index-voices_002c-multiple"></a>
<a name="index-polyphonic-music"></a>
<a name="index-shifting-voices"></a>
<a name="index-voices_002c-multiple-1"></a>
<a name="index-shift-rest_002c-automatic"></a>
<a name="index-_005cshiftOn"></a>
<a name="index-_005cshiftOn-1"></a>
<a name="index-_005cshiftOnn"></a>
<a name="index-_005cshiftOnn-1"></a>
<a name="index-_005cshiftOnnn"></a>
<a name="index-_005cshiftOnnn-1"></a>
<a name="index-_005cshiftOff"></a>
<a name="index-_005cshiftOff-1"></a>
<a name="index-_005cmergeDifferentlyDottedOn"></a>
<a name="index-_005cmergeDifferentlyDottedOn-1"></a>
<a name="index-_005cmergeDifferentlyDottedOff"></a>
<a name="index-_005cmergeDifferentlyDottedOff-1"></a>
<a name="index-_005cmergeDifferentlyHeadedOn"></a>
<a name="index-_005cmergeDifferentlyHeadedOn-1"></a>
<a name="index-_005cmergeDifferentlyHeadedOff"></a>
<a name="index-_005cmergeDifferentlyHeadedOff-1"></a>

<p>The note heads of notes in different voices with the same pitch,
same note head and opposite stem direction are automatically
merged, but notes with different note heads or the same stem
direction are not.  Rests opposite a stem in a different voice
are shifted vertically.  The following example shows three
different circumstances, on beats 1 and 3 in bar 1 and beat 1
in bar 2, where the automatic merging fails.
</p>
<blockquote><pre class="verbatim">&lt;&lt;
  \relative {
    c''8 d e d c d c4
    g'2 fis
  } \\
  \relative {
    c''2 c8. b16 c4
    e,2 r
  } \\
  \relative {
    \oneVoice
    s1
    e'8 a b c d2
  }
&gt;&gt;
</pre><p>
 <a href="../fa/lily-46aafd48.ly">
  <img align="middle"
       border="0"
       src="../fa/lily-46aafd48.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Notes with different note heads may be merged as shown
below.  In this example the note heads on beat 1 of bar 1 are now merged:
</p>
<blockquote><pre class="verbatim">&lt;&lt;
  \relative {
    \mergeDifferentlyHeadedOn
    c''8 d e d c d c4
    g'2 fis
  } \\
  \relative {
    c''2 c8. b16 c4
    e,2 r
  } \\
  \relative {
    \oneVoice
    s1
    e'8 a b c d2
  }
&gt;&gt;
</pre><p>
 <a href="../f6/lily-aaad88ae.ly">
  <img align="middle"
       border="0"
       src="../f6/lily-aaad88ae.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Quarter and half notes are not merged in this way, since it would be difficult
to tell them apart.
</p>
<p>Note heads with different dots as shown in beat 3 of bar 1 may be
also be merged:
</p>
<blockquote><pre class="verbatim">&lt;&lt;
  \relative {
    \mergeDifferentlyHeadedOn
    \mergeDifferentlyDottedOn
    c''8 d e d c d c4
    g'2 fis
  } \\
  \relative {
    c''2 c8. b16 c4
    e,2 r
  } \\
  \relative {
    \oneVoice
    s1
    e'8 a b c d2
  }
&gt;&gt;
</pre><p>
 <a href="../49/lily-3abb0c55.ly">
  <img align="middle"
       border="0"
       src="../49/lily-3abb0c55.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>The half note and eighth note at the start of the second measure
are incorrectly merged because the automatic merge cannot
successfully complete the merge when three or more notes line up in
the same note column, and in this case the merged note head is
incorrect.  To allow the merge to select the correct note head
a <code>\shift</code> must be applied to the note that should not be
merged.  Here, <code>\shiftOn</code> is applied to move the top
<var>g</var> out of the column, and <code>\mergeDifferentlyHeadedOn</code>
then works properly.
</p>
<blockquote><pre class="verbatim">&lt;&lt;
  \relative {
    \mergeDifferentlyHeadedOn
    \mergeDifferentlyDottedOn
    c''8 d e d c d c4
    \shiftOn
    g'2 fis
  } \\
  \relative {
    c''2 c8. b16 c4
    e,2 r
  } \\
  \relative {
    \oneVoice
    s1
    e'8 a b c d2
  }
&gt;&gt;
</pre><p>
 <a href="../3e/lily-0c020e1a.ly">
  <img align="middle"
       border="0"
       src="../3e/lily-0c020e1a.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>The <code>\shiftOn</code> command allows (but does not force) the notes
in a voice to be shifted.  When <code>\shiftOn</code> is applied to a
voice, a note or chord in that voice is shifted only if its stem
would otherwise collide with a stem from another voice, and only
if the colliding stems point in the same direction.  The
<code>\shiftOff</code> command prevents this type of shifting from
occurring.
</p>
<p>By default, the outer voices (normally voices one and two) have
<code>\shiftOff</code> specified, while the inner voices (three and
above) have <code>\shiftOn</code> specified.  When a shift is applied,
voices with upstems (odd-numbered voices) are shifted to the
right, and voices with downstems (even-numbered voices) are
shifted to the left.
</p>
<p>Here is an example to help you visualize how an abbreviated
polyphonic expression would be expanded internally.
</p>
<div class="warning"><p><strong>Note:</strong> Note that with three or more voices, the vertical order
of voices in your input file should not be the same as the
vertical order of voices on the staff!
</p>
</div>
<blockquote><pre class="verbatim">\new Staff \relative {
  %% abbreviated entry
  &lt;&lt;
    { f''2  }  % 1: highest
    \\
    { g,2 }  % 2: lowest
    \\
    { d'2 }  % 3: upper middle
    \\
    { b2  }  % 4: lower middle
  &gt;&gt;
  %% internal expansion of the above
  &lt;&lt;
    \new Voice = &quot;1&quot; { \voiceOne   \shiftOff f'2 }
    \new Voice = &quot;2&quot; { \voiceTwo   \shiftOff g,2 }
    \new Voice = &quot;3&quot; { \voiceThree \shiftOn  d'2 } % shifts right
    \new Voice = &quot;4&quot; { \voiceFour  \shiftOn  b2  } % shifts left
  &gt;&gt;
}
</pre><p>
 <a href="../74/lily-cd1a8af7.ly">
  <img align="middle"
       border="0"
       src="../74/lily-cd1a8af7.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Two additional commands, <code>\shiftOnn</code> and <code>\shiftOnnn</code>
provide further shift levels which may be specified temporarily to
resolve collisions in complex situations &ndash; see
<a name="index-Real-music-example"></a>
<a href="../learning/real-music-example.zh.html">Real music example</a>.
</p>
<p>Notes are only merged if they have opposing stem directions (as
they have, for example, in voices one and two by default or when
the stems are explicitly set in opposite directions).
</p>
<a name="Predefined-commands-47"></a>
<h4 class="subsubheading">Predefined commands</h4>
<p><code>\mergeDifferentlyDottedOn</code>,
<code>\mergeDifferentlyDottedOff</code>,
<code>\mergeDifferentlyHeadedOn</code>,
<code>\mergeDifferentlyHeadedOff</code>.
</p>
<p><code>\shiftOn</code>,
<code>\shiftOnn</code>,
<code>\shiftOnnn</code>,
<code>\shiftOff</code>.
</p>
<a name="Selected-Snippets-58"></a>
<h4 class="subsubheading">Selected Snippets</h4>

<p><em> Additional voices to avoid collisions</em>
</p>

<p>In some instances of complex polyphonic music, additional voices are
necessary to prevent collisions between notes.  If more than four
parallel voices are needed, additional voices can be added by defining
a variable using the Scheme function <code>context-spec-music</code>.
</p>

<blockquote><pre class="verbatim">voiceFive = #(context-spec-music (make-voice-props-set 4) 'Voice)

\relative c'' {
  \time 3/4
  \key d \minor
  \partial 2
  &lt;&lt;
    \new Voice  {
      \voiceOne
      a4. a8
      e'4 e4. e8
      f4 d4. c8
    }
    \new Voice {
      \voiceTwo
      d,2
      d4 cis2
      d4 bes2
    }
    \new Voice {
      \voiceThree
      f'2
      bes4 a2
      a4 s2
    }
    \new Voice {
      \voiceFive
      s2
      g4 g2
      f4 f2
    }
  &gt;&gt;
}
</pre><p>
 <a href="../4b/lily-adbceafc.ly">
  <img align="middle"
       border="0"
       src="../4b/lily-adbceafc.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>




<p><em> Forcing horizontal shift of notes</em>
</p>

<p>When the typesetting engine cannot cope, the following syntax can be
used to override typesetting decisions. The units of measure used here
are staff spaces.
</p>

<blockquote><pre class="verbatim">\relative c' &lt;&lt;
  {
    &lt;d g&gt;2 &lt;d g&gt;
  }
  \\
  {
    &lt;b f'&gt;2
    \once \override NoteColumn.force-hshift = #1.7
    &lt;b f'&gt;2
  }
&gt;&gt;
</pre><p>
 <a href="../ce/lily-e44d7789.ly">
  <img align="middle"
       border="0"
       src="../ce/lily-e44d7789.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<a name="See-also-202"></a>
<h4 class="subsubheading">See also</h4>
<p>Music Glossary:
<a name="index-polyphony"></a>
<a href="../music-glossary/polyphony.zh.html">polyphony</a>.
</p>
<p>Learning Manual:
<a name="index-Multiple-notes-at-once"></a>
<a href="../learning/multiple-notes-at-once.zh.html">Multiple notes at once</a>,
<a name="index-Voices-contain-music-1"></a>
<a href="../learning/voices-contain-music.zh.html">Voices contain music</a>,
<a name="index-Real-music-example-1"></a>
<a href="../learning/real-music-example.zh.html">Real music example</a>.
</p>
<p>Snippets:
<a href="../snippets/simultaneous-notes.zh.html">Simultaneous notes</a>.
</p>
<p>Internals Reference:
<a name="index-NoteColumn"></a>
<a href="../internals/notecolumn.zh.html">NoteColumn</a>,
<a name="index-NoteCollision"></a>
<a href="../internals/notecollision.zh.html">NoteCollision</a>,
<a name="index-RestCollision"></a>
<a href="../internals/restcollision.zh.html">RestCollision</a>.
</p>
<a name="index-collisions_002c-ignoring-1"></a>

<a name="Known-issues-and-warnings-57"></a>
<h4 class="subsubheading">Known issues and warnings</h4>
<p>Using <code>\override NoteColumn.ignore-collision = ##t</code> will cause
differently headed notes in different voices to merge incorrectly.
</p>
<blockquote><pre class="verbatim">\mergeDifferentlyHeadedOn
&lt;&lt; \relative { c'16 a' b a } \\ \relative { c'2 } &gt;&gt;
\override NoteColumn.ignore-collision = ##t
&lt;&lt; \relative { c'16 a' b a } \\ \relative { c'2 } &gt;&gt;
</pre><p>
 <a href="../6d/lily-97f184e4.ly">
  <img align="middle"
       border="0"
       src="../6d/lily-97f184e4.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>





<hr size="6">
<a name="Merging-rests"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="musical-notation.zh.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Musical notation&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.zh.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.zh.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-command-index.zh.html" title="Index" rel="index">Index</a>][<a href="index_abt.zh.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="specialist-notation.zh.html" title="Next chapter">&nbsp;Specialist notation &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#collision-resolution" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Collision resolution&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#multiple-voices" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Multiple voices&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#automatic-part-combining" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Automatic part combining &gt; </a>]</td></tr></table>
<a name="merging-rests"></a>
<h4 class="unnumberedsubsubsec">Merging rests</h4>

<p>When using multiple voices it is common to merge rests which occur in both
parts. This can be accomplished using <code>Merge_rests_engraver</code>.
</p>
<blockquote><pre class="verbatim">voiceA = \relative { d''4 r d2 | R1 | }
voiceB = \relative { fis'4 r g2 | R1 | }
\score {
  &lt;&lt;
    \new Staff \with {
      instrumentName = &quot;unmerged&quot;
    }
    &lt;&lt;
      \new Voice { \voiceOne \voiceA }
      \new Voice { \voiceTwo \voiceB }
    &gt;&gt;
    \new Staff \with {
      instrumentName = &quot;merged&quot;
      \consists #Merge_rests_engraver
    }
    &lt;&lt;
      \new Voice { \voiceOne \voiceA }
      \new Voice { \voiceTwo \voiceB }
    &gt;&gt;
  &gt;&gt;
}
</pre><p>
 <a href="../6a/lily-446384ee.ly">
  <img align="middle"
       border="0"
       src="../6a/lily-446384ee.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Setting the context property <code>suspendRestMerging</code> to <code>##t</code> allows for
turning off rest merging temporarily.
</p>
<hr size="6">
<a name="Automatic-part-combining"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="musical-notation.zh.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Musical notation&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.zh.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.zh.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-command-index.zh.html" title="Index" rel="index">Index</a>][<a href="index_abt.zh.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="specialist-notation.zh.html" title="Next chapter">&nbsp;Specialist notation &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#merging-rests" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Merging rests&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#multiple-voices" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Multiple voices&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#writing-music-in-parallel" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Writing music in parallel &gt; </a>]</td></tr></table>
<a name="automatic-part-combining"></a>
<h4 class="unnumberedsubsubsec">Automatic part combining</h4>

<a name="index-automatic-part-combining"></a>
<a name="index-part-combiner"></a>
<a name="index-combining-parts"></a>
<a name="index-a-due-part"></a>
<a name="index-solo-part"></a>
<a name="index-_005cpartcombine"></a>
<a name="index-_005cpartcombine-1"></a>

<p>Automatic part combining is used to merge two separate parts of music
onto a single staff. This can be especially helpful when typesetting
orchestral scores.  A single <code>Voice</code> is printed while the two parts
of music are the same, but in places where they differ, a second
<code>Voice</code> is printed.  Stem directions are set up &amp; down accordingly
while Solo and <var>a due</var> parts are also identified and marked
appropriately.
</p>
<p>The syntax for automatic part combining is:
</p>
<blockquote><pre class="example">\partcombine <var>musicexpr1</var> <var>musicexpr2</var>
</pre></blockquote>

<p>The following example demonstrates the basic functionality, putting
parts on a single staff as polyphony and setting stem directions
accordingly.  The same variables are used for the independent parts and
the combined staff.
</p>
<blockquote><pre class="verbatim">instrumentOne = \relative {
  c'4 d e f |
  R1 |
  d'4 c b a |
  b4 g2 f4 |
  e1 |
}

instrumentTwo = \relative {
  R1 |
  g'4 a b c |
  d4 c b a |
  g4 f( e) d |
  e1 |
}

&lt;&lt;
  \new Staff \instrumentOne
  \new Staff \instrumentTwo
  \new Staff \partcombine \instrumentOne \instrumentTwo
&gt;&gt;
</pre><p>
 <a href="../4b/lily-d77695ee.ly">
  <img align="middle"
       border="0"
       src="../4b/lily-d77695ee.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Both parts have identical notes in the third measure, so only one
instance of the notes is printed.  Stem, slur, and tie directions are
set automatically, depending on whether the parts are playing solo or in
unison.  When needed in polyphony situations, the first part (with
context called <code>one</code>) gets &ldquo;up&rdquo; stems, while the second (called
<code>two</code>) always gets &ldquo;down&rdquo; stems.  In solo situations, the first
and second parts get marked with &ldquo;Solo&rdquo; and &ldquo;Solo II&rdquo;,
respectively.  The unison (<var>a due</var>) parts are marked with the
text &ldquo;a2&rdquo;.
</p>
<p>By default, the partcombiner merges two notes of the same pitch as an
<var>a due</var> note, combines notes with the same
rhythm less than a ninth apart as chords and separates notes more than
a ninth apart (or when the voices cross) into
separate voices.  This can be overridden with an optional argument of a pair
of numbers after the <code>\partcombine</code> command: the first specifies
the interval where notes start to be combined (the default is zero) and the
second where the notes are split into separate voices.  Setting the second
argument to zero means that the partcombiner splits notes with an interval of
a second or more, setting it to one splits notes of a third or more, and so on.
</p>
<blockquote><pre class="verbatim">instrumentOne = \relative {
  a4 b c d |
  e f g a |
  b c d e |
}

instrumentTwo = \relative {
  c'4 c c c |
  c c c c |
  c c c c |
}

&lt;&lt;
  \new Staff \partcombine \instrumentOne \instrumentTwo
  \new Staff \partcombine #'(2 . 3) \instrumentOne \instrumentTwo
&gt;&gt;
</pre><p>
 <a href="../5f/lily-3c107e1f.ly">
  <img align="middle"
       border="0"
       src="../5f/lily-3c107e1f.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>




<p>Both arguments to <code>\partcombine</code> will be interpreted as separate
<code>Voice</code> contexts, so if the music is being specified in relative
mode then <em>both</em> parts must contain a <code>\relative</code> function,
i.e.,
</p>
<blockquote><pre class="example">\partcombine
  \relative &hellip; <var>musicexpr1</var>
  \relative &hellip; <var>musicexpr2</var>
</pre></blockquote>

<p>A <code>\relative</code> section that encloses a <code>\partcombine</code> has no
effect on the pitches of <code><var>musicexpr1</var></code> or
<code><var>musicexpr2</var></code>.
</p>
<a name="index-_005cpartcombineChords"></a>
<a name="index-_005cpartcombineChords-1"></a>
<a name="index-_005cpartcombineApart"></a>
<a name="index-_005cpartcombineApart-1"></a>
<a name="index-_005cpartcombineUnisono"></a>
<a name="index-_005cpartcombineUnisono-1"></a>
<a name="index-_005cpartcombineSoloI"></a>
<a name="index-_005cpartcombineSoloI-1"></a>
<a name="index-_005cpartcombineSoloII"></a>
<a name="index-_005cpartcombineSoloII-1"></a>
<a name="index-_005cpartcombineAutomatic"></a>
<a name="index-_005cpartcombineAutomatic-1"></a>

<p>In professional scores, voices are often kept apart from each other for
long passages of music even if some of the notes are the same in both
voices, and could just as easily be printed as unison. Combining notes
into a chord, or showing one voice as solo is, therefore, not ideal as
the <code>\partcombine</code> function considers each note separately. In this
case the <code>\partcombine</code> function can be overridden with one of the
following commands.  All of the commands may be preceded with
<code>\once</code> in order to have them only apply to the next note in
the music expression.
</p>
<ul>
<li>
<code>\partcombineApart</code> keeps the
notes as two separate voices, even if they can be combined into a chord
or unison.

</li><li>
<code>\partcombineChords</code> combines the
notes into a chord.

</li><li>
<code>\partcombineUnisono</code> combines
both voices as &ldquo;unison&rdquo;.

</li><li>
<code>\partcombineSoloI</code> prints only
voice one, and marks it as a &ldquo;Solo&rdquo;.

</li><li>
<code>\partcombineSoloII</code> prints only
voice two and marks it as a &ldquo;Solo&rdquo;.

</li><li>
<code>\partcombineAutomatic</code> ends
the functions of the commands above, and reverts back to the standard
<code>\partcombine</code> functionality.
</li></ul>

<blockquote><pre class="verbatim">instrumentOne = \relative c' {
  \partcombineApart c2^&quot;apart&quot; e |
  \partcombineAutomatic e2^&quot;auto&quot; e |
  \partcombineChords e'2^&quot;chord&quot; e |
  \partcombineAutomatic c2^&quot;auto&quot; c |
  \partcombineApart c2^&quot;apart&quot; \once \partcombineChords e^&quot;chord once&quot; |
  c2 c |
}
instrumentTwo = \relative {
  c'2 c |
  e2 e |
  a,2 c |
  c2 c' |
  c2 c |
  c2 c |
}

&lt;&lt;
  \new Staff { \instrumentOne }
  \new Staff { \instrumentTwo }
  \new Staff { \partcombine \instrumentOne \instrumentTwo }
&gt;&gt;
</pre><p>
 <a href="../13/lily-b1113ef1.ly">
  <img align="middle"
       border="0"
       src="../13/lily-b1113ef1.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>




<a name="-Using-_005cpartcombine-with-lyrics"></a>
<h4 class="subsubheading"><i> Using \partcombine with lyrics</i></h4>

<a name="index-_005cpartcombine-and-lyrics"></a>

<p>The <code>\partcombine</code> command is not designed to work with
lyrics; if one of the voices is explicitly named in order to
attach lyrics to it, the partcombiner will stop working.  However,
this effect can be achieved using a <code>NullVoice</code> context.  See
<a href="techniques-specific-to-lyrics.zh.html#polyphony-with-shared-lyrics">Polyphony with shared lyrics</a>.
</p>

<a name="Selected-Snippets-26"></a>
<h4 class="subsubheading">Selected Snippets</h4>


<p><em> Combining two parts on the same staff</em>
</p>

<p>The part combiner tool ( <code>\partcombine</code> command ) allows the
combination of several different parts on the same staff.  Text
directions such as &ldquo;solo&rdquo; or &ldquo;a2&rdquo; are added by default; to remove
them, simply set the property <code>printPartCombineTexts</code> to <code>f</code>.
For vocal scores (hymns), there is no need to add &ldquo;solo/a2&rdquo; texts,
so they should be switched off.  However, it might be better not to use
it if there are any solos, as they won&rsquo;t be indicated.  In such cases,
standard polyphonic notation may be preferable.
</p>
<p>This snippet presents the three ways two parts can be printed on a same
staff: standard polyphony, <code>\partcombine</code> without texts, and
<code>\partcombine</code> with texts.
</p>




<blockquote><pre class="verbatim">musicDown = \relative c'' {
  g4 e4.( d8) c4 |
  r2 g'4( f8 e) |
  d2 \stemDown a
}

\score {
    &lt;&lt;
    \new Staff \with { instrumentName = #&quot;Standard polyphony&quot; }

      &lt;&lt; \musicUp \\ \musicDown &gt;&gt;

    \new Staff \with {
      instrumentName = #&quot;PartCombine without text&quot;
      printPartCombineTexts = ##f
    }

    \partcombine \musicUp \musicDown

    \new Staff \with { instrumentName = #&quot;PartCombine with text&quot; }
      \partcombine \musicUp \musicDown
    &gt;&gt;
  \layout {
    indent = 6.0\cm
    \context {
      \Score
      \override SystemStartBar.collapse-height = #30
    }
  }
}
</pre><p>
 <a href="../e1/lily-35e9c8f3.ly">
  <img align="middle"
       border="0"
       src="../e1/lily-35e9c8f3.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>




<p><em> Changing partcombine texts</em>
</p>

<p>When using the automatic part combining feature, the printed text for
the solo and unison sections may be changed:
</p>

<blockquote><pre class="verbatim">\new Staff &lt;&lt;
  \set Staff.soloText = #&quot;girl&quot;
  \set Staff.soloIIText = #&quot;boy&quot;
  \set Staff.aDueText = #&quot;together&quot;
  \partcombine
    \relative c'' {
      g4 g r r
      a2 g
    }
    \relative c'' {
      r4 r a( b)
      a2 g
    }
&gt;&gt;
</pre><p>
 <a href="../4d/lily-80dfe801.ly">
  <img align="middle"
       border="0"
       src="../4d/lily-80dfe801.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<a name="See-also-179"></a>
<h4 class="subsubheading">See also</h4>
<p>Music Glossary:
<a name="index-a-due"></a>
<a href="../music-glossary/a-due.zh.html">a due</a>,
<a name="index-part"></a>
<a href="../music-glossary/part.zh.html">part</a>.
</p>
<p>Notation Reference:
<a href="writing-parts.zh.html">Writing parts</a>.
</p>
<p>Snippets:
<a href="../snippets/simultaneous-notes.zh.html">Simultaneous notes</a>.
</p>
<p>Internals Reference:
<a name="index-PartCombineMusic"></a>
<a href="../internals/partcombinemusic.zh.html">PartCombineMusic</a>,
<a name="index-Voice-4"></a>
<a href="../internals/voice.zh.html">Voice</a>.
</p>
<a name="Known-issues-and-warnings-49"></a>
<h4 class="subsubheading">Known issues and warnings</h4>
<p>All <code>\partcombine&hellip;</code> functions can only accept two voices.
</p>
<p><code>\partcombine&hellip;</code> functions cannot be placed inside a <code>\tuplet</code>
or <code>\relative</code> block.
</p>
<p>If <code>printPartCombineTexts</code> is set and the two voices play the same
notes &ldquo;on and off&rdquo;, in the same measure, the part combiner may
typeset <code>a2</code> more than once in that measure.
</p>
<p><code>\partcombine</code> only knows when a note starts in a <code>Voice</code>; it
cannot, for example, remember if a note in one <code>Voice</code> has already
started when combining notes that have just started in the other
<code>Voice</code>.  This can lead to a number of unexpected issues including
&ldquo;Solo&rdquo; or &ldquo;Unison&rdquo; marks being printed incorrectly.
</p>
<p><code>\partcombine</code> keeps all spanners (slurs, ties, hairpins, etc.) in
the same <code>Voice</code> so that if any such spanners start or end in a
different <code>Voice</code>, they may not be printed properly or at all.
</p>
<p>If the <code>\partcombine</code> function cannot combine both music
expressions (i.e., when both voices have different durations), it will
give the voices, internally, its own custom names: <code>one</code> and
<code>two</code> respectively.  This means if there is any &ldquo;switch&rdquo; to a
differently named <code>Voice</code> context, the events in that differently
named <code>Voice</code> will be ignored.
</p>
<p>Refer also to <em>Known issues and warnings</em> when using
<code>\partcombine</code> with tablature in <a href="common-notation-for-fretted-strings.zh.html#default-tablatures">Default tablatures</a> and the
<em>Note</em> in <a href="beams.zh.html#automatic-beams">Automatic beams</a> when using automatic beaming.
</p>

<hr size="6">
<a name="Writing-music-in-parallel"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="musical-notation.zh.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Musical notation&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.zh.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.zh.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-command-index.zh.html" title="Index" rel="index">Index</a>][<a href="index_abt.zh.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="specialist-notation.zh.html" title="Next chapter">&nbsp;Specialist notation &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#automatic-part-combining" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Automatic part combining&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#multiple-voices" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Multiple voices&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="staff-notation.zh.html" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Staff notation &gt; </a>]</td></tr></table>
<a name="writing-music-in-parallel"></a>
<h4 class="unnumberedsubsubsec">Writing music in parallel</h4>

<a name="index-writing-music-in-parallel"></a>
<a name="index-interleaved-music"></a>
<a name="index-parallel-music"></a>
<a name="index-_005cparallelMusic"></a>
<a name="index-_005cparallelMusic-1"></a>

<p>Music for multiple parts can be interleaved in input code.  The
function <code>\parallelMusic</code> accepts a list with the names of a
number of variables to be created, and a musical expression.  The
content of alternate measures from the expression become the value
of the respective variables, so you can use them afterwards to
print the music.
</p>
<div class="warning"><p><strong>Note:</strong> Bar checks <code>|</code> must be used, and the measures must
be of the same length.
</p>
</div>
<blockquote><pre class="verbatim">\parallelMusic #'(voiceA voiceB voiceC) {
  % Bar 1
  r8 g'16 c'' e'' g' c'' e'' r8 g'16 c'' e'' g' c'' e'' |
  r16 e'8.~   4              r16 e'8.~   4              |
  c'2                        c'2                        |

  % Bar 2
  r8 a'16 d'' f'' a' d'' f'' r8 a'16 d'' f'' a' d'' f'' |
  r16 d'8.~   4              r16 d'8.~   4              |
  c'2                        c'2                        |

}
\new StaffGroup &lt;&lt;
  \new Staff &lt;&lt; \voiceA \\ \voiceB &gt;&gt;
  \new Staff { \clef bass \voiceC }
&gt;&gt;
</pre><p>
 <a href="../ae/lily-52e30936.ly">
  <img align="middle"
       border="0"
       src="../ae/lily-52e30936.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Relative mode may be used.  Note that the <code>\relative</code> command
is not used inside <code>\parallelMusic</code> itself.  The notes are
relative to the preceding note in the voice, not to the previous
note in the input &ndash; in other words, relative notes for
<code>voiceA</code> ignore the notes in <code>voiceB</code>.
</p>
<blockquote><pre class="verbatim">\parallelMusic #'(voiceA voiceB voiceC) {
  % Bar 1
  r8 g16 c e g, c e r8 g,16 c e g, c e  |
  r16 e8.~ 4        r16 e8.~  4         |
  c2                c                   |

  % Bar 2
  r8 a,16 d f a, d f r8 a,16 d f a, d f |
  r16 d8.~  4        r16 d8.~  4        |
  c2                 c                  |

 }
\new StaffGroup &lt;&lt;
  \new Staff &lt;&lt; \relative c'' \voiceA \\ \relative c' \voiceB &gt;&gt;
  \new Staff \relative c' { \clef bass \voiceC }
&gt;&gt;
</pre><p>
 <a href="../24/lily-cba32dd3.ly">
  <img align="middle"
       border="0"
       src="../24/lily-cba32dd3.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>This works quite well for piano music.  This example maps four
consecutive measures to four variables:
</p>
<blockquote><pre class="verbatim">global = {
  \key g \major
  \time 2/4
}

\parallelMusic #'(voiceA voiceB voiceC voiceD) {
  % Bar 1
  a8    b     c   d     |
  d4          e         |
  c16 d e fis d e fis g |
  a4          a         |

  % Bar 2
  e8      fis  g     a   |
  fis4         g         |
  e16 fis g  a fis g a b |
  a4           a         |

  % Bar 3 ...
}

\score {
  \new PianoStaff &lt;&lt;
     \new Staff {
       \global
       &lt;&lt;
         \relative c'' \voiceA
         \\
         \relative c'  \voiceB
       &gt;&gt;
     }
     \new Staff {
       \global \clef bass
       &lt;&lt;
         \relative c \voiceC
         \\
         \relative c \voiceD
       &gt;&gt;
     }
  &gt;&gt;
}
</pre><p>
 <a href="../56/lily-9774372e.ly">
  <img align="middle"
       border="0"
       src="../56/lily-9774372e.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<a name="See-also-283"></a>
<h4 class="subsubheading">See also</h4>
<p>Learning Manual:
<a name="index-Organizing-pieces-with-variables"></a>
<a href="../learning/organizing-pieces-with-variables.zh.html">Organizing pieces with variables</a>.
</p>
<p>Snippets:
<a href="../snippets/simultaneous-notes.zh.html">Simultaneous notes</a>.
</p>

<hr size="6">
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="musical-notation.zh.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Musical notation&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.zh.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.zh.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-command-index.zh.html" title="Index" rel="index">Index</a>][<a href="index_abt.zh.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="specialist-notation.zh.html" title="Next chapter">&nbsp;Specialist notation &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#automatic-part-combining" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Automatic part combining&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#multiple-voices" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Multiple voices&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="staff-notation.zh.html" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Staff notation &gt; </a>]</td></tr></table>
<!-- footer_tag -->
<div class="footer">
<!-- This footer was autogenerated by /home/gub/NewGub/gub/target/linux-x86/build/lilypond-git.sv.gnu.org--lilypond.git-release-unstable/scripts/build/out/www_post -->
<p class="footer_version">
This page is for LilyPond-2.19.65 (开发分支).
</p>
<p class="footer_report">
We welcome your aid; please <a href="http://lilypond.org/help-us.html">help us</a> by reporting errors to our <a href="http://post.gmane.org/post.php?group=gmane.comp.gnu.lilypond.bugs">bug list</a>.
</p>
</div>


<p id="languages">
<!-- These links were autogenerated by /home/gub/NewGub/gub/target/linux-x86/build/lilypond-git.sv.gnu.org--lilypond.git-release-unstable/scripts/build/out/www_post -->
 其他语言：<a href="multiple-voices.ca.html">català</a>, <a href="multiple-voices.de.html">deutsch</a>, <a href="multiple-voices.es.html">español</a>, <a href="multiple-voices.fr.html">français</a>, <a href="multiple-voices.it.html">italiano</a>, <a href="multiple-voices.ja.html">日本語</a>。
 <br>
 About <a href="http://www.lilypond.org/website/misc/browser-language">automatic language selection</a>.
</p>

<!-- FOOTER -->

<!-- end div#main here -->
</div>



<div id="tocframe">
<p class="toc_uplink"><a href="../../Documentation/web/manuals.html"
         title="Documentation Index">&lt;&lt; Back to Documentation Index</a></p>
<h4 class="toc_header"> <a href="index.zh.html" title="Start of the manual">LilyPond &mdash; Notation Reference  v2.19.65 (开发分支). </a></h4>
<div class="contents">
<ul class="toc">
  <li class=" toc_current"><a name="toc-Musical-notation-1" href="musical-notation.zh.html">1. Musical notation</a>
  <ul class="toc">
    <li class=""><a name="toc-Pitches-1" href="pitches.zh.html">1.1 Pitches</a>    </li>
    <li class=""><a name="toc-Rhythms-1" href="rhythms.zh.html">1.2 Rhythms</a>    </li>
    <li class=""><a name="toc-Expressive-marks-1" href="expressive-marks.zh.html">1.3 Expressive marks</a>    </li>
    <li class=""><a name="toc-Repeats-1" href="repeats.zh.html">1.4 Repeats</a>    </li>
    <li class=" toc_current"><a name="toc-Simultaneous-notes-1" href="simultaneous-notes.zh.html">1.5 Simultaneous notes</a>
    <ul class="toc">
      <li class=""><a name="toc-Single-voice-1" href="single-voice.zh.html">1.5.1 Single voice</a>      </li>
      <li class=" toc_current"><a name="toc-Multiple-voices-1" href="multiple-voices.zh.html">1.5.2 Multiple voices</a>
      <ul class="toc">
        <li class=""><a name="toc-Single_002dstaff-polyphony-1" href="multiple-voices.zh.html#single_002dstaff-polyphony">Single-staff polyphony</a>        </li>
        <li class=""><a name="toc-Voice-styles-1" href="multiple-voices.zh.html#voice-styles">Voice styles</a>        </li>
        <li class=""><a name="toc-Collision-resolution-1" href="multiple-voices.zh.html#collision-resolution">Collision resolution</a>        </li>
        <li class=""><a name="toc-Merging-rests-1" href="multiple-voices.zh.html#merging-rests">Merging rests</a>        </li>
        <li class=""><a name="toc-Automatic-part-combining-1" href="multiple-voices.zh.html#automatic-part-combining">Automatic part combining</a>        </li>
        <li class=""><a name="toc-Writing-music-in-parallel-1" href="multiple-voices.zh.html#writing-music-in-parallel">Writing music in parallel</a>        </li>
      </ul>
      </li>
    </ul>
    </li>
    <li class=""><a name="toc-Staff-notation-1" href="staff-notation.zh.html">1.6 Staff notation</a>    </li>
    <li class=""><a name="toc-Editorial-annotations-1" href="editorial-annotations.zh.html">1.7 Editorial annotations</a>    </li>
    <li class=""><a name="toc-Text-1" href="text.zh.html">1.8 Text</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Specialist-notation-1" href="specialist-notation.zh.html">2. Specialist notation</a>
  <ul class="toc">
    <li class=""><a name="toc-Vocal-music-1" href="vocal-music.zh.html">2.1 Vocal music</a>    </li>
    <li class=""><a name="toc-Keyboard-and-other-multi_002dstaff-instruments-1" href="keyboard-and-other-multi_002dstaff-instruments.zh.html">2.2 Keyboard and other multi-staff instruments</a>    </li>
    <li class=""><a name="toc-Unfretted-string-instruments-1" href="unfretted-string-instruments.zh.html">2.3 Unfretted string instruments</a>    </li>
    <li class=""><a name="toc-Fretted-string-instruments-1" href="fretted-string-instruments.zh.html">2.4 Fretted string instruments</a>    </li>
    <li class=""><a name="toc-Percussion-1" href="percussion.zh.html">2.5 Percussion</a>    </li>
    <li class=""><a name="toc-Wind-instruments-1" href="wind-instruments.zh.html">2.6 Wind instruments</a>    </li>
    <li class=""><a name="toc-Chord-notation-1" href="chord-notation.zh.html">2.7 Chord notation</a>    </li>
    <li class=""><a name="toc-Contemporary-music-1" href="contemporary-music.zh.html">2.8 Contemporary music</a>    </li>
    <li class=""><a name="toc-Ancient-notation-1" href="ancient-notation.zh.html">2.9 Ancient notation</a>    </li>
    <li class=""><a name="toc-World-music-1" href="world-music.zh.html">2.10 World music</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-General-input-and-output-1" href="general-input-and-output.zh.html">3. General input and output</a>
  <ul class="toc">
    <li class=""><a name="toc-Input-structure-1" href="input-structure.zh.html">3.1 Input structure</a>    </li>
    <li class=""><a name="toc-Titles-and-headers-1" href="titles-and-headers.zh.html">3.2 Titles and headers</a>    </li>
    <li class=""><a name="toc-Working-with-input-files-1" href="working-with-input-files.zh.html">3.3 Working with input files</a>    </li>
    <li class=""><a name="toc-Controlling-output-1" href="controlling-output.zh.html">3.4 Controlling output</a>    </li>
    <li class=""><a name="toc-Creating-MIDI-output-1" href="creating-midi-output.zh.html">3.5 Creating MIDI output</a>    </li>
    <li class=""><a name="toc-Extracting-musical-information-1" href="extracting-musical-information.zh.html">3.6 Extracting musical information</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Spacing-issues-1" href="spacing-issues.zh.html">4. Spacing issues</a>
  <ul class="toc">
    <li class=""><a name="toc-Page-layout-1" href="page-layout.zh.html">4.1 Page layout</a>    </li>
    <li class=""><a name="toc-Score-layout-1" href="score-layout.zh.html">4.2 Score layout</a>    </li>
    <li class=""><a name="toc-Breaks-1" href="breaks.zh.html">4.3 Breaks</a>    </li>
    <li class=""><a name="toc-Vertical-spacing-1" href="vertical-spacing.zh.html">4.4 Vertical spacing</a>    </li>
    <li class=""><a name="toc-Horizontal-spacing-1" href="horizontal-spacing.zh.html">4.5 Horizontal spacing</a>    </li>
    <li class=""><a name="toc-Fitting-music-onto-fewer-pages-1" href="fitting-music-onto-fewer-pages.zh.html">4.6 Fitting music onto fewer pages</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Changing-defaults-1" href="changing-defaults.zh.html">5. Changing defaults</a>
  <ul class="toc">
    <li class=""><a name="toc-Interpretation-contexts-1" href="interpretation-contexts.zh.html">5.1 Interpretation contexts</a>    </li>
    <li class=""><a name="toc-Explaining-the-Internals-Reference-1" href="explaining-the-internals-reference.zh.html">5.2 Explaining the Internals Reference</a>    </li>
    <li class=""><a name="toc-Modifying-properties-1" href="modifying-properties.zh.html">5.3 Modifying properties</a>    </li>
    <li class=""><a name="toc-Useful-concepts-and-properties-1" href="useful-concepts-and-properties.zh.html">5.4 Useful concepts and properties</a>    </li>
    <li class=""><a name="toc-Advanced-tweaks-1" href="advanced-tweaks.zh.html">5.5 Advanced tweaks</a>    </li>
    <li class=""><a name="toc-Using-music-functions-1" href="using-music-functions.zh.html">5.6 Using music functions</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Notation-manual-tables-1" href="notation-manual-tables.zh.html">A. Notation manual tables</a>
  <ul class="toc">
    <li class=""><a name="toc-Chord-name-chart-1" href="chord-name-chart.zh.html">A.1 Chord name chart</a>    </li>
    <li class=""><a name="toc-Common-chord-modifiers-1" href="common-chord-modifiers.zh.html">A.2 Common chord modifiers</a>    </li>
    <li class=""><a name="toc-Predefined-string-tunings-1" href="predefined-string-tunings.zh.html">A.3 Predefined string tunings</a>    </li>
    <li class=""><a name="toc-Predefined-fretboard-diagrams-1" href="predefined-fretboard-diagrams.zh.html">A.4 Predefined fretboard diagrams</a>    </li>
    <li class=""><a name="toc-Predefined-paper-sizes-1" href="predefined-paper-sizes.zh.html">A.5 Predefined paper sizes</a>    </li>
    <li class=""><a name="toc-MIDI-instruments-1" href="midi-instruments.zh.html">A.6 MIDI instruments</a>    </li>
    <li class=""><a name="toc-List-of-colors-1" href="list-of-colors.zh.html">A.7 List of colors</a>    </li>
    <li class=""><a name="toc-The-Emmentaler-font-1" href="the-emmentaler-font.zh.html">A.8 The Emmentaler font</a>    </li>
    <li class=""><a name="toc-Note-head-styles-1" href="note-head-styles.zh.html">A.9 Note head styles</a>    </li>
    <li class=""><a name="toc-Clef-styles-1" href="clef-styles.zh.html">A.10 Clef styles</a>    </li>
    <li class=""><a name="toc-Text-markup-commands-1" href="text-markup-commands.zh.html">A.11 Text markup commands</a>    </li>
    <li class=""><a name="toc-Text-markup-list-commands-1" href="text-markup-list-commands.zh.html">A.12 Text markup list commands</a>    </li>
    <li class=""><a name="toc-List-of-special-characters-1" href="list-of-special-characters.zh.html">A.13 List of special characters</a>    </li>
    <li class=""><a name="toc-List-of-articulations-1" href="list-of-articulations.zh.html">A.14 List of articulations</a>    </li>
    <li class=""><a name="toc-Percussion-notes-1" href="percussion-notes.zh.html">A.15 Percussion notes</a>    </li>
    <li class=""><a name="toc-Technical-glossary-1" href="technical-glossary.zh.html">A.16 Technical glossary</a>    </li>
    <li class=""><a name="toc-All-context-properties-1" href="all-context-properties.zh.html">A.17 All context properties</a>    </li>
    <li class=""><a name="toc-Layout-properties-1" href="layout-properties.zh.html">A.18 Layout properties</a>    </li>
    <li class=""><a name="toc-Available-music-functions-1" href="available-music-functions.zh.html">A.19 Available music functions</a>    </li>
    <li class=""><a name="toc-Context-modification-identifiers-1" href="context-modification-identifiers.zh.html">A.20 Context modification identifiers</a>    </li>
    <li class=""><a name="toc-Predefined-type-predicates-1" href="predefined-type-predicates.zh.html">A.21 Predefined type predicates</a>    </li>
    <li class=""><a name="toc-Scheme-functions-1" href="scheme-functions.zh.html">A.22 Scheme functions</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Cheat-sheet-1" href="cheat-sheet.zh.html">B. Cheat sheet</a>  </li>
  <li class=""><a name="toc-GNU-Free-Documentation-License-1" href="gnu-free-documentation-license.zh.html">C. GNU Free Documentation License</a>  </li>
  <li class=""><a name="toc-LilyPond-command-index-1" href="lilypond-command-index.zh.html">D. LilyPond command index</a>  </li>
  <li class=""><a name="toc-LilyPond-index-1" href="lilypond-index.zh.html">E. LilyPond index</a>  </li>
<li>
<!--
we depend on an external entity here, which we cannot control.  Suppose
we go from 2.15.x to 2.17.x and put the documentation under "v2.17".
For some time, Google won't have the new location in its index, so the
search would get nothing.  It would be better to keep "v2.15" in the
search for a while and have a redirection from "v2.15" to "v2.17".
-->

<form action="http://google.com/search"
      method="get"
      name="search"
      onSubmit="search.q.value='site:lilypond.org/doc/v2.19 '
		+ search.brute_query.value"
      onMouseMove="search.q.value='site:lilypond.org/doc/v2.19 '
		   + search.brute_query.value"
      onKeyUp="search.q.value='site:lilypond.org/doc/v2.19 '
	       + search.brute_query.value">
  <input type="hidden" name="btnG" value="Google Search">
  <input type="text" name="brute_query" onfocus="this.value=''" value="Search">
  <input type="hidden" name="q" value="">
</form>
</li>
</ul>
</div>
</div>

</body>
</html>
