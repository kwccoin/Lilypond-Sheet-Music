<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Copyright C 2004-2015 by par les auteurs.

The translation of the following copyright notice is provided
for courtesy to non-English speakers, but only the notice in English
legally counts.

La traduction de la notice de droits d'auteur ci-dessous vise à
faciliter sa compréhension par le lecteur non anglophone, mais seule la
notice en anglais a valeur légale.

Vous avez le droit de copier, distribuer et/ou modifier ce document
selon les termes de la Licence GNU de documentation libre, version 1.1
ou tout autre version ultérieure publiée par la Free Software
Foundation, "sans aucune section invariante".
Une copie de la licence est fournie à la section "Licence GNU de documentation libre".


Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.1
or any later version published by the Free Software Foundation;
with no Invariant Sections.
A copy of the license is included in the section entitled "GNU
Free Documentation License".

 -->
<!-- Created on le 6 ao&ucirc;t 2017 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>GNU LilyPond &ndash; Extension des fonctionnalités</title>

<meta name="description" content="GNU LilyPond &ndash; Extension des fonctionnalités">
<meta name="keywords" content="GNU LilyPond &ndash; Extension des fonctionnalités">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="#index" rel="start" title="LilyPond &mdash; Extension des fonctionnalités">
<link href="#lilypond-index" rel="index" title="B. Index de LilyPond">
<link href="#SEC_Contents" rel="contents" title="Table des mati&egrave;res">
<link href="#SEC_About" rel="help" title="A propos de ce document">
<link rel="stylesheet" type="text/css" title="Default style" href="../Documentation/css/lilypond-manuals.css">
<!--[if lte IE 7]>
<link href="../Documentation/css/lilypond-manuals-ie-fixes.css" rel="stylesheet" type="text/css">
<![endif]-->


</head>

<body lang="fr" class="extending devStatus">


<div id="main">
<a name="Top"></a>
<table class="nav_table">
<tr><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td></tr></table>
<a name="index"></a>
<h1 class="settitle">LilyPond &mdash; Extension des fonctionnalités</h1>

<table class="cartouche" border="1"><tr><td>
<p>Ce document fournit les informations de base pour étendre les
fonctionnalités de LilyPond&nbsp;version 2.19.65.
</p></td></tr></table>







<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#tutoriel-scheme" accesskey="1">1. Tutoriel Scheme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">              Programmation dans LilyPond.
</td></tr>
<tr><td align="left" valign="top"><a href="#interfaces-for-programmers" accesskey="2">2. Interfaces pour programmeurs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> Comment dialoguer avec scheme.
</td></tr>
<tr><td align="left" valign="top"><a href="#lilypond-scheme-interfaces" accesskey="3">3. Interfaces LilyPond Scheme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">   Obtention d&rsquo;information dans la musique et autour
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">
Appendices

</pre></th></tr><tr><td align="left" valign="top"><a href="#gnu-free-documentation-license" accesskey="4">A. GNU Free Documentation License</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> Licence de ce document.
</td></tr>
<tr><td align="left" valign="top"><a href="#lilypond-index" accesskey="5">B. Index de LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<table class="cartouche" border="1"><tr><td>
<p>Pour connaître la place qu&rsquo;occupe ce manuel dans la
documentation, consultez la page <a name="index-Manuels"></a>
<a href="web-big-page.fr.html#manuals">Manuels</a>.
</p>
<p>Si vous ne disposez pas de certains manuels, la documentation complète
se trouve sur <a href="http://lilypond.org">http://lilypond.org/</a>.
</p></td></tr></table>









<hr size="1">
<a name="Tutoriel-Scheme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#index" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Top&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#index" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Top&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#introduction-to-scheme" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Introduction à Scheme &gt; </a>]</td></tr></table>
<a name="tutoriel-scheme"></a>
<h1 class="chapter">1. Tutoriel Scheme</h1>

<a name="index-Scheme"></a>
<a name="index-GUILE"></a>
<a name="index-Scheme_002c-inclusion-de-code"></a>
<a name="index-acceder-a-Scheme"></a>
<a name="index-evaluation-Scheme"></a>
<a name="index-LISP"></a>

<p>LilyPond recourt abondamment au langage de programmation Scheme, tant au
niveau de la syntaxe de saisie que des mécanismes internes chargés de
combiner les différents modules du logiciel.  Les lignes qui suivent
constituent un bref aperçu de la manière de saisir des données en
Scheme.  Si vous désirez en apprendre plus sur Scheme, n&rsquo;hésitez pas à
vous rendre sur <a href="http://www.schemers.org">http://www.schemers.org</a>.
</p>
<p>Le Scheme utilisé par LilyPond repose sur l&rsquo;implémentation GNU
Guile ; celle-ci se base sur le standard Scheme « R5RS ».  Si
votre but est d&rsquo;apprendre Scheme au travers de LilyPond, sachez que
l&rsquo;utilisation d&rsquo;une autre implémentation ou d&rsquo;un autre standard pourrait
être source de désagrément.  Vous trouverez plus d&rsquo;information sur
Guile à la page <a href="http://www.gnu.org/software/guile">http://www.gnu.org/software/guile/</a> ; le
standard Scheme « R5RS » est quant à lui disponible à la page
<a href="http://www.schemers.org/Documents/Standards/R5RS">http://www.schemers.org/Documents/Standards/R5RS/</a>.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#introduction-to-scheme" accesskey="1">1.1 Introduction à Scheme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#scheme-in-lilypond" accesskey="2">1.2 Scheme et LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#building-complicated-functions" accesskey="3">1.3 Construction de fonctions complexes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Introduction-_00e0-Scheme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#tutoriel-scheme" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#tutoriel-scheme" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme-sandbox" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Le bac à sable de Scheme &gt; </a>]</td></tr></table>
<a name="introduction-to-scheme"></a>
<h2 class="section">1.1 Introduction à Scheme</h2>

<p>Nous commencerons par nous intéresser à Scheme et à son fonctionnement,
grâce à l&rsquo;interpréteur Guile.  Une fois plus à l&rsquo;aise avec Scheme, nous
verrons comment ce langage peut s&rsquo;intégrer à un fichier LilyPond.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#scheme-sandbox" accesskey="1">1.1.1 Le bac à sable de Scheme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#scheme-variables" accesskey="2">1.1.2 Scheme et les variables</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#scheme-simple-data-types" accesskey="3">1.1.3 Types de données Scheme simples</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#scheme-compound-data-types" accesskey="4">1.1.4 Types de données Scheme composites</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#calculations-in-scheme" accesskey="5">1.1.5 Scheme et les calculs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#scheme-procedures" accesskey="6">1.1.6 Scheme et les procédures</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#scheme-conditionals" accesskey="7">1.1.7 Scheme et les conditions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Le-bac-_00e0-sable-de-Scheme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#introduction-to-scheme" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Introduction à Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-scheme" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Introduction à Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme-variables" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Scheme et les variables &gt; </a>]</td></tr></table>
<a name="scheme-sandbox"></a>
<h3 class="subsection">1.1.1 Le bac à sable de Scheme</h3>

<p>L&rsquo;installation de LilyPond comprend l&rsquo;implémentation Guile de Scheme.
La plupart des systèmes disposent d&rsquo;un « bac à sable » Scheme pour
effectuer des tests ; vous y accéderez en tapant <code>guile</code> dans
un terminal.  Certains systèmes, notamment Windows, nécessitent d&rsquo;avoir
auparavant créé la variable d&rsquo;environnement <code>GUILE_LOAD_PATH</code> qui
devra pointer vers le répertoire <code>../usr/share/guile/1.8</code> de
l&rsquo;installation de LilyPond &ndash; pour connaître le chemin complet d&rsquo;accès à
ce répertoire, consultez <a name="index-Autres-sources-de-documentation"></a>
<a href="learning-big-page.fr.html#other-sources-of-information">Autres sources de documentation</a>.
Les utilisateurs de Windows peuvent aussi prendre l&rsquo;option « Exécuter »
à partir du menu « Démarrer » puis taper <code>guile</code>.
</p>
<p>Néanmoins, tous les paquetages de LilyPond disposent d&rsquo;un bac à sable
Scheme, accessible par la commande :
</p><blockquote><pre class="example">lilypond scheme-sandbox
</pre></blockquote>

<p>Une fois le bac à sable actif, vous obtiendrez l&rsquo;invite :
</p><table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt;
</pre></td></tr></table>

<p>Vous pouvez dès à présent saisir des expressions Scheme pour vous
exercer.  Si vous souhaitez pouvoir utiliser la bibliothèque GNU
<code>readline</code>, qui offre une ligne de commande plus élaborée,
consultez les informations contenues dans le fichier
&lsquo;<tt>ly/scheme-sandbox.ly</tt>&rsquo;.  La bibliothèque <var>readline</var>, dans la
mesure où elle est habituellement activée dans vos sessions Guile,
devrait être effective y compris dans le bac à sable.
</p>

<hr size="6">
<a name="Scheme-et-les-variables"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme-sandbox" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Le bac à sable de Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-scheme" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Introduction à Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme-simple-data-types" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Types de données Scheme simples &gt; </a>]</td></tr></table>
<a name="scheme-variables"></a>
<h3 class="subsection">1.1.2 Scheme et les variables</h3>

<p>Une variable Scheme peut contenir n&rsquo;importe quelle valeur valide en
Scheme, y compris une procédure Scheme.
</p>
<p>Une variable Scheme se crée avec la fonction <code>define</code> :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (define a 2)
guile&gt;
</pre></td></tr></table>

<p>L&rsquo;évaluation d&rsquo;une variable Scheme se réalise en saisissant le nom de
cette variable à l&rsquo;invite de Guile :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; a
2
guile&gt;
</pre></td></tr></table>

<p>Une variable Scheme s&rsquo;affiche à l&rsquo;écran à l&rsquo;aide de la fonction
<code>display</code> :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (display a)
2guile&gt;
</pre></td></tr></table>

<p>Vous aurez remarqué que la valeur <code>2</code> et l&rsquo;invite <code>guile</code>
apparaissent sur une même ligne.  On peut améliorer la présentation à
l&rsquo;aide de la procédure <code>newline</code> ou bien en affichant un caractère
« retour chariot ».
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (display a)(newline)
2
guile&gt; (display a)(display &quot;\n&quot;)
2
guile&gt;
</pre></td></tr></table>

<p>Après avoir créé une variable, vous pouvez en modifier la valeur grâce à
un <code>set!</code> :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (set! a 12345)
guile&gt; a
12345
guile&gt;
</pre></td></tr></table>

<p>Vous quitterez proprement le bac à sable à l&rsquo;aide de l&rsquo;instruction
<code>quit</code> :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (quit)
</pre></td></tr></table>


<hr size="6">
<a name="Types-de-donn_00e9es-Scheme-simples"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme-variables" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Scheme et les variables&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-scheme" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Introduction à Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme-compound-data-types" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Types de données Scheme composites &gt; </a>]</td></tr></table>
<a name="scheme-simple-data-types"></a>
<h3 class="subsection">1.1.3 Types de données Scheme simples</h3>

<p>L&rsquo;un des concepts de base de tout langage est la saisie de données,
qu&rsquo;il s&rsquo;agisse de nombres, de chaînes de caractères, de listes, etc.
Voici les différents types de données Scheme simples utilisées
couramment dans LilyPond.
</p>
<dl compact="compact">
<dt> Booléens</dt>
<dd><p>Les valeurs booléennes sont vrai ou faux.  En Scheme, ce sera <code>#t</code>
pour vrai, et <code>#f</code> pour faux.
<a name="index-_0023_0023t"></a>
<a name="index-_0023_0023t-1"></a>
<a name="index-_0023_0023f"></a>
<a name="index-_0023_0023f-1"></a>
</p>
</dd>
<dt> Nombres</dt>
<dd><p>Les nombres se saisissent le plus communément : <code>1</code> est le
nombre (entier) un, alors que <code>-1.5</code> est un nombre à virgule
flottante (un nombre non entier).
</p>
</dd>
<dt> Chaînes</dt>
<dd><p>Les chaînes de caractères sont bornées par des guillemets
informatiques :
</p>
<blockquote><pre class="example">&quot;ceci est une chaîne&quot;
</pre></blockquote>

<p>Une chaîne peut s&rsquo;étendre sur plusieurs lignes :
</p>
<blockquote><pre class="example">&quot;ceci
est
une chaîne&quot;
</pre></blockquote>

<p>auquel cas les retours à la ligne seront inclus dans la chaîne.
</p>
<p>Un caractère de retour à la ligne peut s&rsquo;ajouter dans la chaîne, sous la
forme d&rsquo;un <code>\n</code>.
</p>
<blockquote><pre class="example">&quot;ceci\nest une\nchaîne multiligne&quot;
</pre></blockquote>

<p>Guillemets et obliques inverses dans une chaîne doivent être précédés
d&rsquo;une oblique inverse.  La chaîne <code>\a dit &quot;b&quot;</code> se saisit donc
</p>
<blockquote><pre class="example">&quot;\\a dit \&quot;b\&quot;&quot;
</pre></blockquote>

</dd>
</dl>

<p>Il existe bien d&rsquo;autres types de données Scheme, dont nous ne parlerons
pas ici.  Vous en trouverez une liste exhaustive dans le guide de
référence de Guile, à la page
<a href="http://www.gnu.org/software/guile/manual/html_node/Simple-Data-Types.html">http://www.gnu.org/software/guile/manual/html_node/Simple-Data-Types.html</a>.
</p>

<hr size="6">
<a name="Types-de-donn_00e9es-Scheme-composites"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme-simple-data-types" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Types de données Scheme simples&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-scheme" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Introduction à Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#pairs" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Paires &gt; </a>]</td></tr></table>
<a name="scheme-compound-data-types"></a>
<h3 class="subsection">1.1.4 Types de données Scheme composites</h3>

<p>Scheme prend aussi en charge des types de données composites.  LilyPond
utilise beaucoup les paires, listes, listes associatives et tables de
hachage.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#pairs" accesskey="1">Paires</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lists" accesskey="2">Listes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#association-lists-_0028alists_0029" accesskey="3">Listes associatives (alists)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#hash-tables" accesskey="4">Tables de hachage</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Paires"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme-compound-data-types" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Types de données Scheme composites&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-compound-data-types" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Types de données Scheme composites&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lists" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Listes &gt; </a>]</td></tr></table>
<a name="pairs"></a>
<h4 class="unnumberedsubsubsec">Paires</h4>

<p>Le type de donnée composite fondamental est la paire (<code>pair</code>).
Comme son nom l&rsquo;indique, il s&rsquo;agit de lier deux valeurs, à l&rsquo;aide de
l&rsquo;opérateur <code>cons</code>.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (cons 4 5)
(4 . 5)
guile&gt;
</pre></td></tr></table>

<p>Vous aurez noté que la paire s&rsquo;affiche sous la forme de deux éléments
bornés par des parenthèses et séparés par une espace, un point
(<code>.</code>) et une autre espace.  Le point n&rsquo;est en aucune manière un
séparateur décimal ; il s&rsquo;agit de l&rsquo;indicateur d&rsquo;une paire.
</p>
<p>Vous pouvez aussi saisir littéralement les valeurs d&rsquo;une paire, en la
faisant précéder d&rsquo;une apostrophe.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; '(4 . 5)
(4 . 5)
guile&gt;
</pre></td></tr></table>

<p>Les deux éléments d&rsquo;une paire peuvent être constitués de n&rsquo;importe
quelle valeur Scheme valide :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (cons #t #f)
(#t . #f)
guile&gt; '(&quot;blah-blah&quot; . 3.1415926535)
(&quot;blah-blah&quot; . 3.1415926535)
guile&gt;
</pre></td></tr></table>

<p>Les premier et second éléments de la paire sont accessibles à l&rsquo;aide des
procédures Scheme <code>car</code> et <code>cdr</code>.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (define mypair (cons 123 &quot;hello there&quot;)
&hellip; )
guile&gt; (car mypair)
123
guile&gt; (cdr mypair)
&quot;hello there&quot;
guile&gt;
</pre></td></tr></table>


<p>Note : <code>cdr</code> se prononce « couldeur », comme l&rsquo;indiquent Sussman et
Abelson &ndash; voir
<a href="http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#footnote_Temp_133">http://mitpress.mit.edu/sicp/full-text/book/book-Z-H-14.html#footnote_Temp_133</a>.
</p>

<hr size="6">
<a name="Listes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#pairs" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Paires&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-compound-data-types" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Types de données Scheme composites&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#association-lists-_0028alists_0029" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Listes associatives (alists) &gt; </a>]</td></tr></table>
<a name="lists"></a>
<h4 class="unnumberedsubsubsec">Listes</h4>

<p>Autre structure de donnée commune en Scheme : la liste (<em>list</em>).
Une liste « correcte » se définit comme étant vide (représentée par
<code>'()</code> et de longueur 0) ou une paire dont le <code>cdr</code> est une
liste.
</p>
<p>Il existe plusieurs méthodes pour créer une liste, la plus courante
étant l&rsquo;utilisation de la procédure <code>list</code> :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (list 1 2 3 &quot;abc&quot; 17.5)
(1 2 3 &quot;abc&quot; 17.5)
</pre></td></tr></table>

<p>La représentation d&rsquo;une liste par la succession de ses éléments, séparés
par des espaces, bornée par des parenthèses, n&rsquo;est en fait qu&rsquo;une vue
compacte des paires qui la constituent.  Les paires sont ainsi
dépourvues du point de séparation et de la parenthèse ouvrante qui le
suit et des parenthèses fermantes.  Sans ce « compactage », cette liste
serait ainsi présentée :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">(1 . (2 . (3 . (&quot;abc&quot; . (17.5 . ())))))
</pre></td></tr></table>

<p>Vous pouvez donc saisir une liste comme elle serrait présentée, en
entourant ses éléments par des parenthèses à la suite d&rsquo;une apostrophe
(afin que ce qui suit ne soit pas interprété comme un appel à une
fonction) :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; '(17 23 &quot;foo&quot; &quot;bar&quot; &quot;bazzle&quot;)
(17 23 &quot;foo&quot; &quot;bar&quot; &quot;bazzle&quot;)
</pre></td></tr></table>

<p>Les listes ont une importance considérable en Scheme.  Certains vont
d&rsquo;ailleurs jusqu&rsquo;à considérer Scheme comme un dialecte du lisp, où
« lisp » serait une abréviation de « List Processing ».  Il est vrai
que toute expression Scheme est une liste.
</p>

<hr size="6">
<a name="Listes-associatives-_0028alists_0029"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lists" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Listes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-compound-data-types" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Types de données Scheme composites&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#hash-tables" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Tables de hachage &gt; </a>]</td></tr></table>
<a name="association-lists-_0028alists_0029"></a>
<h4 class="unnumberedsubsubsec">Listes associatives (alists)</h4>

<p>Il existe un type particulier de liste : la <em>liste associative</em> &ndash;
ou <em>alist</em>.  Une <em>alist</em> permet de stocker des données dans le
but de les réutiliser.
</p>
<p>Une liste associative est une liste dont les éléments sont des paires.
Le <code>car</code> de chacun des éléments constitue une clé (<em>key</em>) et
chaque <code>cdr</code> une valeur (<em>value</em>).  La procédure Scheme
<code>assoc</code> permet de retrouver une entrée de la liste
associative ; son <code>cdr</code> en fournira la valeur :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (define mon-alist '((1  . &quot;A&quot;) (2 . &quot;B&quot;) (3 . &quot;C&quot;)))
guile&gt; mon-alist
((1 . &quot;A&quot;) (2 . &quot;B&quot;) (3 . &quot;C&quot;))
guile&gt; (assoc 2 mon-alist)
(2 . &quot;B&quot;)
guile&gt; (cdr (assoc 2 mon-alist))
&quot;B&quot;
guile&gt;
</pre></td></tr></table>

<p>LilyPond recourt abondamment aux <em>alists</em> pour stocker des
propriétés ou autres données.
</p>

<hr size="6">
<a name="Tables-de-hachage"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#association-lists-_0028alists_0029" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Listes associatives (alists)&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-compound-data-types" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Types de données Scheme composites&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#calculations-in-scheme" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Scheme et les calculs &gt; </a>]</td></tr></table>
<a name="hash-tables"></a>
<h4 class="unnumberedsubsubsec">Tables de hachage</h4>

<p>Il s&rsquo;agit d&rsquo;une structure de données à laquelle LilyPond fait parfois
appel.  Une table de hachage (<em>hash table</em>) peut se comparer à une
matrice ou un tableau dont l&rsquo;index peut être n&rsquo;importe quel type de
valeur Scheme et ne se limitant pas à des nombres entiers.
</p>
<p>Les tables de hachage sont un moyen plus efficace que les listes
associatives lorsqu&rsquo;il s&rsquo;agit d&rsquo;enregistrer de nombreuses données qui ne
changeront que peu fréquemment.
</p>
<p>La syntaxe permettant de créer une table de hachage peut paraître
complexe, mais vous en trouverez de nombreux exemples dans les sources
de LilyPond.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (define h (make-hash-table 10))
guile&gt; h
#&lt;hash-table 0/31&gt;
guile&gt; (hashq-set! h 'cle1 &quot;valeur1&quot;)
&quot;valeur1&quot;
guile&gt; (hashq-set! h 'key2 &quot;valeur2&quot;)
&quot;valeur2&quot;
guile&gt; (hashq-set! h 3 &quot;valeur3&quot;)
&quot;valeur3&quot;
</pre></td></tr></table>

<p>La procédure <code>hashq-ref</code> permet de récupérer une valeur dans la
table de hachage.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (hashq-ref h 3)
&quot;valeur3&quot;
guile&gt; (hashq-ref h 'cle2)
&quot;valeur2&quot;
guile&gt;
</pre></td></tr></table>

<p>La procédure <code>hashq-get-handle</code> permet de retrouver à la fois une
clé et sa valeur.  Cette procédure a l&rsquo;avantage de renvoyer <code>#f</code>
lorsque la clé n&rsquo;existe pas.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (hashq-get-handle h 'cle1)
(cle1 . &quot;valeur1&quot;)
guile&gt; (hashq-get-handle h 'zut)
#f
guile&gt;
</pre></td></tr></table>


<hr size="6">
<a name="Scheme-et-les-calculs"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#hash-tables" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Tables de hachage&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-scheme" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Introduction à Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme-procedures" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Scheme et les procédures &gt; </a>]</td></tr></table>
<a name="calculations-in-scheme"></a>
<h3 class="subsection">1.1.5 Scheme et les calculs</h3>


<p>Scheme permet aussi d&rsquo;effectuer des calculs.  Il utilise alors un
<em>préfixe</em>.  Additionner 1 et 2 s&rsquo;écrira <code>(+ 1 2)</code> et
non <em>1+2</em> comme on aurait pu s&rsquo;y attendre.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (+ 1 2)
3
</pre></td></tr></table>

<p>Les calculs peuvent s&rsquo;imbriquer ; le résultat d&rsquo;une fonction peut
servir pour un autre calcul.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (+ 1 (* 3 4))
13
</pre></td></tr></table>

<p>Ces calculs sont un exemple d&rsquo;évaluation : une expression telle que
<code>(* 3 4)</code> est remplacée par sa valeur, soit <code>12</code>.
</p>
<p>En matière de calcul, Scheme fait la différence entre des nombres entiers
ou non.  Les calculs sur des nombres entiers seront exacts, alors que
s&rsquo;il s&rsquo;agit de nombres non entiers, les calculs tiendront compte de la
précision mentionnée :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (/ 7 3)
7/3
guile&gt; (/ 7.0 3.0)
2.33333333333333
</pre></td></tr></table>

<p>Lorsque l&rsquo;interpréteur Scheme rencontre une expression sous forme de
liste, le premier élément de cette liste est considéré en tant que
procédure qui prendra en argument le restant de la liste.  C&rsquo;est la
raison pour laquelle, en Scheme, tous les opérateurs sont en préfixe.
</p>
<p>Le fait que le premier élément d&rsquo;une expression Scheme sous forme de
liste ne soit pas un opérateur ou une procédure déclenchera une
erreur de la part de l&rsquo;interpréteur :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (1 2 3)

Backtrace:
In current input:
  52: 0* [1 2 3]

&lt;unnamed port&gt;:52:1: In expression (1 2 3):
&lt;unnamed port&gt;:52:1: Wrong type to apply: 1
ABORT: (misc-error)
guile&gt;
</pre></td></tr></table>

<p>Vous pouvez constater que l&rsquo;interpréteur a tenté de considérer <code>1</code>
comme étant un opérateur ou une procédure, ce qu&rsquo;il n&rsquo;a pu réaliser.  Il
a donc renvoyé l&rsquo;erreur « Wrong type to apply: 1 » (<em>Application
d&rsquo;un type erroné : 1</em>).
</p>
<p>C&rsquo;est pourquoi il est impératif, pour créer une liste, soit d&rsquo;utiliser
l&rsquo;opérateur consacré (<code>list</code>), soit de faire précéder la liste
d&rsquo;une apostrophe, de telle sorte que l&rsquo;interpréteur ne tente pas de
l&rsquo;évaluer.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (list 1 2 3)
(1 2 3)
guile&gt; '(1 2 3)
(1 2 3)
guile&gt;
</pre></td></tr></table>

<p>Vous pourrez être confronté à cette erreur lorsque vous intégrerez
Scheme à LilyPond.
</p>


<hr size="6">
<a name="Scheme-et-les-proc_00e9dures"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#calculations-in-scheme" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Scheme et les calculs&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-scheme" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Introduction à Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#defining-procedures" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Définition de procédures &gt; </a>]</td></tr></table>
<a name="scheme-procedures"></a>
<h3 class="subsection">1.1.6 Scheme et les procédures</h3>

<p>Une procédure Scheme est une expression Scheme qui renverra une valeur
issue de son exécution.  Les procédures Scheme sont capables de
manipuler des variables qui ne sont pas définies en leur sein.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#defining-procedures" accesskey="1">Définition de procédures</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#predicates" accesskey="2">Prédicats</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#return-values" accesskey="3">Valeurs de retour</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="D_00e9finition-de-proc_00e9dures"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme-procedures" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Scheme et les procédures&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-procedures" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et les procédures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#predicates" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Prédicats &gt; </a>]</td></tr></table>
<a name="defining-procedures"></a>
<h4 class="unnumberedsubsubsec">Définition de procédures</h4>

<p>En Scheme, on définit une procédure à l&rsquo;aide de l&rsquo;instruction
<code>define</code> :
</p>
<blockquote><pre class="example">(define (nom-fonction argument1 argument2&hellip; argumentn)
 expression-scheme-qui-donnera-une-valeur-en-retour)
</pre></blockquote>

<p>Nous pourrions, par exemple, définir une procédure calculant la moyenne
de deux nombres :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (define (moyenne x y) (/ (+ x y) 2))
guile&gt; moyenne
#&lt;procedure moyenne (x y)&gt;
</pre></td></tr></table>

<p>Une fois la procédure définie, on l&rsquo;appelle en la faisant suivre, dans
une liste, des arguments qui doivent l&rsquo;accompagner.  Calculons
maintenant la moyenne de 3 et 12 :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (moyenne 3 12)
15/2
</pre></td></tr></table>


<hr size="6">
<a name="Pr_00e9dicats"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#defining-procedures" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Définition de procédures&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-procedures" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et les procédures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#return-values" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Valeurs de retour &gt; </a>]</td></tr></table>
<a name="predicates"></a>
<h4 class="unnumberedsubsubsec">Prédicats</h4>

<p>Une procédure Scheme chargée de retourner une valeur booléenne s&rsquo;appelle
un « prédicat » (<em>predicate</em>).  Par convention, plutôt que par
nécessité, le nom d&rsquo;un prédicat se termine par un point
d&rsquo;interrogation :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (define (moins-de-dix? x) (&lt; x 10))
guile&gt; (moins-de-dix? 9)
#t
guile&gt; (moins-de-dix? 15)
#f
</pre></td></tr></table>


<hr size="6">
<a name="Valeurs-de-retour"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#predicates" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Prédicats&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-procedures" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et les procédures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme-conditionals" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Scheme et les conditions &gt; </a>]</td></tr></table>
<a name="return-values"></a>
<h4 class="unnumberedsubsubsec">Valeurs de retour</h4>

<p>Une procédure Scheme doit toujours renvoyer une valeur de retour, en
l&rsquo;occurrence la valeur de la dernière expression exécutée par cette
procédure.  La valeur de retour sera une valeur Scheme valide, y compris
une structure de donnée complexe ou une procédure.
</p>
<p>On peut avoir besoin de regrouper plusieurs expressions Scheme dans une
même procédure.  Deux méthodes permettent de combiner des expressions
multiples.  La première consiste à utiliser la procédure <code>begin</code>,
qui permet l&rsquo;évaluation de plusieurs expressions et renvoie la valeur de
la dernière expression.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (begin (+ 1 2) (- 5 8) (* 2 2))
4
</pre></td></tr></table>

<p>Une deuxième méthode consiste à combiner les expressions dans un bloc
<code>let</code>.  Ceci aura pour effet de créer une série de liens, puis
d&rsquo;évaluer en séquence les expressions susceptibles d&rsquo;inclure ces
liens.  La valeur renvoyée par un bloc <em>let</em> est la valeur de
retour de la dernière clause de ce bloc :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (let ((x 2) (y 3) (z 4)) (display (+ x y)) (display (- z 4))
&hellip; (+ (* x y) (/ z x)))
508
</pre></td></tr></table>


<hr size="6">
<a name="Scheme-et-les-conditions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#return-values" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Valeurs de retour&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-scheme" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Introduction à Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#if" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;if &gt; </a>]</td></tr></table>
<a name="scheme-conditionals"></a>
<h3 class="subsection">1.1.7 Scheme et les conditions</h3>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#if" accesskey="1">if</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#cond" accesskey="2">cond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="if"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme-conditionals" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Scheme et les conditions&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-conditionals" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et les conditions&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#cond" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;cond &gt; </a>]</td></tr></table>
<a name="if"></a>
<h4 class="unnumberedsubsubsec">if</h4>

<p>Scheme dispose d&rsquo;une procédure <code>if</code> :
</p>
<blockquote><pre class="example">(if expression-test expression-affirmative expression-négative)
</pre></blockquote>

<p><var>expression-test</var> est une expression qui renverra une valeur
booléenne.  Dans le cas où <var>expression-test</var> retourne <code>#t</code>, la
procédure <code>if</code> renvoie la valeur de <var>expression-affirmative</var>,
et celle de <var>expression-négative</var> dans le cas contraire.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (define a 3)
guile&gt; (define b 5)
guile&gt; (if (&gt; a b) &quot;a est plus grand que b&quot; &quot;a n'est pas plus grand que b&quot;)
&quot;a n'est pas plus grand que b&quot;
</pre></td></tr></table>


<hr size="6">
<a name="cond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#if" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; if&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-conditionals" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et les conditions&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme-in-lilypond" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Scheme et LilyPond &gt; </a>]</td></tr></table>
<a name="cond"></a>
<h4 class="unnumberedsubsubsec">cond</h4>

<p>Une autre manière d&rsquo;introduire une condition en Scheme est d&rsquo;utiliser
l&rsquo;instruction <code>cond</code> :
</p>
<blockquote><pre class="example">(cond (expression-test-1 expression-résultat-séquence-1)
      (expression-test-2 expression-résultat-séquence-2)
      &hellip;
      (expression-test-n expression-résultat-séquence-n))
</pre></blockquote>

<p>Comme par exemple ici :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">guile&gt; (define a 6)
guile&gt; (define b 8)
guile&gt; (cond ((&lt; a b) &quot;a est plus petit que b&quot;)
&hellip;          ((= a b) &quot;a égale b&quot;)
&hellip;          ((&gt; a b) &quot;a est plus grand que b&quot;))
&quot;a est plus petit que b&quot;
</pre></td></tr></table>


<hr size="6">
<a name="Scheme-et-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#cond" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; cond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#tutoriel-scheme" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-scheme-syntax" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Syntaxe Scheme dans LilyPond &gt; </a>]</td></tr></table>
<a name="scheme-in-lilypond"></a>
<h2 class="section">1.2 Scheme et LilyPond</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#lilypond-scheme-syntax" accesskey="1">1.2.1 Syntaxe Scheme dans LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lilypond-variables" accesskey="2">1.2.2 Variables LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#input-variables-and-scheme" accesskey="3">1.2.3 Saisie de variables et Scheme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#importing-scheme-in-lilypond" accesskey="4">1.2.4 Import de code Scheme dans LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#object-properties" accesskey="5">1.2.5 Propriétés des objets</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lilypond-compound-variables" accesskey="6">1.2.6 Variables LilyPond composites</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#internal-music-representation" accesskey="7">1.2.7 Représentation interne de la musique</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Syntaxe-Scheme-dans-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme-in-lilypond" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Scheme et LilyPond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-in-lilypond" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-variables" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Variables LilyPond &gt; </a>]</td></tr></table>
<a name="lilypond-scheme-syntax"></a>
<h3 class="subsection">1.2.1 Syntaxe Scheme dans LilyPond</h3>

<a name="index-_0024"></a>
<a name="index-_0024-1"></a>
<a name="index-_0023"></a>
<a name="index-_0023-1"></a>

<p>L&rsquo;installation de LilyPond comprenant l&rsquo;interpréteur Guile, les fichiers
source LilyPond peuvent contenir du Scheme.  Vous disposez de plusieurs
méthodes pour inclure du Scheme dans vos fichiers LilyPond.
</p>
<p>La méthode la plus simple consiste à insérer un <em>hash</em> (le caractère
<code>#</code>, improprement appelé dièse) avant l&rsquo;expression Scheme.
</p>
<p>Rappelons-nous qu&rsquo;un fichier source LilyPond est structuré en jetons et
expressions, tout comme le langage humain est structuré en mots et
phrases.  LilyPond dispose d&rsquo;un analyseur lexical (appelé <em>lexer</em>)
qui sait identifier les jetons &ndash; nombres, chaînes, éléments Scheme,
hauteurs, etc. &ndash; ainsi que d&rsquo;un analyseur syntaxique (appelé
<em>parser</em>) &ndash; voir
<a name="index-LilyPond-grammar"></a>
<a href="contributor-big-page.html#lilypond-grammar">Grammaire de LilyPond</a>.  Dès lors
que le programme sait quelle règle grammaticale particulière doit
s&rsquo;appliquer, il exécute les consignes qui lui sont associées.
</p>
<p>Le recours à un <em>hash</em> pour mettre en exergue du Scheme est tout à
fait approprié.  Dès qu&rsquo;il rencontre un <code>#</code>, l&rsquo;analyseur lexical
passe le relais au lecteur Scheme qui va alors déchiffrer l&rsquo;intégralité
de l&rsquo;expression Scheme &ndash; ce peut être un identificateur, une expression
bornée par des parenthèses ou bien d&rsquo;autres choses encore.  Une fois
cette expression lue, elle est enregistrée en tant que valeur d&rsquo;un
élément grammatical <code>SCM_TOKEN</code>.  Puisque l&rsquo;analyseur syntaxique
sait comment traiter ce jeton, il charge Guile d&rsquo;évaluer l&rsquo;expression
Scheme.  Dans la mesure où le <em>parser</em> requiert une lecture en
avance de la part du <em>lexer</em> pour prendre une décision, cette
distinction entre lecture et évaluation &ndash; <em>lexer</em> et <em>parser</em>
&ndash; révèle toute sa pertinence lorsqu&rsquo;il s&rsquo;agit d&rsquo;exécuter conjointement
des expressions LilyPond et des expressions Scheme.  C&rsquo;est la raison
pour laquelle nous vous recommandons, dans toute la mesure du possible,
d&rsquo;utiliser un signe <em>hash</em> lorsque vous faites appel à Scheme.
</p>
<p>Une autre manière de faire appel à l&rsquo;interpréteur Scheme à partir de
LilyPond consiste à introduire une expression Scheme par un caractère
dollar au lieu d&rsquo;un caractère dièse &ndash; un <code>$</code> au lieu
d&rsquo;un <code>#</code>.  En pareil cas, LilyPond évalue le code dès sa lecture
par l&rsquo;analyseur lexical, vérifie le type d&rsquo;expression Scheme qui en
résulte et détermine un type de jeton (l&rsquo;un des <code>xxx_IDENTIFIER</code> de
la grammaire) qui lui corresponde, puis en fait une copie qui servira à
traiter la valeur de ce jeton.  Lorsque la valeur de l&rsquo;expression est
<em>void</em>, autrement dit une valeur Guile <code>*unspecified*</code> (pour
<em>non spécifiée</em>), aucune information n&rsquo;est transmise à l&rsquo;analyseur
grammatical.
</p>
<p>C&rsquo;est, en réalité, la manière dont LilyPond opère lorsque vous rappelez
une variable ou une fonction par son nom &ndash; au travers d&rsquo;un <code>\nom</code>
&ndash;, à la seule différence que sa finalité est déterminée par l&rsquo;analyseur
lexical de LilyPond sans consultation du lecteur Scheme ; le nom de
la variable rappelée doit donc être en corrélation avec le mode LilyPond
actif à ce moment là.
</p>
<p>L&rsquo;immédiateté de l&rsquo;opérateur <code>$</code> peut entraîner des effets
indésirables dont nous reparlerons à la rubrique
<a href="#input-variables-and-scheme">Saisie de variables et Scheme</a> ; aussi est-il préférable
d&rsquo;utiliser un <code>#</code> dès que l&rsquo;analyseur grammatical le supporte.
Dans le cadre d&rsquo;une expression musicale, une expression qui aura été
créée à l&rsquo;aide d&rsquo;un <code>#</code> sera interprétée comme étant de la musique.
Elle ne sera cependant pas recopiée avant utilisation.  Si la structure
qui l&rsquo;abrite devait être réutilisée, un appel expicite à
<code>ly:music-deep-copy</code> pourrait être requis.
</p>
<a name="index-_0024_0040"></a>
<a name="index-_0024_0040-1"></a>
<a name="index-_0023_0040"></a>
<a name="index-_0023_0040-1"></a>

<p>Les opérateurs <code>$@</code> et <code>#@</code> agissent comme des « colleurs de
liste » : leur fonction consiste à insérer tous les éléments d&rsquo;une liste
dans le contexte environnant.
</p>
<p>Examinons à présent du vrai code Scheme.  Nous pouvons définir des
procédures Scheme au milieu d&rsquo;un fichier source LilyPond :
</p>
<blockquote><pre class="example">#(define (moyenne a b c) (/ (+ a b c) 3))
</pre></blockquote>

<p>Pour mémoire, vous noterez que les commentaires LilyPond (<code>%</code> ou
<code>%{…%}</code>) ne peuvent s&rsquo;utiliser dans du code Scheme, même si
celui-ci se trouve au sein d&rsquo;un fichier LilyPond.  Ceci tient au fait
que l&rsquo;expression Scheme est lue par l&rsquo;interpréteur Guile, et en aucune
façon par l&rsquo;analyseur lexical de LilyPond.  Voici comment introduire des
commentaires dans votre code Scheme :
</p>
<blockquote><pre class="example">; ceci n'est qu'une simple ligne de commentaire

#!
  Ceci constitue un bloc de commentaire (non imbricable)
  dans le style Guile.
  En fait, les Schemeurs les utilisent très rarement,
  et vous n'en trouverez jamais dans le code source
  de LilyPond.
!#
</pre></blockquote>

<p>Dans la suite de notre propos, nous partons du principe que les données
sont incluses dans un fichier musical, aussi toutes les expressions
Scheme seront introduites par un <code>#</code>.
</p>
<p>Toutes les expressions Scheme de haut niveau incluses dans un fichier
LilyPond peuvent se combiner en une expression Scheme unique à l&rsquo;aide de
la clause <code>begin</code> :
</p>
<blockquote><pre class="example">#(begin
  (define foo 0)
  (define bar 1))
</pre></blockquote>


<hr size="6">
<a name="Variables-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-scheme-syntax" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Syntaxe Scheme dans LilyPond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-in-lilypond" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#input-variables-and-scheme" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Saisie de variables et Scheme &gt; </a>]</td></tr></table>
<a name="lilypond-variables"></a>
<h3 class="subsection">1.2.2 Variables LilyPond</h3>

<p>Les variables LilyPond sont enregistrées en interne sous la forme de
variables Scheme.  Ainsi,
</p>
<blockquote><pre class="example">douze = 12
</pre></blockquote>

<p>est équivalant à
</p>
<blockquote><pre class="example">#(define douze 12)
</pre></blockquote>

<p>Ceci a pour conséquence que toute variable LilyPond peut être utilisée
dans une expression Scheme.  Par exemple, nous pourrions dire
</p>
<blockquote><pre class="example">vingtQuatre = #(* 2 douze)
</pre></blockquote>

<p>ce qui aurait pour conséquence que le nombre <em>24</em> sera stocké dans
la variable LilyPond (et Scheme) <code>vingtQuatre</code>.
</p>
<p>Scheme autorise la modification d&rsquo;expressions complexes au fil de l&rsquo;eau,
ce que réalise LilyPond dans le cadre des fonctions musicales.
Toutefois, lorsqu&rsquo;une expression musicale est stockée dans une variable,
plutôt que saisie au fur et à mesure, on s&rsquo;attend, alors qu&rsquo;elle est
passée à une fonction musicale, à ce que sa valeur originale ne soit en
rien modifiée.  C&rsquo;est la raison pour laquelle faire référence à une
variable à l&rsquo;aide d&rsquo;une oblique inverse &ndash; autrement dit saisir
<code>\vingtQuatre</code> &ndash; aura pour effet que LilyPond créera une copie de
la valeur musicale de cette variable aux fins de l&rsquo;utiliser au sein de
l&rsquo;expression musicale au lieu d&rsquo;utiliser directement la valeur de cette
variable.
</p>
<p>Par voie de conséquence, une expression musicale introduite par <code>#</code>
ne devrait pas contenir de matériau inexistant auparavant ou bien
littéralement recopié, mais plutôt une référence explicite.
</p>
<a name="Voir-aussi-1"></a>
<h4 class="subsubheading">Voir aussi</h4>
<p>Manuel d&rsquo;extension :
<a href="#lilypond-scheme-syntax">Syntaxe Scheme dans LilyPond</a>.
</p>

<hr size="6">
<a name="Saisie-de-variables-et-Scheme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-variables" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Variables LilyPond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-in-lilypond" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#importing-scheme-in-lilypond" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Import de code Scheme dans LilyPond &gt; </a>]</td></tr></table>
<a name="input-variables-and-scheme"></a>
<h3 class="subsection">1.2.3 Saisie de variables et Scheme</h3>

<p>Le format de saisie prend en charge la notion de variable &ndash; ou
identificateur.  Dans l&rsquo;exemple suivant, une expression musicale se voit
attribuer un identificateur qui portera le nom de <code>traLaLa</code>.
</p>
<blockquote><pre class="example">traLaLa = { c'4 d'4 }
</pre></blockquote>


<p>Une variable a aussi une portée.  Dans l&rsquo;exemple suivant, le bloc
<code>\layout</code> contient une variable <code>traLaLa</code> tout à fait
indépendante de l&rsquo;autre <code>\traLaLa</code>.
</p>
<blockquote><pre class="example">traLaLa = { c'4 d'4 }
\layout { traLaLa = 1.0 }
</pre></blockquote>

<p>Dans les faits, chaque fichier a un domaine de compétence, et les
différents blocs <code>\header</code>, <code>\midi</code> et <code>\layout</code> ont leur
propre champ de compétence, imbriqué dans ce domaine principal.
</p>
<p>Variables et champs de compétence sont implémentés par le système de
modules de Guile.  Un module anonyme Scheme est attaché à chacun de ces
domaines.  Une assertion telle que
</p>
<blockquote><pre class="example">traLaLa = { c'4 d'4 }
</pre></blockquote>

<p>est convertie, en interne, en une définition Scheme :
</p>
<blockquote><pre class="example">(define traLaLa <var>valeur Scheme de `<code>&hellip;</code>'</var>)
</pre></blockquote>

<p>Cela signifie que variables LilyPond et variables Scheme peuvent tout à
fait se mélanger.  Dans l&rsquo;exemple suivant, un fragment musical est
stocké dans la variable <code>traLaLa</code> puis dupliqué à l&rsquo;aide de Scheme.
Le résultat est alors importé dans un bloc <code>\score</code> au moyen d&rsquo;une
seconde variable <code>twice</code>.
</p>
<pre class="verbatim">traLaLa = { c'4 d'4 }

#(define newLa (map ly:music-deep-copy
  (list traLaLa traLaLa)))
#(define twice
  (make-sequential-music newLa))

\twice
</pre><p>
 <a href="24/lily-4302bdaa.ly">
  <img align="middle"
       border="0"
       src="24/lily-4302bdaa.png"
       alt="[image of music]">
 </a>
</p>




<p>Cet exemple est particulièrement intéressant.  L&rsquo;assignation
n&rsquo;interviendra qu&rsquo;une fois que l&rsquo;analyseur grammatical aura l&rsquo;assurance
que rien du type de <code>\addlyrics</code> ne suit ; il doit donc
vérifier ce qui vient après.  Le <em>parser</em> lit le <code>#</code> et
l&rsquo;expression Scheme qui le suit <strong>sans</strong> l&rsquo;évaluer, de telle sorte
qu&rsquo;il peut procéder à l&rsquo;assignation, et <strong>ensuite</strong> exécuter le
code Scheme sans problème.
</p>

<hr size="6">
<a name="Import-de-code-Scheme-dans-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#input-variables-and-scheme" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Saisie de variables et Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-in-lilypond" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#object-properties" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Propriétés des objets &gt; </a>]</td></tr></table>
<a name="importing-scheme-in-lilypond"></a>
<h3 class="subsection">1.2.4 Import de code Scheme dans LilyPond</h3>

<a name="index-_0024-2"></a>
<a name="index-_0024-3"></a>
<a name="index-_0023-2"></a>
<a name="index-_0023-3"></a>

<p>L&rsquo;exemple précédent illustre la manière « d&rsquo;exporter » une expression
musicale à partir des saisies et à destination de l&rsquo;interpréteur Scheme.
L&rsquo;inverse est aussi réalisable : en la plaçant derrière un <code>$</code>, une
valeur Scheme sera interprétée comme si elle avait été saisie en
syntaxe LilyPond.  Au lieu de définir <code>\twice</code>, nous aurions tout
aussi bien pu écrire
</p>
<blockquote><pre class="example">&hellip;
$(make-sequential-music (list newLa))
</pre></blockquote>

<p>Vous pouvez utiliser <code>$</code> suivi d&rsquo;une expression Scheme partout où
vous auriez utilisé <code>\<var>nom</var></code>, dès lors que vous aurez assigné à
cette expression Scheme le nom de variable <var>nom</var>.  La substitution
intervenant au niveau de l&rsquo;analyseur lexical (le <em>lexer</em>), LilyPond
ne saurait faire la différence.
</p>
<p>Cette manière de procéder comporte cependant un inconvénient au niveau
de la temporisation.  Si nous avions défini <code>newLa</code> avec un
<code>$</code> plutôt qu&rsquo;un <code>#</code>, la définition Scheme suivante aurait
échoué du fait que <code>traLaLa</code> n&rsquo;était pas encore défini.  Pour plus
d&rsquo;information quant au problème de synchronisation, voir la rubrique
<a href="#lilypond-scheme-syntax">Syntaxe Scheme dans LilyPond</a>.
</p>
<a name="index-_0024_0040-2"></a>
<a name="index-_0024_0040-3"></a>
<a name="index-_0023_0040-2"></a>
<a name="index-_0023_0040-3"></a>

<p>Une autre façon de procéder serait de recourir aux « colleurs de liste »
<code>$@</code> et <code>#@</code> dont la fonction est d&rsquo;insérer les éléments
d&rsquo;une liste dans le contexte environnant.  Grâce à ces opérateurs, la
dernière partie de notre fonction pourrait s&rsquo;écrire ainsi :
</p>
<blockquote><pre class="example">&hellip;
{ #@newLa }
</pre></blockquote>

<p>Ici, chaque élément de la liste stockée dans <code>newLa</code> est pris à
son tour et inséré dans la liste, tout comme si nous avions écrit
</p>
<blockquote><pre class="example">{ #(premier newLa) #(deuxième newLa) }
</pre></blockquote>

<p>Dans ces deux dernières formes, le code Scheme est évalué alors même que
le code initial est en cours de traitement, que ce soit par le
<em>lexer</em> ou par le <em>parser</em>.  Si le code Scheme ne doit être
exécuté que plus tard, consultez la rubrique
<a href="#void-scheme-functions">Fonctions Scheme fantômes</a>, ou stockez le dans une procédure comme
ici :
</p>
<blockquote><pre class="example">#(define (nopc)
  (ly:set-option 'point-and-click #f))

&hellip;
#(nopc)
{ c'4 }
</pre></blockquote>

<a name="Problemes-connus-et-avertissements"></a>
<h4 class="subsubheading">Problèmes connus et avertissements</h4>
<p>L&rsquo;imbrication de variables Scheme et LilyPond n&rsquo;est pas possible
avec l&rsquo;option &lsquo;<samp>--safe</samp>&rsquo;.
</p>

<hr size="6">
<a name="Propri_00e9t_00e9s-des-objets"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#importing-scheme-in-lilypond" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Import de code Scheme dans LilyPond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-in-lilypond" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-compound-variables" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Variables LilyPond composites &gt; </a>]</td></tr></table>
<a name="object-properties"></a>
<h3 class="subsection">1.2.5 Propriétés des objets</h3>

<p>Les propriétés des objets sont stockées dans LilyPond sous la forme
d&rsquo;enchaînements de listes associatives, autrement dit des listes de
listes associatives.  Une propriété se détermine par l&rsquo;ajout de valeurs
en début de liste de cette propriété.  Les caractéristiques d&rsquo;une
propriété s&rsquo;ajustent donc à la lecture des différentes valeurs des
listes associatives.
</p>
<p>La modification d&rsquo;une valeur pour une propriété donnée requiert
l&rsquo;assignation d&rsquo;une valeur de la liste associative, tant pour la clé que
pour la valeur associée.  Voici comment procéder selon la syntaxe de
LilyPond :
</p>
<blockquote><pre class="example">\override Stem.thickness = #2.6
</pre></blockquote>

<p>Cette instruction ajuste l&rsquo;apparence des hampes.  Une entrée
<code>'(thickness . 2.6)</code> de la <em>alist</em> est ajoutée à la liste
de la propriété de l&rsquo;objet <code>Stem</code>.  <code>thickness</code> devant
s&rsquo;exprimer en unité d&rsquo;épaisseur de ligne, les hampes auront donc une
épaisseur de 2,6 ligne de portée, et à peu près le double de leur
épaisseur normale.  Afin de faire la distinction entre les variables que
vous définissez au fil de vos fichiers &ndash; tel le <code>vingtQuatre</code> que
nous avons vu plus haut &ndash; et les variables internes des objets, nous
parlerons de « propriétés » pour ces dernières, et de « variables »
pour les autres.  Ainsi, l&rsquo;objet hampe possède une propriété
<code>thickness</code>, alors que <code>vingtQuatre</code> est une variable.
</p>
<a name="index-proprietes-ou-variables"></a>
<a name="index-variables-ou-proprietes"></a>



<hr size="6">
<a name="Variables-LilyPond-composites"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#object-properties" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Propriétés des objets&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-in-lilypond" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#offsets" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Décalages (offsets) &gt; </a>]</td></tr></table>
<a name="lilypond-compound-variables"></a>
<h3 class="subsection">1.2.6 Variables LilyPond composites</h3>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#offsets" accesskey="1">Décalages (<em>offsets</em>)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#fractions" accesskey="2">Fractions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#extents" accesskey="3">Étendues (<em>extents</em>)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#property-alists" accesskey="4">Propriété en <em>alists</em></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#alist-chains" accesskey="5">Chaînes d&rsquo;<em>alist</em></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="D_00e9calages-_0028offsets_0029"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-compound-variables" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Variables LilyPond composites&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-compound-variables" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Variables LilyPond composites&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#fractions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fractions &gt; </a>]</td></tr></table>
<a name="offsets"></a>
<h4 class="unnumberedsubsubsec">Décalages (<em>offsets</em>)</h4>

<p>Les décalages (<em>offset</em>) sur deux axes (coordonnées X et Y) sont
stockés sous forme de <em>paires</em>. Le <code>car</code> de l&rsquo;offset
correspond à l&rsquo;abscisse (coordonnée X) et le <code>cdr</code> à l&rsquo;ordonnée
(coordonnée Y).
</p>
<blockquote><pre class="example">\override TextScript.extra-offset = #'(1 . 2)
</pre></blockquote>

<p>Cette clause affecte la paire <code>(1 . 2)</code> à la propriété
<code>extra-offset</code> de l&rsquo;objet <code>TextScript</code>.  Ces nombres sont
exprimés en espace de portée.  La commande aura donc pour effet de
déplacer l&rsquo;objet d&rsquo;un espace de portée vers la droite, et de deux
espaces vers le haut.
</p>
<p>Les procédures permettant de manipuler les offsets sont regroupées dans
le fichier &lsquo;<tt>scm/lily-library.scm</tt>&rsquo;.
</p>

<hr size="6">
<a name="Fractions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#offsets" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Décalages (offsets)&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-compound-variables" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Variables LilyPond composites&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#extents" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Étendues (extents) &gt; </a>]</td></tr></table>
<a name="fractions"></a>
<h4 class="unnumberedsubsubsec">Fractions</h4>

<p>Les fractions, telles que LilyPond les utilise, sont aussi stockées sous
forme de <em>paire</em>.  Alors que Scheme est tout à fait capable de
représenter des nombres rationnels, vous conviendrez que, musicalement
parlant, &lsquo;<samp>2/4</samp>&rsquo; et &lsquo;<samp>1/2</samp>&rsquo; ne se valent pas ; nous devrons
donc pouvoir les distinguer.  Dans le même ordre d&rsquo;idée, LilyPond ne
connaît pas les « fractions » négatives.  Pour ces raisons, <code>2/4</code>
en LilyPond correspond à <code>(2 . 4)</code> en Scheme, et <code>#2/4</code> en
LilyPond correspond à <code>1/2</code> en Scheme.
</p>

<hr size="6">
<a name="g_t_00c9tendues-_0028extents_0029"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#fractions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fractions&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-compound-variables" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Variables LilyPond composites&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#property-alists" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Propriété en alists &gt; </a>]</td></tr></table>
<a name="extents"></a>
<h4 class="unnumberedsubsubsec">Étendues (<em>extents</em>)</h4>

<p>Les paires permettent aussi de stocker des intervalles qui représentent
un ensemble de nombres compris entre un minimum (le <code>car</code>) et un
maximum (le <code>cdr</code>).  Ces intervalles stockent l&rsquo;étendue, tant au
niveau horizontal (X) que vertical (Y) des objets imprimables.  En
matière d&rsquo;étendue sur les X, le <code>car</code> correspond à la coordonnée de
l&rsquo;extrémité gauche, et le <code>cdr</code> à la coordonnée de l&rsquo;extrémité
droite.  En matière d&rsquo;étendue sur les Y, le <code>car</code> correspond à la
coordonnée de l&rsquo;extrémité basse, et le <code>cdr</code> à la coordonnée de
l&rsquo;extrémité haute.
</p>
<p>Les procédures permettant de manipuler les offsets sont regroupées dans
le fichier &lsquo;<tt>scm/lily-library.scm</tt>&rsquo;.  Nous vous recommandons
l&rsquo;utilisation de ces procédures dans toute la mesure du possible afin
d&rsquo;assurer la cohérence du code.
</p>

<hr size="6">
<a name="Propri_00e9t_00e9-en-alists"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#extents" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Étendues (extents)&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-compound-variables" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Variables LilyPond composites&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#alist-chains" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Chaînes d'alist &gt; </a>]</td></tr></table>
<a name="property-alists"></a>
<h4 class="unnumberedsubsubsec">Propriété en <em>alists</em></h4>

<p>Les propriétés en <em>alists</em> sont des structures de données
particulières à LilyPond.  Il s&rsquo;agit de listes associatives dont les
clés sont des propriétés et les valeurs des expressions Scheme
fournissant la valeur requise pour cette propriété.
</p>
<p>Les propriétés LilyPond sont des symboles Scheme, à l&rsquo;instar de
<code>'thickness</code>.
</p>

<hr size="6">
<a name="Cha_00eenes-d_0027alist"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#property-alists" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Propriété en alists&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-compound-variables" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Variables LilyPond composites&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#internal-music-representation" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Représentation interne de la musique &gt; </a>]</td></tr></table>
<a name="alist-chains"></a>
<h4 class="unnumberedsubsubsec">Chaînes d&rsquo;<em>alist</em></h4>

<p>Une chaîne d&rsquo;<em>alist</em> est une liste contenant les listes
associatives d&rsquo;une propriété.
</p>
<p>L&rsquo;intégralité du jeu de propriétés qui doivent s&rsquo;appliquer à un objet
graphique est en fait stocké en tant que chaîne d&rsquo;<em>alist</em>.  Afin
d&rsquo;obtenir la valeur d&rsquo;une propriété particulière qu&rsquo;un objet graphique
devrait avoir, on examinera chacune des listes associatives de la
chaîne, à la recherche d&rsquo;une entrée contenant la clé de cette propriété.
Est renvoyée la première entrée d&rsquo;<em>alist</em> trouvée, sa valeur étant
la valeur de la propriété.
</p>
<p>L&rsquo;obtention des valeurs de propriété des objets graphiques se réalise en
principe à l&rsquo;aide de la procédure Scheme <code>chain-assoc-get</code>.
</p>

<hr size="6">
<a name="Repr_00e9sentation-interne-de-la-musique"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#alist-chains" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Chaînes d'alist&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-in-lilypond" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Scheme et LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#building-complicated-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Construction de fonctions complexes &gt; </a>]</td></tr></table>
<a name="internal-music-representation"></a>
<h3 class="subsection">1.2.7 Représentation interne de la musique</h3>

<p>Dans les entrailles du programme, la musique se présente comme une liste
Scheme.  Cette liste comporte les différents éléments qui affecteront la
sortie imprimable.  L&rsquo;analyse grammaticale (l&rsquo;opération <em>parsing</em>)
est le processus chargé de convertir la musique représentée par le code
LilyPond en présentation interne Scheme.
</p>
<p>L&rsquo;analyse d&rsquo;une expression musicale se traduit par un jeu d&rsquo;objets
musicaux en Scheme.  Une objet musical est déterminé par le temps qu&rsquo;il
occupe, que l&rsquo;on appelle <em>durée</em>.  Les durées s&rsquo;expriment par des
nombres rationnels représentant la longueur d&rsquo;un objet musical par
rapport à la ronde.
</p>
<p>Un objet musical dispose de trois types :
</p><ul>
<li>
un nom de musique : toute expression musicale a un nom.  Par exemple,
une note amène à un <a name="index-NoteEvent"></a>
<a href="internals-big-page.html#noteevent">NoteEvent</a>, un <code>\simultaneous</code> à un
<a name="index-SimultaneousMusic"></a>
<a href="internals-big-page.html#simultaneousmusic">SimultaneousMusic</a>.  Une liste exhaustive des différentes
expressions est disponible dans la référence des propriétés internes, à
la rubrique <a name="index-Music-expressions"></a>
<a href="internals-big-page.html#music-expressions">Music expressions</a>.

</li><li>
un « type » ou interface : tout nom de musique dispose de
plusieurs types ou interfaces.  Ainsi, une note est tout à la fois un
<code>event</code>, un <code>note-event</code>, un <code>rhythmic-event</code> et un
<code>melodic-event</code>.  Les différentes classes musicales sont
répertoriées à la rubrique <a name="index-Music-classes"></a>
<a href="internals-big-page.html#music-classes">Music classes</a> de la référence
des propriétés internes.

</li><li>
un objet C++ : tout objet musical est représenté par un objet de la
classe C++ <code>Music</code>.
</li></ul>

<p>L&rsquo;information réelle d&rsquo;une expression musicale est enregistrée sous
forme de propriétés.  Par exemple, un <a name="index-NoteEvent-1"></a>
<a href="internals-big-page.html#noteevent">NoteEvent</a> dispose des
propriétés <code>pitch</code> et <code>duration</code>, respectivement chargées de
stocker la hauteur et la durée de cette note.  Les différentes
propriétés sont répertoriées à la rubrique <a name="index-Music-properties"></a>
<a href="internals-big-page.html#propri_00e9t_00e9s-musicales">Music properties</a>
de la référence des propriétés internes.
</p>
<p>Une expression composite est un objet musical dont les propriétés
contiennent d&rsquo;autres objets musicaux.  S&rsquo;il s&rsquo;agit d&rsquo;une liste d&rsquo;objets,
elle sera stockée dans la propriété <code>elements</code> d&rsquo;un objet
musical ; s&rsquo;il n&rsquo;y a qu&rsquo;un seul objet « enfant », il sera stocké
dans la propriété <code>element</code>.  Ainsi, par exemple, les enfants de
<a name="index-SequentialMusic"></a>
<a href="internals-big-page.html#sequentialmusic">SequentialMusic</a> iront dans <code>elements</code>, alors que
l&rsquo;argument unique de <a name="index-GraceMusic"></a>
<a href="internals-big-page.html#gracemusic">GraceMusic</a> ira dans <code>element</code>.
De même, le corps d&rsquo;une répétition ira dans la propriété <code>element</code>
d&rsquo;un <a name="index-RepeatedMusic"></a>
<a href="internals-big-page.html#repeatedmusic">RepeatedMusic</a>, les alternatives quant à elles dans la
propriété <code>elements</code>.
</p>

<hr size="6">
<a name="Construction-de-fonctions-complexes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#internal-music-representation" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Représentation interne de la musique&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#tutoriel-scheme" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#displaying-music-expressions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Affichage d'expressions musicales &gt; </a>]</td></tr></table>
<a name="building-complicated-functions"></a>
<h2 class="section">1.3 Construction de fonctions complexes</h2>

<p>Nous allons voir dans cette partie les moyens dont vous disposez pour
obtenir les informations qui vous permettront de créer vos propres
fonctions musicales complexes.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#displaying-music-expressions" accesskey="1">1.3.1 Affichage d&rsquo;expressions musicales</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#music-properties" accesskey="2">1.3.2 Propriétés musicales</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#doubling-a-note-with-slurs-_0028example_0029" accesskey="3">1.3.3 Doublement d&rsquo;une note avec liaison (exemple)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#adding-articulation-to-notes-_0028example_0029" accesskey="4">1.3.4 Ajout d&rsquo;articulation à des notes (exemple)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Affichage-d_0027expressions-musicales"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#building-complicated-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Construction de fonctions complexes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#building-complicated-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Construction de fonctions complexes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#music-properties" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Propriétés musicales &gt; </a>]</td></tr></table>
<a name="displaying-music-expressions"></a>
<h3 class="subsection">1.3.1 Affichage d&rsquo;expressions musicales</h3>

<a name="index-stockage-interne"></a>
<a name="index-expression-musicale_002c-affichage"></a>
<a name="index-representation-interne_002c-affichage"></a>
<a name="index-displayMusic"></a>
<a name="index-_005cdisplayMusic"></a>
<a name="index-_005cdisplayMusic-1"></a>

<p>Lorsque l&rsquo;on veut écrire une fonction musicale, il est intéressant
d&rsquo;examiner comment une expression musicale est représentée en interne.
Vous disposez à cet effet de la fonction musicale <code>\displayMusic</code>.
</p>
<blockquote><pre class="example">{
  \displayMusic { c'4\f }
}
</pre></blockquote>

<p>affichera
</p>
<blockquote><pre class="example">(make-music
  'SequentialMusic
  'elements
  (list (make-music
          'NoteEvent
          'articulations
          (list (make-music
                  'AbsoluteDynamicEvent
                  'text
                  &quot;f&quot;))
          'duration
          (ly:make-duration 2 0 1/1)
          'pitch
          (ly:make-pitch 0 0 0))))
</pre></blockquote>

<p>Par défaut, LilyPond affichera ces messages sur la console, parmi toutes
les autres informations.  Vous pouvez, afin de les isoler et de garder
le résultat des commandes <code>\display{TRUC}</code>, spécifier un
port optionnel à utiliser pour la sortie :
</p>
<blockquote><pre class="example">{
  \displayMusic #(open-output-file &quot;display.txt&quot;) { c'4\f }
}
</pre></blockquote>

<p>Ceci aura pour effet d&rsquo;écraser tout fichier précédemment généré.
Lorsque plusieurs expressions doivent être retranscrites, il suffit de
faire appel à une variable pour le port puis de la réutiliser :
</p>
<blockquote><pre class="example">{
  port = #(open-output-file &quot;display.txt&quot;)
  \displayMusic \port { c'4\f }
  \displayMusic \port { d'4 }
  #(close-output-port port)
}
</pre></blockquote>

<p>La documentation de Guile fournit une description détaillée des ports.
Clôturer un port n&rsquo;est requis que si vous désirez consulter le fichier
avant que LilyPond n&rsquo;ait fini, ce dont nous ne nous sommes pas préoccupé
dans le premier exemple.
</p>
<p>L&rsquo;information sera encore plus lisible après un peu de mise en forme :
</p>
<blockquote><pre class="example">(make-music 'SequentialMusic
  'elements (list
	     (make-music 'NoteEvent
               'articulations (list
			       (make-music 'AbsoluteDynamicEvent
				 'text
				 &quot;f&quot;))
	       'duration (ly:make-duration 2 0 1/1)
	       'pitch    (ly:make-pitch 0 0 0))))
</pre></blockquote>

<p>Une séquence musicale <code>{ &hellip; }</code> se voit attribuer le nom de
<code>SequentialMusic</code>, et les expressions qu&rsquo;elle contient sont
enregistrées en tant que liste dans sa propriété <code>'elements</code>.  Une
note est représentée par un objet <code>NoteEvent</code> &ndash; contenant les
propriétés de durée et hauteur &ndash; ainsi que l&rsquo;information qui lui est
attachée &ndash; en l&rsquo;occurrence un <code>AbsoluteDynamicEvent</code> ayant une
propriété <code>text</code> de valeur <code>&quot;f&quot;</code> &ndash; et stockée dans sa
propriété <code>articulations</code>.
</p>
<a name="index-void"></a>
<a name="index-void-1"></a>
<p>La fonction <code>\displayMusic</code> renvoie la musique qu&rsquo;elle
affiche ; celle-ci sera donc aussi interprétée.  L&rsquo;insertion d&rsquo;une
commande <code>\void</code> avant le <code>\displayMusic</code> permet de
s&rsquo;affranchir de la phase d&rsquo;interprétation.
</p>

<hr size="6">
<a name="Propri_00e9t_00e9s-musicales"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#displaying-music-expressions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Affichage d'expressions musicales&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#building-complicated-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Construction de fonctions complexes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#doubling-a-note-with-slurs-_0028example_0029" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Doublement d'une note avec liaison (exemple) &gt; </a>]</td></tr></table>
<a name="music-properties"></a>
<h3 class="subsection">1.3.2 Propriétés musicales</h3>

<p>Nous abordons ici les propriétés <em>music</em>, et non pas les propriétés
<em>context</em> ou <em>layout</em>.
</p>
<p>Partons de cet exemple simple :
</p>
<blockquote><pre class="example">someNote = c'
\displayMusic \someNote
===&gt;
(make-music
  'NoteEvent
  'duration
  (ly:make-duration 2 0 1/1)
  'pitch
  (ly:make-pitch 0 0 0))
</pre></blockquote>

<p>L&rsquo;objet <code>NoteEvent</code> est la représentation brute de <code>someNote</code>.
Voyons ce qui se passe lorsque nous plaçons ce <var>c&rsquo;</var> dans une
construction d&rsquo;accord :
</p>
<blockquote><pre class="example">someNote = &lt;c'&gt;
\displayMusic \someNote
===&gt;
(make-music
  'EventChord
  'elements
  (list (make-music
          'NoteEvent
          'duration
          (ly:make-duration 2 0 1/1)
          'pitch
          (ly:make-pitch 0 0 0))))
</pre></blockquote>

<p>L&rsquo;objet <code>NoteEvent</code> est maintenant le premier objet de la propriété
<code>'elements</code> de <code>someNote</code>.
</p>
<p><code>\displayMusic</code> utilise la fonction <code>display-scheme-music</code>
pour afficher la représentation en Scheme d&rsquo;une expression musicale :
</p>
<blockquote><pre class="example">#(display-scheme-music (first (ly:music-property someNote 'elements)))
===&gt;
(make-music
  'NoteEvent
  'duration
  (ly:make-duration 2 0 1/1)
  'pitch
  (ly:make-pitch 0 0 0))
</pre></blockquote>

<p>La hauteur de la note est accessible au travers de la propriété
<code>'pitch</code> de l&rsquo;objet <code>NoteEvent</code> :
</p>
<blockquote><pre class="example">#(display-scheme-music
   (ly:music-property (first (ly:music-property someNote 'elements))
                      'pitch))
===&gt;
(ly:make-pitch 0 0 0)
</pre></blockquote>

<p>La hauteur de la note se modifie en définissant sa propriété
<code>'pitch</code> :
</p>
<a name="index-_005cdisplayLilyMusic"></a>
<a name="index-_005cdisplayLilyMusic-1"></a>

<blockquote><pre class="example">#(set! (ly:music-property (first (ly:music-property someNote 'elements))
                          'pitch)
       (ly:make-pitch 0 1 0)) ;; set the pitch to d'.
\displayLilyMusic \someNote
===&gt;
d'4
</pre></blockquote>


<hr size="6">
<a name="Doublement-d_0027une-note-avec-liaison-_0028exemple_0029"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#music-properties" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Propriétés musicales&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#building-complicated-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Construction de fonctions complexes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#adding-articulation-to-notes-_0028example_0029" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Ajout d'articulation à des notes (exemple) &gt; </a>]</td></tr></table>
<a name="doubling-a-note-with-slurs-_0028example_0029"></a>
<h3 class="subsection">1.3.3 Doublement d&rsquo;une note avec liaison (exemple)</h3>

<p>Supposons que nous ayons besoin de créer une fonction transformant une
saisie <code>a</code> en <code>{ a( a) }</code>.  Commençons par examiner
comment le résultat est représenté en interne.
</p>
<blockquote><pre class="example">\displayMusic{ a'( a') }
===&gt;
(make-music
  'SequentialMusic
  'elements
  (list (make-music
          'NoteEvent
          'articulations
          (list (make-music
                  'SlurEvent
                  'span-direction
                  -1))
          'duration
          (ly:make-duration 2 0 1/1)
          'pitch
          (ly:make-pitch 0 5 0))
        (make-music
          'NoteEvent
          'articulations
          (list (make-music
                  'SlurEvent
                  'span-direction
                  1))
          'duration
          (ly:make-duration 2 0 1/1)
          'pitch
          (ly:make-pitch 0 5 0))))
</pre></blockquote>

<p>Mauvaise nouvelle ! Les expressions <code>SlurEvent</code> doivent
s&rsquo;ajouter « à l&rsquo;intérieur » de la note &ndash; dans sa propriété
<code>articulations</code>.
</p>
<p>Examinons à présent la saisie :
</p>
<blockquote><pre class="example">\displayMusic a'
===&gt;
(make-music
  'NoteEvent
  'duration
  (ly:make-duration 2 0 1/1)
  'pitch
  (ly:make-pitch 0 5 0))))
</pre></blockquote>

<p>Nous aurons donc besoin, dans notre fonction, de cloner cette expression
&ndash; de telle sorte que les deux notes constituent la séquence &ndash; puis
d&rsquo;ajouter un <code>SlurEvent</code> à la propriété <code>'articulations</code> de
chacune d&rsquo;elles, et enfin réaliser un <code>SequentialMusic</code> de ces deux
éléments <code>NoteEvent</code>.  En tenant compte du fait que, dans le cadre
d&rsquo;un ajout, une propriété non définie est lue <code>'()</code> (une liste
vide), aucune vérification n&rsquo;est requise avant d&rsquo;introduire un nouvel
élément en tête de la propriété <code>articulations</code>.
</p>
<blockquote><pre class="example">doubleSlur = #(define-music-function (note) (ly:music?)
         &quot;Renvoie : { note ( note ) }.
         `note' est censé être une note unique.&quot;
         (let ((note2 (ly:music-deep-copy note)))
           (set! (ly:music-property note 'articulations)
                 (cons (make-music 'SlurEvent 'span-direction -1)
                       (ly:music-property note 'articulations)))
           (set! (ly:music-property note2 'articulations)
                 (cons (make-music 'SlurEvent 'span-direction 1)
                       (ly:music-property note2 'articulations)))
           (make-music 'SequentialMusic 'elements (list note note2))))
</pre></blockquote>


<hr size="6">
<a name="Ajout-d_0027articulation-_00e0-des-notes-_0028exemple_0029"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#interfaces-for-programmers" title="Chapitre suivant">&nbsp;Interfaces pour programmeurs &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#doubling-a-note-with-slurs-_0028example_0029" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Doublement d'une note avec liaison (exemple)&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#building-complicated-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Construction de fonctions complexes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#interfaces-for-programmers" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Interfaces pour programmeurs &gt; </a>]</td></tr></table>
<a name="adding-articulation-to-notes-_0028example_0029"></a>
<h3 class="subsection">1.3.4 Ajout d&rsquo;articulation à des notes (exemple)</h3>

<p>Le moyen d&rsquo;ajouter une articulation à des notes consiste à fusionner
deux expressions musicales en un même contexte.  L&rsquo;option de réaliser
nous-mêmes une fonction musicale à cette fin nous offre l&rsquo;avantage de
pouvoir alors ajouter une articulation, telle qu&rsquo;une instruction de
doigté, individuellement à l&rsquo;une des notes d&rsquo;un accord, ce qui est
impossible dans le cadre d&rsquo;une simple fusion de musique indépendante.
</p>
<p>Un <code>$variable</code> au milieu de la notation <code>#{ &hellip; #}</code> se
comporte exactement comme un banal <code>\variable</code> en notation LilyPond
traditionnelle.  Nous savons déjà que
</p>
<blockquote><pre class="example">{ \musique -. -&gt; }
</pre></blockquote>

<p>n&rsquo;est pas admis par LilyPond.  Nous pourrions tout à fait contourner ce
problème en attachant l&rsquo;articulation à un accord vide,
</p>
<blockquote><pre class="example">{ &lt;&lt; \musique &lt;&gt; -. -&gt; &gt;&gt; }
</pre></blockquote>

<p>mais, pour les besoins de la démonstration, nous allons voir comment
réaliser ceci en Scheme.  Commençons par examiner une saisie simple et
le résultat auquel nous désirons aboutir :
</p>
<blockquote><pre class="example">%  saisie
\displayMusic c4
===&gt;
(make-music
  'NoteEvent
  'duration
  (ly:make-duration 2 0 1/1)
  'pitch
  (ly:make-pitch -1 0 0))))
=====
%  résultat attendu
\displayMusic c4-&gt;
===&gt;
(make-music
  'NoteEvent
  'articulations
  (list (make-music
          'ArticulationEvent
          'articulation-type
          &quot;accent&quot;))
  'duration
  (ly:make-duration 2 0 1/1)
  'pitch
  (ly:make-pitch -1 0 0))
</pre></blockquote>

<p>Nous voyons qu&rsquo;une note (<code>c4</code>) est représentée par une expression
<code>NoteEvent</code>.  Si nous souhaitons ajouter une articulation
<var>accent</var>, nous devrons ajouter une expression
<code>ArticulationEvent</code> à la propriété <code>articulations</code> de
l&rsquo;expression <code>NoteEvent</code>.
</p>
<p>Construisons notre fonction en commençant par
</p>
<blockquote><pre class="example">(define (ajoute-accent note-event)
  &quot;Ajoute un accent (ArticulationEvent) aux articulations de `note-event',
  qui est censé être une expression NoteEvent.&quot;
  (set! (ly:music-property note-event 'articulations)
        (cons (make-music 'ArticulationEvent
                'articulation-type &quot;accent&quot;)
              (ly:music-property note-event 'articulations)))
  note-event)
</pre></blockquote>

<p>La première ligne est la manière de définir une fonction en Scheme : la
fonction Scheme a pour nom <code>ajoute-accent</code> et elle comporte une
variable appelée <code>note-event</code>.  En Scheme, le type d&rsquo;une variable
se déduit la plupart de temps de par son nom &ndash; c&rsquo;est d&rsquo;ailleurs une
excellente pratique que l&rsquo;on retrouve dans de nombreux autres langages.
</p>
<blockquote><pre class="example">&quot;Ajoute un accent&hellip;&quot;
</pre></blockquote>

<p>décrit ce que fait la fonction.  Bien que ceci ne soit pas primordial,
tout comme des noms de variable évidents, tâchons néanmoins de prendre
de bonnes habitudes dès nos premiers pas.
</p>
<p>Vous pouvez vous demander pourquoi nous modifions directement
l&rsquo;événement note plutôt que d&rsquo;en manipuler une copie &ndash; on pourrait
utiliser <code>ly:music-deep-copy</code> à cette fin.  La raison en est qu&rsquo;il
existe un contrat tacite : les fonctions musicales sont autorisées
à modifier leurs arguments &ndash; ils sont générés en partant de zéro (comme
les notes que vous saisissez) ou déjà recopiés (faire référence à une
variable musicale avec &lsquo;<samp>\name</samp>&rsquo; ou à de la musique issue
d&rsquo;expressions Scheme &lsquo;<samp>$(&hellip;)</samp>&rsquo; aboutit à une copie).  Dans la
mesure où surmultiplier les copies serait contre productif, la valeur de
retour d&rsquo;une fonction musicale n&rsquo;est <strong>pas</strong> recopiée.  Afin de
respecter ce contrat, n&rsquo;utilisez pas un même argument à plusieurs
reprises, et n&rsquo;oubliez pas que le retourner compte pour une utilisation.
</p>
<p>Dans un exemple précédent, nous avons construit de la musique en
répétant un certain argument musical.  Dans ce cas là, l&rsquo;une des
répétitions se devait d&rsquo;être une copie.  Dans le cas contraire,
certaines bizarreries auraient pu survenir.  Par exemple, la présence
d&rsquo;un <code>\relative</code> ou d&rsquo;un <code>\transpose</code>, après plusieurs
répétitions du même élément, entraînerait des « relativisations » ou
transpositions en cascade.  Si nous les assignons à une variable
musicale, l&rsquo;enchaînement est rompu puisque la référence à &lsquo;<samp>\nom</samp>&rsquo;
créera une nouvelle copie sans toutefois prendre en considération
l&rsquo;identité des éléments répétés.
</p>
<p>Cette fonction n&rsquo;étant pas une fonction musicale à part entière, elle
peut s&rsquo;utiliser dans d&rsquo;autres fonctions musicales.  Il est donc sensé de
respecter le même contrat que pour les fonctions musicales :
l&rsquo;entrée peut être modifiée pour arriver à une sortie, et il est de la
responsabilité de l&rsquo;appelant d&rsquo;effectuer des copies s&rsquo;il a réellement
besoin de l&rsquo;argument dans son état originel.  Vous constaterez, à la
lecture des fonctions propres à LilyPond, comme <code>music-map</code>, que ce
principe est toujours respecté.
</p>
<p>Revenons à nos moutons… Nous disposons maintenant d&rsquo;un <code>note-event</code>
que nous pouvons modifier, non pas grâce à un <code>ly:music-deep-copy</code>,
mais plutôt en raison de notre précédente réflexion.  Nous ajoutons
<var>l&rsquo;accent</var> à la liste de ses propriétés <code>'articulations</code>.
</p>
<blockquote><pre class="example">(set! emplacement nouvelle-valeur)
</pre></blockquote>

<p>L&rsquo;emplacement est ce que nous voulons ici définir.  Il s&rsquo;agit de la
propriété <code>'articulations</code> de l&rsquo;expression <code>note-event</code>.
</p>
<blockquote><pre class="example">(ly:music-property note-event 'articulations)
</pre></blockquote>

<p>La fonction <code>ly:music-property</code> permet d&rsquo;accéder aux propriétés
musicales &ndash; les <code>'articulations</code>, <code>'duration</code>, <code>'pitch</code>,
etc. que <code>\displayMusic</code> nous a indiquées.  La nouvelle valeur sera
l&rsquo;ancienne propriété <code>'articulations</code>, augmentée d&rsquo;un
élément : l&rsquo;expression <code>ArticulationEvent</code>, que nous
recopions à partir des informations de <code>\displayMusic</code>.
</p>
<blockquote><pre class="example">(cons (make-music 'ArticulationEvent
        'articulation-type &quot;accent&quot;)
      (ly:music-property result-event-chord 'articulations))
</pre></blockquote>

<p><code>cons</code> permet d&rsquo;ajouter un élément en tête de liste sans pour
autant modifier la liste originale.  C&rsquo;est exactement ce que nous
recherchons : la même liste qu&rsquo;auparavant, plus la nouvelle
expression <code>ArticulationEvent</code>.  L&rsquo;ordre au sein de la propriété
<code>'articulations</code> n&rsquo;a ici aucune importance.
</p>
<p>Enfin, après avoir ajouté l&rsquo;articulation <var>accent</var> à sa
propriété <code>articulations</code>, nous pouvons renvoyer le
<code>note-event</code>, ce que réalise la dernière ligne de notre fonction.
</p>
<p>Nous pouvons à présent transformer la fonction <code>ajoute-accent</code> en
fonction musicale, à l&rsquo;aide d&rsquo;un peu d&rsquo;enrobage syntaxique et mention du
type de son argument.
</p>
<blockquote><pre class="example">ajouteAccent = #(define-music-function (note-event)
                                        (ly:music?)
  &quot;Ajoute un accent (ArticulationEvent) aux articulations de `note-event',
  qui est censé être une expression NoteEvent.&quot;
  (set! (ly:music-property note-event 'articulations)
        (cons (make-music 'ArticulationEvent
                'articulation-type &quot;accent&quot;)
              (ly:music-property note-event 'articulations)))
  note-event)
</pre></blockquote>

<p>Par acquis de conscience, vérifions que tout ceci fonctione :
</p>
<blockquote><pre class="example">\displayMusic \ajouteAccent c4
</pre></blockquote>









<hr size="6">
<a name="Interfaces-pour-programmeurs"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#tutoriel-scheme" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Tutoriel Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#adding-articulation-to-notes-_0028example_0029" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Ajout d'articulation à des notes (exemple)&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-code-blocks" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Blocs de code LilyPond &gt; </a>]</td></tr></table>
<a name="interfaces-for-programmers"></a>
<h1 class="chapter">2. Interfaces pour programmeurs</h1>

<p>Scheme permet de réaliser des affinages très pointus.  Si vous ne
connaissez rien de Scheme, vous en aurez un aperçu au travers de notre
<a href="#tutoriel-scheme">Tutoriel Scheme</a>.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#lilypond-code-blocks" accesskey="1">2.1 Blocs de code LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#scheme-functions" accesskey="2">2.2 Fonctions Scheme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#music-functions" accesskey="3">2.3 Fonctions musicales</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#event-functions" accesskey="4">2.4 Fonctions événementielles</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#markup-functions" accesskey="5">2.5 Fonctions pour <em>markups</em></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#contexts-for-programmers" accesskey="6">2.6 Contextes pour programmeurs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#callback-functions" accesskey="7">2.7 Fonctions de rappel</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#difficult-tweaks" accesskey="8">2.8 Retouches complexes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Blocs-de-code-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#interfaces-for-programmers" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#interfaces-for-programmers" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctions Scheme &gt; </a>]</td></tr></table>
<a name="lilypond-code-blocks"></a>
<h2 class="section">2.1 Blocs de code LilyPond</h2>

<a name="index-code_002c-blocs-LilyPond"></a>
<a name="index-LilyPond_002c-bloc-de-code"></a>

<a name="index-_0023_007b-_002e_002e_002e-_0023_007d"></a>
<a name="index-_0023_007b-_002e_002e_002e-_0023_007d-1"></a>
<a name="index-_0024-4"></a>
<a name="index-_0024-5"></a>
<a name="index-_0023-4"></a>
<a name="index-_0023-5"></a>

<p>L&rsquo;utilisation de Scheme pour créer des expressions musicales peut
s&rsquo;avérer ardue, principalement à cause des imbrications et de la
longueur du code Scheme qui en résulte.  Dans le cas de tâches
simples, on peut toutefois contourner une partie du problème en
utilisant des blocs de code LilyPond, ce qui autorise la syntaxe
habituelle de LilyPond au sein même de Scheme.
</p>
<p>Les blocs de code LilyPond ressemblent à
</p>
<blockquote><pre class="example">  #{ <var>du code LilyPond</var> #}
</pre></blockquote>

<p>En voici un exemple basique :
</p>
<blockquote><pre class="verbatim">ritpp = #(define-event-function () ()
  #{ ^&quot;rit.&quot; \pp #}
)

{ c'4 e'4\ritpp g'2 }
</pre><p>
 <a href="f3/lily-a1c2820d.ly">
  <img align="middle"
       border="0"
       src="f3/lily-a1c2820d.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Les blocs de code LilyPond peuvent s&rsquo;utiliser partout où vous pouvez
écrire du code Scheme.  Le lecteur Scheme est en fait quelque peu adapté
pour accepter des blocs de code LilyPond ; il est capable de traiter des
expressions Scheme intégrées débutant par <code>$</code> ou <code>#</code>.
</p>
<p>Le lecteur Scheme extrait le bloc de code LilyPond et déclenche un appel
à l&rsquo;analyseur grammatical de LilyPond (le <em>parser</em>) qui réalise en
temps réel l&rsquo;interprétation de ce bloc de code LilyPond.  Toute
expression Scheme imbriquée est exécutée dans l&rsquo;environnement lexical du
bloc de code LilyPond, de telle sorte que vous avez accès aux variables
locales et aux paramètres de la fonction au moment même où le bloc de
code LilyPond est écrit.  Les variables définies dans d&rsquo;autres modules
Scheme, tels ceux contenant les blocs <code>\header</code> ou <code>\layout</code>,
ne sont pas accessibles en tant que variables Scheme (préfixées par
un <code>#</code>) mais en tant que variables LilyPond (préfixées par
un <code>\</code>).
</p>
<p>Toute la musique générée au sein de ce bloc de code voit son
<code>origine</code> établie à cet <em>emplacement</em>.
</p>
<p>Un bloc de code LilyPond peut contenir tout ce que vous pourriez mettre
à droite de l&rsquo;assignation.  Par ailleurs, un bloc LilyPond vide
correspond à une expression fantôme, et un bloc LilyPond de multiples
événements musicaux sera transformé en une expression de musique
séquentielle.
</p>

<hr size="6">
<a name="Fonctions-Scheme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-code-blocks" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Blocs de code LilyPond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#interfaces-for-programmers" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme-function-definitions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Définition de fonctions Scheme &gt; </a>]</td></tr></table>
<a name="scheme-functions"></a>
<h2 class="section">2.2 Fonctions Scheme</h2>

<a name="index-Scheme_002c-fonctions-_0028syntaxe-LilyPond_0029"></a>

<p>Les <em>fonctions Scheme</em> sont des procédures Scheme chargées de créer
des expressions Scheme à partir de code rédigé selon la syntaxe de
LilyPond.  Elles peuvent être appelées en de nombreux endroits, à l&rsquo;aide
d&rsquo;un <code>#</code>, où spécifier une valeur en syntaxe Scheme est autorisé.
Bien que Scheme dispose de fonctions en propre, nous nous intéresserons,
au fil des paragraphes qui suivent, aux fonctions <em>syntaxiques</em>,
autrement dit des fonctions qui reçoivent des arguments libellés dans la
syntaxe de LilyPond.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#scheme-function-definitions" accesskey="1">2.2.1 Définition de fonctions Scheme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#scheme-function-usage" accesskey="2">2.2.2 Utilisation de fonctions Scheme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#void-scheme-functions" accesskey="3">2.2.3 Fonctions Scheme fantômes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="D_00e9finition-de-fonctions-Scheme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctions Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme-function-usage" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Utilisation de fonctions Scheme &gt; </a>]</td></tr></table>
<a name="scheme-function-definitions"></a>
<h3 class="subsection">2.2.1 Définition de fonctions Scheme</h3>

<a name="index-define_002dscheme_002dfunction"></a>
<a name="index-define_002dscheme_002dfunction-1"></a>

<p>D&rsquo;une manière générale, une fonction Scheme se définit ainsi :
</p>
<blockquote><pre class="example">fonction =
#(define-scheme-function
     (<var>arg1</var> <var>arg2</var>&hellip;)
     (<var>type1?</var> <var>type2?</var>&hellip;)
   <var>corps</var>)
</pre></blockquote>

<p>où
</p>
<table>
<tr><td width="33%"><code><var>argN</var></code></td><td width="66%"><var>n</var>-ième argument.</td></tr>
<tr><td width="33%"><code><var>typeN?</var></code></td><td width="66%">un <em>type de prédicat</em> Scheme pour lequel <code><var>argN</var></code>
devra retourner <code>#t</code>.  Il existe aussi une forme spécifique &ndash;
<code>(<em>prédicat?</em> <em>default</em>)</code> &ndash; qui permet de fournir des
argument optionnels.  En l&rsquo;absence d&rsquo;argument réel au moment de l&rsquo;appel
à la fonction, c&rsquo;est la valeur par défaut qui lui sera substituée.  Les
valeurs par défaut sont évaluées dès l&rsquo;apparition de la définition, y
compris dans le cas de blocs de code LilyPond ; vous devrez donc,
si ces valeurs par défaut ne peuvent être déterminées que plus tard,
mentionner une valeur spéciale que vous reconnaîtrez facilement.
Lorsque vous mentionnez un prédicat entre parenthèses sans toutefois
fournir sa valeur par défaut, celle-ci sera considérée comme
étant <code>#f</code>.  Les valeurs par défaut d&rsquo;un <code>prédicat?</code> ne sont
vérifiées ni au moment de la définition, ni à l&rsquo;exécution ; il est
de votre ressort de gérer les valeurs que vous spécifiez.  Une valeur
par défaut constituée d&rsquo;une expression musicale est recopiée dès la
définition de <code>origin</code> à l&rsquo;emplacement courant du code.</td></tr>
<tr><td width="33%"><code><var>corps</var></code></td><td width="66%">une séquence de formules Scheme évaluées dans l&rsquo;ordre, la dernière
servant de valeur de retour de la fonction. Il peut contenir des blocs
de code LilyPond, enchâssés dans des accolades et <em>hashes</em> &ndash;
<code>#{&hellip;#}</code> &ndash; comme indiqué à la rubrique
<a href="#lilypond-code-blocks">Blocs de code LilyPond</a>.  Au sein d&rsquo;un bloc de code LilyPond, un
<code>#</code> permet de référencer des arguments de la fonction &ndash; tel
&lsquo;<samp>#arg1</samp>&rsquo; &ndash; ou d&rsquo;ouvrir une expression Scheme contenant les
arguments de la fonction &ndash; par exemple &lsquo;<samp>#(cons arg1 arg2)</samp>&rsquo;.
Dans le cas où une expression Scheme introduite par <code>#</code> ne vous
permet pas de parvenir à vos fins, vous pourriez devoir revenir à une
expression Scheme « immédiate » à l&rsquo;aide d&rsquo;un <code>$</code>, comme
&lsquo;<samp>$music</samp>&rsquo;.

Lorsque votre fonction retourne une expression musicale, lui est
attribuée la valeur <code>origin</code>.</td></tr>
</table>

<p>La recevabilité des arguments est déterminée par un appel effectif au
prédicat après que LilyPond les a déjà convertis en expression Scheme.
Par voie de conséquence, l&rsquo;argument peut tout à fait se libeller en
syntaxe Scheme &ndash; introduite par un <code>#</code> ou en tant que résultat
d&rsquo;un appel à une fonction Scheme.  Par ailleurs, LilyPond convertira en
Scheme un certain nombre de constructions purement LilyPond avant même
d&rsquo;en avoir vérifié le prédicat.  C&rsquo;est notamment le cas de la musique,
des <em>postévénements</em>, des chaînes simples (avec ou sans
guillemets), des nombres, des <em>markups</em> et listes de
<em>markups</em>, ainsi que des blocs <em>score</em>, <em>book</em>,
<em>bookpart</em>, ou qui définissent un contexte ou un format de sortie.
</p>
<p>Il existe certaines situations pour lesquelles LilyPond lèvera toute
ambiguïté grâce aux fonctions de prédicat : un &lsquo;<samp>-3</samp>&rsquo; est-il un
<em>postévénement</em> de type doigté ou un nombre négatif ?  Un
<code>&quot;a&quot; 4</code> en mode paroles est-il une chaîne suivie d&rsquo;un nombre ou
bien un événement syllabe de durée <code>4</code> ?  LilyPond répondra à ces
questions par des interprétations successives du prédicat de l&rsquo;argument,
dans un ordre défini de sorte à minimiser les interprétations erronées
et le besoin de lecture en avance.
</p>
<p>Un prédicat qui accepte par exemple aussi bien une expression musicale
qu&rsquo;une hauteur considèrera <code>c''</code> comme étant une hauteur plutôt
qu&rsquo;une expression musicale.  Les durées ou <em>postévénements</em> qui
viennent juste après viendront modifier cette interprétation.  C&rsquo;est la
raison pour laquelle il vaut mieux éviter des prédicats par trop
permissifs tel que <code>Scheme?</code> lorsque l&rsquo;application fait plutôt
appel à des type d&rsquo;argument plus spécifiques.
</p>
<p>Les différents types de prédicat propres à LilyPond sont recensés à
l&rsquo;annexe <a name="index-Types-de-predicats-predefinis"></a>
<a href="notation-big-page.fr.html#predefined-type-predicates">Types de prédicats prédéfinis</a>.
</p>
<a name="Voir-aussi-2"></a>
<h4 class="subsubheading">Voir aussi</h4>
<p>Manuel de notation :
<a name="index-Types-de-predicats-predefinis-1"></a>
<a href="notation-big-page.fr.html#predefined-type-predicates">Types de prédicats prédéfinis</a>.
</p>
<p>Fichiers d&rsquo;initialisation :
&lsquo;<tt>lily/music-scheme.cc</tt>&rsquo;,
&lsquo;<tt>scm/c++.scm</tt>&rsquo;,
&lsquo;<tt>scm/lily.scm</tt>&rsquo;.
</p>

<hr size="6">
<a name="Utilisation-de-fonctions-Scheme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme-function-definitions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Définition de fonctions Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#void-scheme-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctions Scheme fantômes &gt; </a>]</td></tr></table>
<a name="scheme-function-usage"></a>
<h3 class="subsection">2.2.2 Utilisation de fonctions Scheme</h3>

<p>Vous pouvez appeler une fonction Scheme pratiquement partout où une
expression Scheme derrière un <code>#</code> peut prendre place.  Vous appelez
une fonction Scheme à partir de LilyPond en faisant précéder son nom
d&rsquo;un <code>\</code>, et en le faisant suivre de ses arguments.  Lorsqu&rsquo;un
prédicat d&rsquo;argument optionnel ne correspond pas à un argument, LilyPond
l&rsquo;ignore ainsi que tous les arguments optionnels qui suivent, les
remplaçant par leur valeur par défaut, et « sauvegarde » en tant que
prochain argument obligatoire l&rsquo;argument qui ne correspondait pas.  Dans
la mesure où l&rsquo;argument sauvegardé doit servir, les argument optionnels
ne sont en fait pas considérés comme optionnels, sauf à être suivis d&rsquo;un
argument obligatoire.
</p>
<p>Une exception cependant à cette règle : le fait de donner un
<code>\default</code> en tant qu&rsquo;argument optionnel aura pour résultat que cet
argument et tous les autres arguments optionnels qui suivent seront
ignorés et remplacés par leur valeur par défaut.  Il en va de même
lorsqu&rsquo;aucun argument obligatoire ne suit, du fait que <code>\default</code>
ne requiert pas de sauvegarde.  C&rsquo;est d&rsquo;ailleurs ainsi que fonctionnent
les commandes <code>mark</code> et <code>key</code>, qui retrouvent leur
comportement par défaut lorsque vous les faites suivre d&rsquo;un
<code>\default</code>.
</p>
<p>En plus de là où une expression Scheme est requise, il y a quelques
endroits où des expressions <code>#</code> sont acceptées et évaluées
uniquement pour leurs effets annexes.  Il s&rsquo;agit, dans la plupart des
cas, d&rsquo;endroits où une affectation serait tout à fait envisageable.
</p>
<p>Dans la mesure où il n&rsquo;est pas bon de renvoyer une valeur qui pourrait
être mal interprétée dans certains contextes, nous vous enjoignons à
utiliser des fonctions Scheme normales uniquement dans les cas où vous
renvoyez toujours une valeur utile, et une fonction fantôme &ndash; voir
<a href="#void-scheme-functions">Fonctions Scheme fantômes</a> &ndash; dans le cas contraire.
</p>
<p>Pour des raisons de commodité, il est possible de faire appel à des
fonctions Scheme directement en Scheme, courcircuitant ainsi l&rsquo;analyseur
de LilyPond.  Leur nom s&rsquo;utilise comme n&rsquo;importe quel nom de fonction.
Le contrôle de typologie des arguments et l&rsquo;omission des arguments
optionnels seront traîtés de la même manière que lorsque l&rsquo;appel est
fait à partir de LilyPond, la valeur Scheme <code>*unspecified*</code> ayant
le rôle du mot réservé <code>\default</code> pour omettre explicitement les
arguments optionnels.
</p>

<hr size="6">
<a name="Fonctions-Scheme-fant_00f4mes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme-function-usage" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Utilisation de fonctions Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions Scheme&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#music-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctions musicales &gt; </a>]</td></tr></table>
<a name="void-scheme-functions"></a>
<h3 class="subsection">2.2.3 Fonctions Scheme fantômes</h3>

<a name="index-void_002c-fonction"></a>
<a name="index-fantome_002c-fonction"></a>

<a name="index-define_002dvoid_002dfunction"></a>
<a name="index-define_002dvoid_002dfunction-1"></a>
<a name="index-_005cvoid"></a>
<a name="index-_005cvoid-1"></a>

<p>Il arrive qu&rsquo;une procédure soit exécutée pour réaliser une action, non
pour renvoyer une valeur.  Certains langages de programmation, tels
le C et Scheme, utilisent des fonctions dans les deux cas et se
débarrassent tout bonnement de la valeur renvoyée ; en règle
générale, il suffit que l&rsquo;expression fasse office de déclaration, et
d&rsquo;ignorer le résultat.  C&rsquo;est futé, mais pas sans risque d&rsquo;erreur :
la plupart des compilateurs C actuels déclenchent un avertissement si
l&rsquo;on se débarrasse de certaines expressions non <em>void</em>.  Pour de
nombreuses fonctions réalisant une action, les standards Scheme
déclarent que la valeur de retour est indéfinie.  L&rsquo;interpréteur Guile
qu&rsquo;utilise le Scheme de LilyPond dispose d&rsquo;une valeur unique
<code>*unspecified*</code> qu&rsquo;il retourne alors, en règle générale &ndash; notamment
lorsqu&rsquo;on utilise <code>set!</code> directement sur une variable &ndash; mais
malheureusement pas toujours.
</p>
<p>Une fonction LilyPond définie à l&rsquo;aide de la clause
<code>define-void-function</code> vous apporte l&rsquo;assurance que c&rsquo;est cette
valeur spéciale &ndash; la seule valeur qui satisfasse au prédicat
<code>void?</code> &ndash; qui sera retournée.
</p>
<blockquote><pre class="example">noPointAndClick =
#(define-void-function
     ()
     ()
   (ly:set-option 'point-and-click #f))
&hellip;
\noPointAndClick   % desactive le &quot;pointer-cliquer&quot;
</pre></blockquote>

<p>L&rsquo;utilisation d&rsquo;un préfixe <code>\void</code> permet ainsi d&rsquo;évaluer une
expression pour ses effets annexes sans interprétation d&rsquo;une quelconque
valeur de retour :
</p>
<blockquote><pre class="example">\void #(hashq-set! une-table une-clé une-valeur)
</pre></blockquote>

<p>Vous serez alors assuré que LilyPond ne tentera pas d&rsquo;affecter un sens à
la valeur de retour, à quelque endroit qu&rsquo;elle ressorte.  Ceci est aussi
opérationnel dans le cadre de fonctions musicales telles que
<code>\displayMusic</code>.
</p>

<hr size="6">
<a name="Fonctions-musicales"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#void-scheme-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctions Scheme fantômes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#interfaces-for-programmers" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#music-function-definitions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Définition de fonctions musicales &gt; </a>]</td></tr></table>
<a name="music-functions"></a>
<h2 class="section">2.3 Fonctions musicales</h2>

<a name="index-musicale_002c-fonction"></a>

<p>Les <em>fonctions musicales</em> sont des procédures Scheme capables de
créer automatiquement des expressions musicales ; elles permettent
de grandement simplifier un fichier source.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#music-function-definitions" accesskey="1">2.3.1 Définition de fonctions musicales</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#music-function-usage" accesskey="2">2.3.2 Utilisation de fonctions musicales</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#simple-substitution-functions" accesskey="3">2.3.3 Fonctions de substitution simple</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#intermediate-substitution-functions" accesskey="4">2.3.4 Fonctions de substitution intermédiaires</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#mathematics-in-functions" accesskey="5">2.3.5 De l&rsquo;usage des mathématiques dans les fonctions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#functions-without-arguments" accesskey="6">2.3.6 Fonctions dépourvues d&rsquo;argument</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#void-music-functions" accesskey="7">2.3.7 Fonctions musicales fantômes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="D_00e9finition-de-fonctions-musicales"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#music-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctions musicales&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#music-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions musicales&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#music-function-usage" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Utilisation de fonctions musicales &gt; </a>]</td></tr></table>
<a name="music-function-definitions"></a>
<h3 class="subsection">2.3.1 Définition de fonctions musicales</h3>

<a name="index-fonction-musicale_002c-definition"></a>

<a name="index-define_002dmusic_002dfunction"></a>
<a name="index-define_002dmusic_002dfunction-1"></a>

<p>Une fonction musicale se définit ainsi :
</p>
<blockquote><pre class="example">fonction =
#(define-music-function
     (<var>arg1</var> <var>arg2</var>&hellip;)
     (<var>type1?</var> <var>type2?</var>&hellip;)
   <var>corps</var>)
</pre></blockquote>

<p>de manière similaire aux <a href="#scheme-function-definitions">fonctions Scheme</a>.  La plupart du temps, le <var>corps</var> sera constitué d&rsquo;un
<a href="#lilypond-code-blocks">bloc de code LilyPond</a>.
</p>
<p>Les différents types des prédicat sont recensés à l&rsquo;annexe
<a name="index-Types-de-predicats-predefinis-2"></a>
<a href="notation-big-page.fr.html#predefined-type-predicates">Types de prédicats prédéfinis</a>.
</p>
<a name="Voir-aussi"></a>
<h4 class="subsubheading">Voir aussi</h4>
<p>Manuel de notation :
<a name="index-Types-de-predicats-predefinis-3"></a>
<a href="notation-big-page.fr.html#predefined-type-predicates">Types de prédicats prédéfinis</a>.
</p>
<p>Fichiers d&rsquo;initialisation :
&lsquo;<tt>lily/music-scheme.cc</tt>&rsquo;,
&lsquo;<tt>scm/c++.scm</tt>&rsquo;,
&lsquo;<tt>scm/lily.scm</tt>&rsquo;.
</p>

<hr size="6">
<a name="Utilisation-de-fonctions-musicales"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#music-function-definitions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Définition de fonctions musicales&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#music-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions musicales&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#simple-substitution-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctions de substitution simple &gt; </a>]</td></tr></table>
<a name="music-function-usage"></a>
<h3 class="subsection">2.3.2 Utilisation de fonctions musicales</h3>

<p>Une « fonction musicale » doit impérativement renvoyer une expression
répondant au prédicat <code>ly:music?</code>.  Ceci a pour conséquence
d&rsquo;autoriser l&rsquo;appel à une fonction musicale en tant qu&rsquo;argument de type
<code>ly:music?</code> dans le cadre de l&rsquo;appel à une autre fonction musicale.
</p>
<p>Certaines restrictions s&rsquo;appliqueront selon le contexte où une fonction
musicale est utilisée, de telle sorte que l&rsquo;analyse syntaxique soit sans
ambiguïté.
</p>
<ul>
<li>
Dans une expression musicale de haut niveau, aucun postévénement n&rsquo;est
toléré.

</li><li>
Lorsqu&rsquo;une fonction musicale &ndash; contrairement à une fonction
événementielle &ndash; renvoie une expression de type postévénement, LilyPond
requiert son introduction par un indicateur de positionnement &ndash; à
savoir <code>-</code>, <code>^</code> ou <code>_</code> &ndash; de telle sorte que le
postévénement produit par l&rsquo;appel à cette fonction s&rsquo;intègre
correctement dans l&rsquo;expression environnante.

</li><li>
En tant que partie d&rsquo;un accord, l&rsquo;expression musicale renvoyée doit
être du type <code>rhythmic-event</code>, et plus particulièrement un
<code>NoteEvent</code>.
</li></ul>

<p>Des fonctions « polymorphes » telles que <code>\tweak</code> peuvent
s&rsquo;appliquer aux postévénements, constituants d&rsquo;accord et expressions de
haut niveau.
</p>

<hr size="6">
<a name="Fonctions-de-substitution-simple"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#music-function-usage" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Utilisation de fonctions musicales&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#music-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions musicales&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#intermediate-substitution-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctions de substitution intermédiaires &gt; </a>]</td></tr></table>
<a name="simple-substitution-functions"></a>
<h3 class="subsection">2.3.3 Fonctions de substitution simple</h3>

<p>Une fonction de substitution simple renvoie une expression musicale
écrite au format LilyPond et contient des arguments au format de
l&rsquo;expression résultante.  Vous en trouverez une description détaillée à
la rubrique <a name="index-Exemples-de-fonction-de-substitution"></a>
<a href="notation-big-page.fr.html#substitution-function-examples">Exemples de fonction de substitution</a>.
</p>

<hr size="6">
<a name="Fonctions-de-substitution-interm_00e9diaires"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#simple-substitution-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctions de substitution simple&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#music-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions musicales&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#mathematics-in-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;De l'usage des mathématiques dans les fonctions &gt; </a>]</td></tr></table>
<a name="intermediate-substitution-functions"></a>
<h3 class="subsection">2.3.4 Fonctions de substitution intermédiaires</h3>

<p>Une fonction de substitution intermédiaire est une fonction dont
l&rsquo;expression musicale résultante mélangera du code Scheme au code
LilyPond.
</p>
<p>Certaines commandes <code>\override</code> nécessitent un argument
supplémentaire constitué d&rsquo;une paire de nombres, appelée <em>cons
cell</em> en Scheme &ndash; que l&rsquo;on pourrait traduire par « construction de
cellule ».
</p>
<p>Cette paire peut se mentionner directement dans la fonction musicale à
l&rsquo;aide d&rsquo;une variable <code>pair?</code> :
</p>
<blockquote><pre class="example">manualBeam =
#(define-music-function
     (beg-end)
     (pair?)
   #{
     \once \override Beam.positions = #beg-end
   #})

\relative c' {
  \manualBeam #'(3 . 6) c8 d e f
}
</pre></blockquote>

<p>Autre manière de procéder, les nombres formant la paire sont transmis
comme arguments séparés ; le code Scheme chargé de créer la paire
pourra alors être inclus dans l&rsquo;expression musicale :
</p>
<blockquote><pre class="verbatim">manualBeam =
#(define-music-function
     (beg end)
     (number? number?)
   #{
     \once \override Beam.positions = #(cons beg end)
   #})

\relative c' {
  \manualBeam #3 #6 c8 d e f
}
</pre><p>
 <a href="1a/lily-1c7ee3ea.ly">
  <img align="middle"
       border="0"
       src="1a/lily-1c7ee3ea.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<a name="index-_005ctemporary"></a>
<a name="index-_005ctemporary-1"></a>
<a name="index-temporaire_002c-derogation-_0028override_0029"></a>
<a name="index-derogation-temporaire-_0028override_0029"></a>
<a name="index-proprietes_002c-retour-a-la-valeur-precedente"></a>

<p>L&rsquo;entretien des propriétés peut se voir comme un empilement par
propriété par objet par contexte.  Les fonctions musicales peuvent
nécessiter des dérogations pour une ou plusieurs propriétés pour la
durée de la fonction, puis de revenir aux valeurs précédentes avant de
quitter.  Néanmoins, une dérogation normale va retirer de la pile &ndash; ou
dépiler &ndash; et supprimer le sommet de la pile de la propriété avant
d&rsquo;y ajouter quoi que ce soit &ndash; ou empiler &ndash; ; la valeur précédente de
la propriété est de fait perdue.  Lorsque la valeur antérieure doit être
préservée, l&rsquo;instruction <code>\override</code> devra être préfixée d&rsquo;un
<code>\temporary</code>, comme ceci :
</p>
<blockquote><pre class="example">\temporary \override &hellip;
</pre></blockquote>

<p>L&rsquo;utilisation d&rsquo;un <code>\temporary</code> a pour effet d&rsquo;effacer la propriété
<code>pop-first</code> (<em>commence par dépiler</em> normalement activée) de la
dérogation ; la valeur antérieure ne sera alors pas supprimée de la pile
de la propriété avant d&rsquo;y empiler la nouvelle valeur.  Lorsqu&rsquo;un
<code>\revert</code> viendra par la suite supprimer la valeur dérogatoire
temporaire, réapparaitra la valeur antérieure.
</p>
<p>En d&rsquo;autres termes, un <code>\revert</code> qui suit un <code>\temporary
\override</code> pour la même propriété n&rsquo;apporte rien.  Ce principe est aussi
valable pour un couple <code>\temporary</code> et <code>\undo</code> sur la même
musique contenant des dérogations.
</p>
<p>Voici un exemple de fonction musicale utilisant cette fonctionnalité.
La présence du <code>\temporary</code> permet de s&rsquo;assurer qu&rsquo;en sortant de la
fonction, les propriétés <code>cross-staff</code> et <code>style</code> retrouveront
les valeurs qu&rsquo;elles avaient avant que ne soit appelée la fonction
<code>crossStaff</code>.  En l&rsquo;absence de <code>\temporary</code>, ces propriétés
auraient retrouvé leurs valeurs par défaut à la sortie de la fonction.
</p>
<blockquote><pre class="example">crossStaff =
#(define-music-function (notes) (ly:music?)
  (_i &quot;Create cross-staff stems&quot;)
  #{
  \temporary \override Stem.cross-staff = #cross-staff-connect
  \temporary \override Flag.style = #'no-flag
  #notes
  \revert Stem.cross-staff
  \revert Flag.style
#})
</pre></blockquote>


<hr size="6">
<a name="De-l_0027usage-des-math_00e9matiques-dans-les-fonctions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#intermediate-substitution-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctions de substitution intermédiaires&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#music-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions musicales&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#functions-without-arguments" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctions dépourvues d'argument &gt; </a>]</td></tr></table>
<a name="mathematics-in-functions"></a>
<h3 class="subsection">2.3.5 De l&rsquo;usage des mathématiques dans les fonctions</h3>

<p>Une fonction musicale peut requérir, en plus d&rsquo;une simple substitution,
une part de programmation en Scheme.
</p>
<blockquote><pre class="verbatim">AltOn =
#(define-music-function
     (mag)
     (number?)
   #{
     \override Stem.length = #(* 7.0 mag)
     \override NoteHead.font-size =
       #(inexact-&gt;exact (* (/ 6.0 (log 2.0)) (log mag)))
   #})

AltOff = {
  \revert Stem.length
  \revert NoteHead.font-size
}

\relative {
  c'2 \AltOn #0.5 c4 c
  \AltOn #1.5 c c \AltOff c2
}
</pre><p>
 <a href="71/lily-f3e0971d.ly">
  <img align="middle"
       border="0"
       src="71/lily-f3e0971d.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Cette fonction pourrait tout à fait être réécrite de telle sorte qu&rsquo;elle
s&rsquo;applique à une expression musicale :
</p>
<blockquote><pre class="verbatim">withAlt =
#(define-music-function
     (mag music)
     (number? ly:music?)
   #{
     \override Stem.length = #(* 7.0 mag)
     \override NoteHead.font-size =
       #(inexact-&gt;exact (* (/ 6.0 (log 2.0)) (log mag)))
     #music
     \revert Stem.length
     \revert NoteHead.font-size
   #})

\relative {
  c'2 \withAlt #0.5 { c4 c }
  \withAlt #1.5 { c c } c2
}
</pre><p>
 <a href="b1/lily-5c08a228.ly">
  <img align="middle"
       border="0"
       src="b1/lily-5c08a228.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>




<hr size="6">
<a name="Fonctions-d_00e9pourvues-d_0027argument"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#mathematics-in-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; De l'usage des mathématiques dans les fonctions&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#music-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions musicales&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#void-music-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctions musicales fantômes &gt; </a>]</td></tr></table>
<a name="functions-without-arguments"></a>
<h3 class="subsection">2.3.6 Fonctions dépourvues d&rsquo;argument</h3>

<p>Dans la plupart des cas, une fonction dépourvue d&rsquo;argument devrait
être créée à l&rsquo;aide d&rsquo;une variable :
</p>
<blockquote><pre class="example">dolce = \markup{ \italic \bold dolce }
</pre></blockquote>

<p>Il peut, dans certains cas particuliers, s&rsquo;avérer utile de créer une
fonction sans argument comme ici,
</p>
<blockquote><pre class="example">displayBarNum =
#(define-music-function
     ()
     ()
   (if (eq? #t (ly:get-option 'display-bar-numbers))
       #{ \once \override Score.BarNumber.break-visibility = ##f #}
       #{#}))
</pre></blockquote>

<p>de manière à pouvoir afficher les numéros de mesure grâce à un appel à
cette fonction.  En pareil cas, vous devrez invoquer <code>lilypond</code>
en respectant la syntaxe
</p>
<blockquote><pre class="example">lilypond -d display-bar-numbers MONFICHIER.ly
</pre></blockquote>


<hr size="6">
<a name="Fonctions-musicales-fant_00f4mes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#functions-without-arguments" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctions dépourvues d'argument&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#music-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions musicales&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#event-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctions événementielles &gt; </a>]</td></tr></table>
<a name="void-music-functions"></a>
<h3 class="subsection">2.3.7 Fonctions musicales fantômes</h3>

<p>Une fonction musicale doit renvoyer une expression musicale.  Toutefois,
une fonction musicale peut n&rsquo;être exécutée que dans le but d&rsquo;en retenir
les effets annexes ; vous devrez alors utiliser une procédure
<code>define-void-function</code>.  Il peut cependant arriver que vous ayez
besoin d&rsquo;une fonction qui, selon le cas, produise ou non (comme dans
l&rsquo;exemple de la rubrique précédente) une expression musicale.
L&rsquo;utilisation d&rsquo;un <code>#{ #}</code> vous permettra de renvoyer une
expression musicale <code>void</code>.
</p>

<hr size="6">
<a name="Fonctions-_00e9v_00e9nementielles"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#void-music-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctions musicales fantômes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#interfaces-for-programmers" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#markup-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctions pour markups &gt; </a>]</td></tr></table>
<a name="event-functions"></a>
<h2 class="section">2.4 Fonctions événementielles</h2>

<a name="index-define_002devent_002dfunction"></a>
<a name="index-define_002devent_002dfunction-1"></a>
<a name="index-evenementielle_002c-fonction"></a>

<p>L&rsquo;utilisation d&rsquo;une fonction musicale pour placer un événement requiert
l&rsquo;insertion d&rsquo;un indicateur de position, ce qui peut ne pas correspondre
à la syntaxe de la construction à remplacer.  C&rsquo;est par exemple le cas
lorsque vous voulez écrire une commande de nuance, instruction qui
ne comporte habituellement pas d&rsquo;indicateur de positionnement, comme
dans <code>c'\pp</code>.  Voici de quoi vous permettre de mentionner n&rsquo;importe
quelle nuance :
</p>
<blockquote><pre class="verbatim">dyn=#(define-event-function (arg) (markup?)
         (make-dynamic-script arg))
\relative { c'\dyn pfsss }
</pre><p>
 <a href="4d/lily-e8657a1e.ly">
  <img align="middle"
       border="0"
       src="4d/lily-e8657a1e.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Vous pourriez obtenir le même résultat avec une fonction musicale, à
ceci près que chaque appel à la fonction devra être précédé d&rsquo;un
indicateur de positionnement, comme <code>c-\dyn pfsss</code>.
</p>

<hr size="6">
<a name="Fonctions-pour-markups"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#event-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctions événementielles&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#interfaces-for-programmers" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#markup-construction-in-scheme" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Construction d'un markup en Scheme &gt; </a>]</td></tr></table>
<a name="markup-functions"></a>
<h2 class="section">2.5 Fonctions pour <em>markups</em></h2>

<p>Les <em>markups</em> sont implémentés au travers de fonctions Scheme
spécifiques qui produisent des objets <code>Stencil</code> comprenant un
certain nombre d&rsquo;arguments.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#markup-construction-in-scheme" accesskey="1">2.5.1 Construction d&rsquo;un <em>markup</em> en Scheme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#how-markups-work-internally" accesskey="2">2.5.2 Fonctionnement interne des <em>markups</em></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#new-markup-command-definition" accesskey="3">2.5.3 Définition d&rsquo;une nouvelle commande de <em>markup</em></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#new-markup-list-command-definition" accesskey="4">2.5.4 Définition d&rsquo;une nouvelle commande de liste de <em>markups</em></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Construction-d_0027un-markup-en-Scheme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#markup-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctions pour markups&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#markup-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions pour markups&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#how-markups-work-internally" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctionnement interne des markups &gt; </a>]</td></tr></table>
<a name="markup-construction-in-scheme"></a>
<h3 class="subsection">2.5.1 Construction d&rsquo;un <em>markup</em> en Scheme</h3>

<a name="index-definition-d_0027une-commande-markup"></a>

<a name="index-_005cdisplayScheme"></a>
<a name="index-_005cdisplayScheme-1"></a>

<p>Les expressions <em>markup</em> sont représentées en Scheme de manière
interne par la macro <code>markup</code> :
</p>
<blockquote><pre class="example">(markup <var>expression</var>)
</pre></blockquote>

<p>La commande <code>\displayScheme</code> permet d&rsquo;obtenir la représentation en
Scheme d&rsquo;une expression <em>markup</em> :
</p>
<blockquote><pre class="example">\displayScheme
\markup {
  \column {
    \line { \bold \italic &quot;hello&quot; \raise #0.4 &quot;world&quot; }
    \larger \line { foo bar baz }
  }
}
</pre></blockquote>

<p>Compiler ce code renverra en console les lignes suivantes :
</p>
<blockquote><pre class="example">(markup
  #:line
  (#:column
   (#:line
    (#:bold (#:italic &quot;hello&quot;) #:raise 0.4 &quot;world&quot;)
    #:larger
    (#:line
     (#:simple &quot;foo&quot; #:simple &quot;bar&quot; #:simple &quot;baz&quot;)))))
</pre></blockquote>

<p>L&rsquo;impression du <em>markup</em> sera suspendue dès lors qu&rsquo;apparaîtra un
&lsquo;<samp>\void \displayScheme <var>markup</var></samp>&rsquo;.  Tout comme pour la
commande <code>\displayMusic</code>, le résultat de <code>\displayScheme</code> peut
être sauvegardé dans un fichier séparé.  Voir à ce sujet
<a href="#displaying-music-expressions">Affichage d&rsquo;expressions musicales</a>.
</p>
<p>Vous pouvez constater les principales règles de traduction entre les
syntaxes respectives de LilyPond et de Scheme en matière de
<em>markup</em>.  Bien que le passage en syntaxe LilyPond grâce à
<code>#{ &hellip; #}</code> apporte de la souplesse, nous allons voir comment
utiliser la macro <code>markup</code> en Scheme exclusivement.
</p>
<blockquote><table>
<tr><td width="30%"><p> <b>LilyPond</b> </p></td><td width="30%"><p> <b>Scheme</b>
</p></td></tr>
<tr><td width="30%"><p> <code>\markup markup1</code> </p></td><td width="30%"><p> <code>(markup markup1)</code>
</p></td></tr>
<tr><td width="30%"><p> <code>\markup { markup1 markup2&hellip; }</code> </p></td><td width="30%"><p>        <code>(markup markup1 markup2&hellip; )</code>
</p></td></tr>
<tr><td width="30%"><p> <code>\commande-markup</code> </p></td><td width="30%"><p> <code>#:commande-markup</code>
</p></td></tr>
<tr><td width="30%"><p> <code>\variable</code> </p></td><td width="30%"><p> <code>variable</code>
</p></td></tr>
<tr><td width="30%"><p> <code>\center-column { &hellip; }</code> </p></td><td width="30%"><p>        <code>#:center-column ( &hellip; )</code>
</p></td></tr>
<tr><td width="30%"><p> <code>chaîne</code> </p></td><td width="30%"><p> <code>&quot;chaîne&quot;</code>
</p></td></tr>
<tr><td width="30%"><p> <code>#argument-scheme</code> </p></td><td width="30%"><p> <code>argument-scheme</code>
</p></td></tr>
</table>
</blockquote>

<p>L&rsquo;intégralité du langage Scheme est accessible à l&rsquo;intérieur même de la
macro <code>markup</code>.  Vous pouvez ainsi appeler des fonctions à partir
de <code>markup</code> pour manipuler des chaînes de caractères, ce qui est
particulièrement pratique lorsque vous créez votre propre commande de
<em>markup</em> &ndash; voir
<a href="#new-markup-command-definition">Définition d&rsquo;une nouvelle commande de <em>markup</em></a>.
</p>
<a name="Problemes-connus-et-avertissements-1"></a>
<h4 class="subsubheading">Problèmes connus et avertissements</h4>
<p>L&rsquo;argument <var>markup-list</var> des commandes <code>#:line</code>,
<code>#:center</code> ou <code>#:column</code> ne saurait être une variable ni le
résultat de l&rsquo;appel à une fonction.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">(markup #:line (fonction-qui-retourne-des-markups))
</pre></td></tr></table>

<p>n&rsquo;est pas valide.  Il vaut mieux, en pareil cas, utiliser les fonctions
<code>make-line-markup</code>, <code>make-center-markup</code> ou
<code>make-column-markup</code> :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">(markup (make-line-markup (fonction-qui-retourne-des-markups)))
</pre></td></tr></table>


<hr size="6">
<a name="Fonctionnement-interne-des-markups"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#markup-construction-in-scheme" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Construction d'un markup en Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#markup-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions pour markups&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#new-markup-command-definition" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Définition d'une nouvelle commande de markup &gt; </a>]</td></tr></table>
<a name="how-markups-work-internally"></a>
<h3 class="subsection">2.5.2 Fonctionnement interne des <em>markups</em></h3>

<p>Dans un <em>markup</em> tel que
</p>
<blockquote><pre class="example">\raise #0.5 &quot;text example&quot;
</pre></blockquote>

<p><code>\raise</code> représente en fait la fonction <code>raise-markup</code>.
L&rsquo;expression <em>markup</em> est enregistrée sous la forme
</p>
<blockquote><pre class="example">(list raise-markup 0.5 (list simple-markup &quot;text example&quot;))
</pre></blockquote>

<p>Lorsque ce <em>markup</em> est converti en objets imprimables (stencils),
la fonction <code>raise-markup</code> est appelée ainsi :
</p>
<blockquote><pre class="example">(apply raise-markup
       <var>\layout objet</var>
       <var>liste des alists de propriété</var>
       0.5
       <var>le <em>markup</em> &quot;text example&quot;</var>)
</pre></blockquote>

<p>La fonction <code>raise-markup</code> commence par créer le stencil pour la
chaîne <code>text example</code>, puis remonte ce stencil d&rsquo;un demi espace de
portée.  Il s&rsquo;agit là d&rsquo;un exemple relativement simple, et nous en
aborderons de plus complexes au fil des paragraphes suivants ;
d&rsquo;autres exemples se trouvent directement dans le fichier
&lsquo;<tt>scm/define-markup-commands.scm</tt>&rsquo;.
</p>

<hr size="6">
<a name="D_00e9finition-d_0027une-nouvelle-commande-de-markup"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#how-markups-work-internally" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctionnement interne des markups&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#markup-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions pour markups&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#markup-command-definition-syntax" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Syntaxe d'une commande markup &gt; </a>]</td></tr></table>
<a name="new-markup-command-definition"></a>
<h3 class="subsection">2.5.3 Définition d&rsquo;une nouvelle commande de <em>markup</em></h3>

<p>Nous allons étudier dans ce qui suit la manière de définir une nouvelle
commande de <em>markup</em>.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#markup-command-definition-syntax" accesskey="1">Syntaxe d&rsquo;une commande <em>markup</em></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#on-properties" accesskey="2">Attribution de propriétés</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#a-complete-example" accesskey="3">Exemple commenté</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#adapting-builtin-commands" accesskey="4">Adaptation d&rsquo;une commande incorporée</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Syntaxe-d_0027une-commande-markup"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#new-markup-command-definition" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Définition d'une nouvelle commande de markup&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#new-markup-command-definition" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Définition d'une nouvelle commande de markup&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#on-properties" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Attribution de propriétés &gt; </a>]</td></tr></table>
<a name="markup-command-definition-syntax"></a>
<h4 class="unnumberedsubsubsec">Syntaxe d&rsquo;une commande <em>markup</em></h4>

<p>Une commande de <em>markup</em> personnalisée se définit à l&rsquo;aide de la
macro Scheme <code>define-markup-command</code>, placée en tête de fichier.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">(define-markup-command (<var>nom-commande</var> <var>layout</var> <var>props</var> <var>arg1</var> <var>arg2</var>&hellip;)
    (<var>arg1-type?</var> <var>arg2-type?</var>&hellip;)
    [ #:properties ((<var>propriété1</var> <var>valeur-par-défaut1</var>)
                    &hellip;) ]
  &hellip;corps de la commande&hellip;)
</pre></td></tr></table>

<p>Quelques commentaires sur les arguments :
</p>
<dl compact="compact">
<dt> <code><var>nom-commande</var></code></dt>
<dd><p>le nom que vous attribuez à votre commande de <em>markup</em>.
</p></dd>
<dt> <code>layout</code></dt>
<dd><p>la définition du « layout » &ndash; son formatage.
</p></dd>
<dt> <code>props</code></dt>
<dd><p>une liste de listes associatives, comprenant toutes les propriétés actives.
</p></dd>
<dt> <code><var>argi</var></code></dt>
<dd><p>le <var>ième</var> argument de la commande.
</p></dd>
<dt> <code><var>argi-type?</var></code></dt>
<dd><p>un type de prédicat pour le <var>ième</var> argument.
</p></dd>
</dl>

<p>Si la commande utilise des propriétés à partir des arguments
<code>props</code>, le mot-clé <code>#:properties</code> permet de spécifier ces
différentes propriétés ainsi que leur valeur par défaut.
</p>
<p>Les arguments se distinguent selon leur type :
</p><ul>
<li> un <em>markup</em>, correspondant au type de prédicat
<code>markup?</code> ;
</li><li> une liste de <em>markups</em>, correspondant au type de prédicat
<code>markup-list?</code> ;
</li><li> tout autre objet Scheme, correspondant au types de prédicat tels
que <code>list?</code>, <code>number?</code>, <code>boolean?</code>, etc.
</li></ul>

<p>Il n&rsquo;existe aucune restriction quant à l&rsquo;ordre des arguments fournis à
la suite des arguments <code>layout</code> et <code>props</code>.  Néanmoins, les
fonctions <em>markup</em> qui ont en dernier argument un <em>markup</em> ont
ceci de particulier qu&rsquo;elles peuvent s&rsquo;appliquer à des listes de
<em>markups</em> ; ceci résultera en une liste de <em>markups</em> où
tous les éléments de la liste originelle se verront appliquer cette
fonction <em>markup</em> avec ses arguments de tête.
</p>
<p>La réplication des arguments de tête dans le but d&rsquo;appliquer une
fonction <em>markup</em> à une liste de markups est économique,
principalement lorsqu&rsquo;il s&rsquo;agit d&rsquo;arguments Scheme.  Vous éviterez
ainsi d&rsquo;éventuelles pertes de performance en utilisant des arguments
Scheme en tant qu&rsquo;arguments principaux d&rsquo;une fonction <em>markup</em> dont
le dernier argument est un <em>markup</em>.
</p>
<a name="index-markup-macro"></a>
<a name="index-macro-de-markup"></a>
<a name="index-_005cmarkup"></a>
<a name="index-_005cmarkup-1"></a>
<a name="index-interpret_002dmarkup"></a>
<a name="index-interpret_002dmarkup-1"></a>

<p>Les commandes de <em>markup</em> ont un cycle de vie relativement
complexe.  Le corps de la définition d&rsquo;une commande de <em>markup</em> est
chargé de convertir les arguments de la commande en expression stencil
qui sera alors renvoyée.  Bien souvent, ceci s&rsquo;accomplit par un appel à
la fonction <code>interpret-markup</code>, en lui passant les arguments
<var>layout</var> et <var>props</var>.  Ces arguments ne seront en principe connus
que bien plus tardivement dans le processus typographique.  Lors de
l&rsquo;expansion d&rsquo;une expression LilyPond <code>\markup</code> ou d&rsquo;une macro
Scheme <code>markup</code>, les expressions <em>markup</em> auront déjà vu leurs
composants assemblés en expressions <em>markup</em>.  L&rsquo;évaluation et le
contrôle du type des arguments à une commande de <em>markup</em>
n&rsquo;interviennent qu&rsquo;au moment de l&rsquo;interprétation de <code>\markup</code> ou
<code>markup</code>.
</p>
<p>Seule l&rsquo;application de <code>interpret-markup</code> sur une expression
<em>markup</em> réalisera effectivement la conversion des expressions
<em>markup</em> en stencil, au travers de l&rsquo;exécution du corps des
fonctions <em>markup</em>.
</p>

<hr size="6">
<a name="Attribution-de-propri_00e9t_00e9s"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#markup-command-definition-syntax" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Syntaxe d'une commande markup&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#new-markup-command-definition" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Définition d'une nouvelle commande de markup&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#a-complete-example" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Exemple commenté &gt; </a>]</td></tr></table>
<a name="on-properties"></a>
<h4 class="unnumberedsubsubsec">Attribution de propriétés</h4>

<p>Les arguments <code>layout</code> et <code>props</code> d&rsquo;une commande de
<em>markup</em> fournissent un contexte à l&rsquo;interprétation du
<em>markup</em> : taille de fonte, longueur de ligne, etc.
</p>
<p>L&rsquo;argument <code>layout</code> permet d&rsquo;accéder aux propriétés définies dans
les blocs <code>\paper</code>, grâce à la fonction
<code>ly:output-def-lookup</code>.  Par exemple, la longueur de ligne,
identique à celle de la partition, est lue au travers de
</p>
<blockquote><pre class="example">(ly:output-def-lookup layout 'line-width)
</pre></blockquote>

<p>L&rsquo;argument <code>props</code> rend certaines propriétés accessibles aux
commandes de <em>markup</em>.  Il en va ainsi lors de l&rsquo;interprétation
d&rsquo;un <em>markup</em> de titre d&rsquo;ouvrage : toutes les variables
définies dans le bloc <code>\header</code> sont automatiquement ajoutées aux
<code>props</code>, de telle sorte que le <em>markup</em> de titrage de
l&rsquo;ouvrage pourra accéder aux différents champs titre, compositeur, etc.
Ceci permet aussi de configurer le comportement d&rsquo;une commande de
<em>markup</em> : la taille des fontes, par exemple, est lue à
partir de <code>props</code> plutôt que grâce à un argument <code>font-size</code>.
La fonction appelant une commande de <em>markup</em> peut altérer la
valeur de la propriété taille des fontes et donc en modifier le
comportement.  L&rsquo;utilisation du mot-clé <code>#:properties</code>, attaché à
<code>define-markup-command</code>, permet de spécifier les propriétés devant
être lues parmi les arguments <code>props</code>.
</p>
<p>L&rsquo;exemple proposé à la rubrique suivante illustre comment, au sein d&rsquo;une
commande de <em>markup</em>, accéder aux différentes propriétés et les
modifier.
</p>

<hr size="6">
<a name="Exemple-comment_00e9"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#on-properties" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Attribution de propriétés&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#new-markup-command-definition" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Définition d'une nouvelle commande de markup&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#adapting-builtin-commands" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Adaptation d'une commande incorporée &gt; </a>]</td></tr></table>
<a name="a-complete-example"></a>
<h4 class="unnumberedsubsubsec">Exemple commenté</h4>

<p>Nous allons, dans cet exemple, nous attacher à encadrer du texte avec un
double liseré.
</p>
<p>Commençons par construire quelque chose d&rsquo;approximatif à l&rsquo;aide d&rsquo;un
simple <em>markup</em>.  La lecture de <a name="index-Commandes-pour-markup"></a>
<a href="notation-big-page.fr.html#text-markup-commands">Commandes pour markup</a> nous
indique la commande <code>\box</code>, qui semble ici appropriée.
</p>
<blockquote><pre class="verbatim">\markup \box \box HELLO
</pre><p>
 <a href="75/lily-43f5cbce.ly">
  <img align="middle"
       border="0"
       src="75/lily-43f5cbce.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Dans un souci d&rsquo;esthétique, nous aimerions que le texte et les
encadrements ne soient pas autant accolés.  Selon la documentation de
<code>\box</code>, cette commande utilise la propriété <code>box-padding</code>,
fixée par défaut à 0,2.  Cette même documentation nous indique
aussi comment la modifier :
</p>
<blockquote><pre class="verbatim">\markup \box \override #'(box-padding . 0.6) \box A
</pre><p>
 <a href="81/lily-7d9eea09.ly">
  <img align="middle"
       border="0"
       src="81/lily-7d9eea09.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>L&rsquo;espacement des deux liserés est cependant toujours trop réduit ;
modifions le à son tour :
</p>
<blockquote><pre class="verbatim">\markup \override #'(box-padding . 0.4) \box
     \override #'(box-padding . 0.6) \box A
</pre><p>
 <a href="b5/lily-8a9d114e.ly">
  <img align="middle"
       border="0"
       src="b5/lily-8a9d114e.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Vous conviendrez que recopier une telle définition de <em>markup</em>
deviendra vite fastidieux.  C&rsquo;est pourquoi nous écrivons la commande de
<em>markup</em> <code>double-box</code> qui prendra un seul argument &ndash; le
texte.  Cette commande se chargera de dessiner les encadrements, en
tenant compte des espacements.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">#(define-markup-command (double-box layout props text) (markup?)
  &quot;Dessine un double encadrement autour du texte.&quot;
  (interpret-markup layout props
    #{\markup \override #'(box-padding . 0.4) \box
            \override #'(box-padding . 0.6) \box { #text }#}))
</pre></td></tr></table>

<p>ou bien son équivalent
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">#(define-markup-command (double-box layout props text) (markup?)
  &quot;Dessine un double encadrement autour du texte.&quot;
  (interpret-markup layout props
    (markup #:override '(box-padding . 0.4) #:box
            #:override '(box-padding . 0.6) #:box text)))
</pre></td></tr></table>

<p><code>text</code> est le nom de l&rsquo;argument de notre commande, et
<code>markup?</code> son type &ndash; l&rsquo;argument sera identifié comme étant un
<em>markup</em>.  La fonction <code>interpret-markup</code>, utilisée dans la
plupart des commandes de <em>markup</em>, construira un stencil à partir
de <code>layout</code>, <code>props</code> et un <em>markup</em>.  Dans la seconde
variante, ce <em>markup</em> sera construit à l&rsquo;aide de la macro Scheme
<code>markup</code> &ndash; voir <a href="#markup-construction-in-scheme">Construction d&rsquo;un <em>markup</em> en Scheme</a>.  La
transformation d&rsquo;une expression <code>\markup</code> en expression Scheme est
des plus triviales.
</p>
<p>Notre commande personnalisée s&rsquo;utilise ainsi :
</p>
<blockquote><pre class="example">\markup \double-box A
</pre></blockquote>

<p>Il serait intéressant de rendre cette commande <code>double-box</code> plus
souple :  les valeurs de <code>box-padding</code> sont figées et ne
peuvent être modifiées à l&rsquo;envie.  Pareillement, il serait bien de
distinguer l&rsquo;espacement entre les encadrements de l&rsquo;espacement entre le
texte et ses encadrements.  Nous allons donc introduire une propriété
supplémentaire, que nous appellerons <code>inter-box-padding</code>, chargée
de gérer l&rsquo;espacement des encadrements ; <code>box-padding</code> ne
servira alors que pour l&rsquo;espacement intérieur.  Voici le code adapté à
ces évolutions :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">#(define-markup-command (double-box layout props text) (markup?)
  #:properties ((inter-box-padding 0.4)
                (box-padding 0.6))
  &quot;Dessine un double encadrement autour du texte.&quot;
  (interpret-markup layout props
    #{\markup \override #`(box-padding . ,inter-box-padding) \box
               \override #`(box-padding . ,box-padding) \box
               { #text } #}))
</pre></td></tr></table>

<p>Ainsi que son équivalent à partir de la macro <em>markup</em> :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">#(define-markup-command (double-box layout props text) (markup?)
  #:properties ((inter-box-padding 0.4)
                (box-padding 0.6))
  &quot;Dessine un double encadrement autour du texte.&quot;
  (interpret-markup layout props
    (markup #:override `(box-padding . ,inter-box-padding) #:box
            #:override `(box-padding . ,box-padding) #:box text)))
</pre></td></tr></table>

<p>C&rsquo;est ici le mot-clé <code>#:properties</code> qui permet de lire les
propriétés <code>inter-box-padding</code> et <code>box-padding</code> à partir de
l&rsquo;argumenet <code>props</code> ; on leur a d&rsquo;ailleurs fourni des valeurs
par défaut au cas où elles ne seraient pas définies.
</p>
<p>Ces valeurs permettront alors d&rsquo;adapter les propriétés de
<code>box-padding</code> utilisées par les deux commandes <code>\box</code>.  Vous
aurez remarqué, dans l&rsquo;argument <code>\override</code>, la présence de
l&rsquo;apostrophe inversée (<code>`</code>) et de la virgule ; elles vous
permettent d&rsquo;insérer une valeur variable au sein d&rsquo;une expression
littérale.
</p>
<p>Notre commande est maintenant prête à servir dans un <em>markup</em>, et
les encadrements sont repositionnables.
</p>
<blockquote><pre class="verbatim">#(define-markup-command (double-box layout props text) (markup?)
  #:properties ((inter-box-padding 0.4)
                (box-padding 0.6))
  &quot;Draw a double box around text.&quot;
  (interpret-markup layout props
    #{\markup \override #`(box-padding . ,inter-box-padding) \box
              \override #`(box-padding . ,box-padding) \box
              { #text } #}))

\markup \double-box A
\markup \override #'(inter-box-padding . 0.8) \double-box A
\markup \override #'(box-padding . 1.0) \double-box A
</pre><p>
 <a href="94/lily-b1443df4.ly">
  <img align="middle"
       border="0"
       src="94/lily-b1443df4.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>




<hr size="6">
<a name="Adaptation-d_0027une-commande-incorpor_00e9e"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#a-complete-example" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Exemple commenté&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#new-markup-command-definition" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Définition d'une nouvelle commande de markup&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#new-markup-list-command-definition" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Définition d'une nouvelle commande de liste de markups &gt; </a>]</td></tr></table>
<a name="adapting-builtin-commands"></a>
<h4 class="unnumberedsubsubsec">Adaptation d&rsquo;une commande incorporée</h4>

<p>Le meilleur moyen de construire ses propres commandes de <em>markup</em>
consiste à prendre exemple sur les commandes déjà incorporées.  La
plupart des commandes de <em>markup</em> fournies avec LilyPond sont
répertoriées dans le fichier &lsquo;<tt>scm/define-markup-commands.scm</tt>&rsquo;.
</p>
<p>Nous pourrions, par exemple, envisager d&rsquo;adapter la commande
<code>\draw-line</code> pour dessiner plutôt une ligne double.  Voici comment
est définie la commande <code>\draw-line</code>, expurgée de sa
documentation :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">(define-markup-command (draw-line layout props dest)
  (number-pair?)
  #:category graphic
  #:properties ((thickness 1))
  &quot;&hellip;documentation&hellip;&quot;
  (let ((th (* (ly:output-def-lookup layout 'line-thickness)
               thickness))
        (x (car dest))
        (y (cdr dest)))
    (make-line-stencil th 0 0 x y)))
</pre></td></tr></table>

<p>Avant de définir notre propre commande basée sur l&rsquo;une de celles
fournies par LilyPond, commençons par en recopier la définition, puis
attribuons lui un autre nom.  Le mot-clé <code>#:category</code> peut être
supprimé sans risque ; il ne sert que lors de la génération de la
documentation et n&rsquo;est d&rsquo;aucune utilité pour une commande personnalisée.
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">(define-markup-command (draw-double-line layout props dest)
  (number-pair?)
  #:properties ((thickness 1))
  &quot;&hellip;documentation&hellip;&quot;
  (let ((th (* (ly:output-def-lookup layout 'line-thickness)
               thickness))
        (x (car dest))
        (y (cdr dest)))
    (make-line-stencil th 0 0 x y)))
</pre></td></tr></table>

<p>Nous ajoutons ensuite une propriété pour gérer l&rsquo;écart entre les deux
lignes, que nous appelons <code>line-gap</code>, et lui attribuons une valeur
par défaut de 6 dixièmes :
</p>
<table><tr><td>&nbsp;</td><td><pre class="lisp">(define-markup-command (draw-double-line layout props dest)
  (number-pair?)
  #:properties ((thickness 1)
                (line-gap 0.6))
  &quot;&hellip;documentation&hellip;&quot;
  &hellip;
</pre></td></tr></table>

<p>Nous ajoutons enfin le code qui dessinera nos deux lignes.  Deux appels
à <code>make-line-stencil</code> permettrons de dessiner les lignes dont nous
regrouperons les stencils à l&rsquo;aide de <code>ly:stencil-add</code> :
</p>
<blockquote><pre class="verbatim">#(define-markup-command (my-draw-line layout props dest)
  (number-pair?)
  #:properties ((thickness 1)
                (line-gap 0.6))
  &quot;..documentation..&quot;
  (let* ((th (* (ly:output-def-lookup layout 'line-thickness)
                thickness))
         (dx (car dest))
         (dy (cdr dest))
         (w (/ line-gap 2.0))
         (x (cond ((= dx 0) w)
                  ((= dy 0) 0)
                  (else (/ w (sqrt (+ 1 (* (/ dx dy) (/ dx dy))))))))
         (y (* (if (&lt; (* dx dy) 0) 1 -1)
               (cond ((= dy 0) w)
                     ((= dx 0) 0)
                     (else (/ w (sqrt (+ 1 (* (/ dy dx) (/ dy dx))))))))))
     (ly:stencil-add (make-line-stencil th x y (+ dx x) (+ dy y))
                     (make-line-stencil th (- x) (- y) (- dx x) (- dy y)))))

\markup \my-draw-line #'(4 . 3)
\markup \override #'(line-gap . 1.2) \my-draw-line #'(4 . 3)
</pre><p>
 <a href="f2/lily-ee1c28e4.ly">
  <img align="middle"
       border="0"
       src="f2/lily-ee1c28e4.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>




<hr size="6">
<a name="D_00e9finition-d_0027une-nouvelle-commande-de-liste-de-markups"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#adapting-builtin-commands" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Adaptation d'une commande incorporée&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#markup-functions" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Fonctions pour markups&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#contexts-for-programmers" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Contextes pour programmeurs &gt; </a>]</td></tr></table>
<a name="new-markup-list-command-definition"></a>
<h3 class="subsection">2.5.4 Définition d&rsquo;une nouvelle commande de liste de <em>markups</em></h3>

<a name="index-liste-de-markup_002c-definition-de-commande"></a>
<a name="index-define_002dmarkup_002dlist_002dcommand"></a>
<a name="index-define_002dmarkup_002dlist_002dcommand-1"></a>
<a name="index-interpret_002dmarkup_002dlist"></a>
<a name="index-interpret_002dmarkup_002dlist-1"></a>

<p>Une commande traitant une liste de <em>markups</em> se définit à l&rsquo;aide de
la macro Scheme <code>define-markup-list-command</code>, de manière analogue à
la macro <code>define-markup-command</code> abordée à la rubrique
<a href="#new-markup-command-definition">Définition d&rsquo;une nouvelle commande de <em>markup</em></a>, à ceci près que
cette dernière renvoie un seul stencil, non une liste de stencils.
</p>
<p>La fonction <code>interpret-markup-list</code>, à l&rsquo;instar de la fonction
<code>interpret-markup</code>, permet de convertir une liste de <em>markups</em>
en liste de stencils.
</p>
<p>Dans l&rsquo;exemple suivant, nous définissons <code>\paragraph</code>, une commande
de liste de <em>markups</em>, qui renverra une liste de lignes justifiées
dont la première sera indentée.  La largeur de l&rsquo;alinéa sera récupérée
par l&rsquo;argument <code>props</code>.
</p>
<blockquote><pre class="example">#(define-markup-list-command (paragraph layout props args) (markup-list?)
   #:properties ((par-indent 2))
   (interpret-markup-list layout props
     #{\markuplist \justified-lines { \hspace #par-indent #args } #}))
</pre></blockquote>

<p>La version purement Scheme est un peu plus complexe :
</p><blockquote><pre class="example">#(define-markup-list-command (paragraph layout props args) (markup-list?)
   #:properties ((par-indent 2))
   (interpret-markup-list layout props
     (make-justified-lines-markup-list (cons (make-hspace-markup par-indent)
                                             args))))
</pre></blockquote>

<p>En dehors des habituels arguments <code>layout</code> et <code>props</code>, la
commande de liste de <em>markups</em> <code>paragraph</code> prend en argument
une liste de <em>markups</em> appelée <code>args</code>.  Le prédicat des listes
de <em>markups</em> est <code>markup-list?</code>.
</p>
<p>Pour commencer, la fonction récupère la taille de l&rsquo;alinéa, propriété
ici dénommée <code>par-indent</code>, à partir de la liste de propriétés
<code>props</code>.  En cas d&rsquo;absence, la valeur par défaut sera
de <code>2</code>.  Ensuite est créée une liste de lignes justifiées
grâce à la commande prédéfinie <code>\justified-lines</code>, liée à la
fonction <code>make-justified-lines-markup-list</code>.  Un espace horizontal
est ajouté en tête, grâce à <code>\hspace</code> ou à la fonction
<code>make-hspace-markup</code>.  Enfin, la liste de <em>markups</em> est
interprétée par la fonction <code>interpret-markup-list</code>.
</p>
<p>Voici comment utiliser cette nouvelle commande de liste de
<em>markups</em> :
</p>
<blockquote><pre class="example">\markuplist {
  \paragraph {
    The art of music typography is called \italic {(plate) engraving.}
    The term derives from the traditional process of music printing.
    Just a few decades ago, sheet music was made by cutting and stamping
    the music into a zinc or pewter plate in mirror image.
  }
  \override-lines #'(par-indent . 4) \paragraph {
    The plate would be inked, the depressions caused by the cutting
    and stamping would hold ink.  An image was formed by pressing paper
    to the plate.  The stamping and cutting was completely done by
    hand.
  }
}
</pre></blockquote>


<hr size="6">
<a name="Contextes-pour-programmeurs"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#new-markup-list-command-definition" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Définition d'une nouvelle commande de liste de markups&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#interfaces-for-programmers" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#context-evaluation" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Évaluation d'un contexte &gt; </a>]</td></tr></table>
<a name="contexts-for-programmers"></a>
<h2 class="section">2.6 Contextes pour programmeurs</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#context-evaluation" accesskey="1">2.6.1 Évaluation d&rsquo;un contexte</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#running-a-function-on-all-layout-objects" accesskey="2">2.6.2 Application d&rsquo;une fonction à tous les objets de mise en forme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="g_t_00c9valuation-d_0027un-contexte"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#contexts-for-programmers" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Contextes pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#contexts-for-programmers" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Contextes pour programmeurs&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#running-a-function-on-all-layout-objects" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Application d'une fonction à tous les objets de mise en forme &gt; </a>]</td></tr></table>
<a name="context-evaluation"></a>
<h3 class="subsection">2.6.1 Évaluation d&rsquo;un contexte</h3>

<a name="index-appel-de-code-durant-l_0027interpretation"></a>
<a name="index-_005capplyContext"></a>
<a name="index-_005capplyContext-1"></a>
<a name="index-make_002dapply_002dcontext"></a>
<a name="index-make_002dapply_002dcontext-1"></a>
<a name="index-ly_003acontext_002dproperty"></a>
<a name="index-ly_003acontext_002dproperty-1"></a>
<a name="index-ly_003acontext_002dset_002dproperty_0021"></a>
<a name="index-ly_003acontext_002dset_002dproperty_0021-1"></a>
<a name="index-ly_003acontext_002dgrob_002ddefinition"></a>
<a name="index-ly_003acontext_002dgrob_002ddefinition-1"></a>
<a name="index-ly_003aassoc_002dget"></a>
<a name="index-ly_003aassoc_002dget-1"></a>
<a name="index-ly_003acontext_002dpushpop_002dproperty"></a>
<a name="index-ly_003acontext_002dpushpop_002dproperty-1"></a>

<p>Un contexte peut être modifié, au moment même de son interprétation, par
du code Scheme.  La syntaxe consacrée au sein d&rsquo;un bloc LilyPond est
</p>
<blockquote><pre class="example">\applyContext <var>fonction</var>
</pre></blockquote>

<p>et, dans le cadre d&rsquo;un code Scheme :
</p>
<blockquote><pre class="example">(make-apply-context <var>fonction</var>)
</pre></blockquote>

<p><code><var>fonction</var></code> est constitué d&rsquo;une fonction Scheme comportant un
unique argument : le contexte au sein duquel la commande
<code>\applyContext</code> est appelée.  Cette fonction peut accéder aussi
bien aux propriétés de <em>grob</em> (y compris modifiées par
<code>\override</code> ou <code>\set</code>) qu&rsquo;aux propriétés de contexte.  Toute
action entreprise par la fonction et qui dépendrait de l&rsquo;état du
contexte sera limitée à l&rsquo;état de ce contexte <b>au moment de l&rsquo;appel à
la fonction</b>.  Par ailleurs, les adaptations résultant d&rsquo;un appel à
<code>\applyContext</code> seront effectives jusqu&rsquo;à ce qu&rsquo;elles soient à
nouveau directement modifiées ou bien annulées, quand bien même les
conditions initiales dont elles dépendent auraient changé.
</p>
<p>Voici quelques fonctions Scheme utiles avec <code>\applyContext</code> :
</p>
<dl compact="compact">
<dt> <code>ly:context-property</code></dt>
<dd><p>recherche la valeur d&rsquo;une propriété de contexte,
</p>
</dd>
<dt> <code>ly:context-set-property!</code></dt>
<dd><p>détermine une propriété de contexte,
</p>
</dd>
<dt> <code>ly:context-grob-definition</code></dt>
<dt> <code>ly:assoc-get</code></dt>
<dd><p>recherche la valeur d&rsquo;une propriété de <em>grob</em>,
</p>
</dd>
<dt> <code>ly:context-pushpop-property</code></dt>
<dd><p>réalise un <code>\temporary \override</code> ou un <code>\revert</code> sur une
propriété de <em>grob</em>.
</p></dd>
</dl>

<p>L&rsquo;exemple suivant recherche la valeur en cours de <code>fontSize</code> puis
la double :
</p>
<blockquote><pre class="verbatim">doubleFontSize =
\applyContext
  #(lambda (context)
     (let ((fontSize (ly:context-property context 'fontSize)))
       (ly:context-set-property! context 'fontSize (+ fontSize 6))))

{
  \set fontSize = -3
  b'4
  \doubleFontSize
  b'
}
</pre><p>
 <a href="d4/lily-b353ab4a.ly">
  <img align="middle"
       border="0"
       src="d4/lily-b353ab4a.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>L&rsquo;exemple suivant recherche la couleur des objets <code>NoteHead</code>,
<code>Stem</code> et <code>Beam</code>, puis diminue pour chacun d&rsquo;eux le degré de
saturation.
</p>
<blockquote><pre class="verbatim">desaturate =
\applyContext
  #(lambda (context)
     (define (desaturate-grob grob)
       (let* ((grob-def (ly:context-grob-definition context grob))
              (color (ly:assoc-get 'color grob-def black))
              (new-color (map (lambda (x) (min 1 (/ (1+ x) 2))) color)))
         (ly:context-pushpop-property context grob 'color new-color)))
     (for-each desaturate-grob '(NoteHead Stem Beam)))

\relative {
  \time 3/4
  g'8[ g] \desaturate g[ g] \desaturate g[ g]
 \override NoteHead.color = #darkred
  \override Stem.color = #darkred
  \override Beam.color = #darkred
  g[ g] \desaturate g[ g] \desaturate g[ g]
}
</pre><p>
 <a href="e3/lily-07b01cdf.ly">
  <img align="middle"
       border="0"
       src="e3/lily-07b01cdf.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Ceci pourrait tout à fait s&rsquo;implémenter sous la forme d&rsquo;une fonction
musicale, afin d&rsquo;en réduire les effets à un seul bloc de musique.  Notez
comment <code>ly:context-pushpop-property</code> est utilisé à la fois pour un
<code>\temporary \override</code> et pour un <code>\revert</code> :
</p>
<blockquote><pre class="verbatim">desaturate =
#(define-music-function
   (music) (ly:music?)
   #{
     \applyContext
     #(lambda (context)
        (define (desaturate-grob grob)
          (let* ((grob-def (ly:context-grob-definition context grob))
                 (color (ly:assoc-get 'color grob-def black))
                 (new-color (map (lambda (x) (min 1 (/ (1+ x) 2))) color)))
            (ly:context-pushpop-property context grob 'color new-color)))
        (for-each desaturate-grob '(NoteHead Stem Beam)))
     #music
     \applyContext
     #(lambda (context)
        (define (revert-color grob)
          (ly:context-pushpop-property context grob 'color))
        (for-each revert-color '(NoteHead Stem Beam)))
   #})

\relative {
  \override NoteHead.color = #darkblue
  \override Stem.color = #darkblue
  \override Beam.color = #darkblue
  g'8 a b c
  \desaturate { d c b a }
  g b d b g2
}
</pre><p>
 <a href="03/lily-454b4424.ly">
  <img align="middle"
       border="0"
       src="03/lily-454b4424.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>




<hr size="6">
<a name="Application-d_0027une-fonction-_00e0-tous-les-objets-de-mise-en-forme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#context-evaluation" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Évaluation d'un contexte&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#contexts-for-programmers" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Contextes pour programmeurs&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#callback-functions" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Fonctions de rappel &gt; </a>]</td></tr></table>
<a name="running-a-function-on-all-layout-objects"></a>
<h3 class="subsection">2.6.2 Application d&rsquo;une fonction à tous les objets de mise en forme</h3>

<a name="index-appel-de-code-sur-des-objets-de-mise-en-forme"></a>
<a name="index-objets-de-mise-en-forme_002c-appel-de-code"></a>
<a name="index-_005capplyOutput"></a>
<a name="index-_005capplyOutput-1"></a>

<p>La manière la plus souple d&rsquo;affiner un objet consiste à utiliser la
commande <code>\applyOutput</code>.  Celle-ci va insérer un événement
(<a name="index-ApplyOutputEvent"></a>
<a href="internals-big-page.html#applyoutputevent">ApplyOutputEvent</a>) dans le contexte spécifié.  Elle répond
aussi bien à la syntaxe
</p><blockquote><pre class="example">\applyOutput <var>Contexte</var> <var>procédure</var>
</pre></blockquote>
<p>que
</p><blockquote><pre class="example">\applyOutput <var>Contexte</var>.<var>Grob</var> <var>procédure</var>
</pre></blockquote>

<p>où <code><var>procédure</var></code> est une fonction Scheme à trois arguments.
</p>
<p>Lors de l&rsquo;interprétation de cette commande, la fonction
<code><var>procédure</var></code> est appelée pout tout objet de rendu (nommé
<var>Grob</var> si celui-ci est spécifié) appartenant au contexte
<code><var>Contexte</var></code> à cet instant précis, avec les arguments
suivants :
</p><ul>
<li> l&rsquo;objet de rendu en lui-même,
</li><li> le contexte au sein duquel cet objet est créé,
</li><li> le contexte dans lequel <code>\applyOutput</code> est effectué.
</li></ul>

<p>De plus, ce qui est à l&rsquo;origine de l&rsquo;objet de rendu &ndash; l&rsquo;expression
musicale ou l&rsquo;objet qui l&rsquo;a générée &ndash; se retrouve en tant que propriété
d&rsquo;objet <code>cause</code>.  Il s&rsquo;agit, pour une tête de note, d&rsquo;un événement
<a name="index-NoteHead"></a>
<a href="internals-big-page.html#notehead">NoteHead</a>, et d&rsquo;un objet <a name="index-Stem"></a>
<a href="internals-big-page.html#stem">Stem</a> pour une hampe.
</p>
<p>Voici une fonction utilisable avec la commande
<code>\applyOutput</code> : elle « blanchit » la tête des notes se trouvant
sur la ligne médiane ou bien directement à son contact.
</p>
<blockquote><pre class="verbatim">#(define (blanker grob grob-origin context)
   (if (&lt; (abs (ly:grob-property grob 'staff-position)) 2)
       (set! (ly:grob-property grob 'transparent) #t)))

\relative {
  a'4 e8 &lt;&lt;\applyOutput Voice.NoteHead #blanker a c d&gt;&gt; b2
}
</pre><p>
 <a href="e6/lily-eca7384f.ly">
  <img align="middle"
       border="0"
       src="e6/lily-eca7384f.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>La <var>procédure</var> sera interprétée au niveau <code>Score</code> (partition)
ou <code>Staff</code> (portée) dès lors que vous utiliserez l&rsquo;une des syntaxes
</p>
<blockquote><pre class="example">\applyOutput Score&hellip;
\applyOutput Staff&hellip;
</pre></blockquote>


<hr size="6">
<a name="Fonctions-de-rappel"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#running-a-function-on-all-layout-objects" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Application d'une fonction à tous les objets de mise en forme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#interfaces-for-programmers" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#difficult-tweaks" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Retouches complexes &gt; </a>]</td></tr></table>
<a name="callback-functions"></a>
<h2 class="section">2.7 Fonctions de rappel</h2>

<p>Certaines propriétés, entre autres <code>thickness</code> ou <code>direction</code>,
peuvent voir leur valeur figée à l&rsquo;aide d&rsquo;un <code>\override</code> comme
ici :
</p>
<blockquote><pre class="example">\override Stem.thickness = #2.0
</pre></blockquote>

<p>Une procédure Scheme peut aussi se charger de modifier des propriétés :
</p>
<blockquote><pre class="verbatim">\override Stem.thickness = #(lambda (grob)
    (if (= UP (ly:grob-property grob 'direction))
        2.0
        7.0))
\relative { c'' b a g b a g b }
</pre><p>
 <a href="b8/lily-edb9a4ad.ly">
  <img align="middle"
       border="0"
       src="b8/lily-edb9a4ad.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Dans ce cas, la procédure est exécutée dès que la valeur de la propriété
est nécessaire au processus de mise en forme.
</p>
<p>La majeure partie du procédé typographique consiste en la réalisation de
tels rappels (<em>callbacks</em> en anglais).  Entre autres propriétés
utilisant particulièrement des rappels, nous mentionnerons
</p>
<dl compact="compact">
<dt> <code>stencil</code></dt>
<dd><p>  Routine d&rsquo;impression, construisant le dessin du symbole
</p></dd>
<dt> <code>X-offset</code></dt>
<dd><p>  Routine effectuant le positionnement horizontal
</p></dd>
<dt> <code>X-extent</code></dt>
<dd><p>  Routine calculant la largeur d&rsquo;un objet
</p></dd>
</dl>

<p>La procédure prend un unique argument, en l&rsquo;occurrence l&rsquo;objet graphique
(le <em>grob</em>).
</p>
<p>Cette procédure, grâce à un appel à la fonction de rappel dévolue à
cette propriété &ndash; mentionnée dans la référence des propriétés internes
et dans le fichier &lsquo;<tt>define-grobs.scm</tt>&rsquo; &ndash;, pourra accéder à la
valeur usuelle de la propriété :
</p>
<blockquote><pre class="example">\relative {
  \override Flag.X-offset = #(lambda (flag)
    (let ((default (ly:flag::calc-x-offset flag)))
      (* default 4.0)))
  c''4. d8 a4. g8
}
</pre></blockquote>

<p>Au sein d&rsquo;un <em>callback</em>, le meilleur moyen d&rsquo;évaluer un
<em>markup</em> consiste à utiliser la fonction
<code>grob-interpret-markup</code>, comme ici :
</p>
<blockquote><pre class="example">my-callback = #(lambda (grob)
                 (grob-interpret-markup grob (markup &quot;foo&quot;)))
</pre></blockquote>




<hr size="6">
<a name="Retouches-complexes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-scheme-interfaces" title="Chapitre suivant">&nbsp;Interfaces LilyPond Scheme &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#callback-functions" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Fonctions de rappel&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#interfaces-for-programmers" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-scheme-interfaces" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Interfaces LilyPond Scheme &gt; </a>]</td></tr></table>
<a name="difficult-tweaks"></a>
<h2 class="section">2.8 Retouches complexes</h2>

<p>Certains réglages sont plus délicats que d&rsquo;autres.
</p>
<ul>
<li>
L&rsquo;un d&rsquo;entre eux est l&rsquo;apparence des objets dits « extenseurs »
(<em>spanner</em>), qui s&rsquo;étendent horizontalement, tels que les liaisons.
Si, en principe, un seul de ces objets est créé à la fois et peut donc
être modifié de façon habituelle, lorsque ces objets doivent enjamber un
changement de ligne, ils sont dupliqués au début du ou des systèmes
suivants.  Comme ces objets sont des clones de l&rsquo;objet d&rsquo;origine, ils en
héritent toutes les propriétés, y compris les éventuelles commandes
<code>\override</code>.

<p>En d&rsquo;autres termes, une commande <code>\override</code> affecte toujours les
deux extrémités d&rsquo;un objet <em>spanner</em>.  Pour ne modifier que la
partie précédant ou suivant le changement de ligne, il faut intervenir
directement dans le processus de mise en page.
La fonction de rappel <code>after-line-breaking</code> contient toute
l&rsquo;opération Scheme effectuée lorsque les sauts de lignes ont été
déterminés, et que des objets graphiques ont été divisés sur des
systèmes différents.
</p>
<p>Dans l&rsquo;exemple suivant, on définit une nouvelle opération nommée
<code>my-callback</code>.  Cette opération
</p>
<ul>
<li>
détermine si l&rsquo;objet a été divisé à l&rsquo;occasion d&rsquo;un changement de ligne
</li><li>
dans l&rsquo;affirmative, recherche les différents tronçons de l&rsquo;objet
</li><li>
vérifie si l&rsquo;objet considéré est bien la deuxième moitié d&rsquo;un objet
divisé
</li><li>
dans l&rsquo;affirmative, applique un espacement supplémentaire
(<code>extra-offset</code>).
</li></ul>

<p>On ajoute cette procédure à l&rsquo;objet <a name="index-Tie"></a>
<a href="internals-big-page.html#tie">Tie</a> (liaison de tenue),
de façon à ce que le deuxième tronçon d&rsquo;une liaison divisée soit
rehaussé.
</p>
<blockquote><pre class="verbatim">#(define (my-callback grob)
   (let* (
          ;; l'objet a-t-il été divisé ?
          (orig (ly:grob-original grob))

          ;; si oui, rechercher les tronçons frères (siblings)
          (siblings (if (ly:grob? orig)
                        (ly:spanner-broken-into orig)
                        '())))

     (if (and (&gt;= (length siblings) 2)
              (eq? (car (last-pair siblings)) grob))
         (ly:grob-set-property! grob 'extra-offset '(-2 . 5)))))

\relative {
  \override Tie.after-line-breaking =
  #my-callback
  c''1 ~ \break
  c2 ~ 2
}
</pre><p>
 <a href="8a/lily-96120527.ly">
  <img align="middle"
       border="0"
       src="8a/lily-96120527.png"
       alt="[image of music]">
 </a>
</p>
</blockquote>



<p>Lorsque cette astuce va être appliquée, notre nouvelle fonction de
rappel <code>after-line-breaking</code> devra également appeler celle
d&rsquo;origine (<code>after-line-breaking</code>), si elle existe.  Ainsi, pour
l&rsquo;utiliser dans le cas d&rsquo;un crescendo (objet <code>Hairpin</code>), il faudra
également appeler <code>ly:spanner::kill-zero-spanned-time</code>.
</p>

</li><li>
Pour des raisons d&rsquo;ordre technique, certains objets ne peuvent être
modifiés par <code>\override</code>.  Parmi ceux-là, les objets
<code>NonMusicalPaperColumn</code> et <code>PaperColumn</code>.  La commande
<code>\overrideProperty</code> sert à les modifier, de façon similaire à
<code>\once \override</code>, mais avec une syntaxe différente :

<blockquote><pre class="example">\overrideProperty
Score.NonMusicalPaperColumn      % Nom de l'objet
  . line-break-system-details    % Nom de la propriété
  . next-padding                 % Nom de la sous-propriété (optionnel)
  . #20                          % Valeur
</pre></blockquote>

<p>Notez toutefois que la commande <code>\override</code> peut tout de même être
appliquée à <code>NonMusicalPaperColumn</code> et <code>PaperColumn</code> dans un
bloc <code>\context</code>.
</p>
</li></ul>


<hr size="6">
<a name="Interfaces-LilyPond-Scheme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#interfaces-for-programmers" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces pour programmeurs&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Chapitre suivant">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#difficult-tweaks" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Retouches complexes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gnu-free-documentation-license" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;GNU Free Documentation License &gt; </a>]</td></tr></table>
<a name="lilypond-scheme-interfaces"></a>
<h1 class="chapter">3. Interfaces LilyPond Scheme</h1>

<p>Ce chapitre aborde les différents outils fournis par LilyPond à
l&rsquo;intention des programmeurs en Scheme désireux d&rsquo;obtenir des
informations à partir et autour des fluxs de musique.
</p>
<p>TODO &ndash; figure out what goes in here and how to organize it
</p>
<hr size="6">
<a name="GNU-Free-Documentation-License"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#lilypond-scheme-interfaces" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; Interfaces LilyPond Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lilypond-index" title="Chapitre suivant">&nbsp;Index de LilyPond &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-scheme-interfaces" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; Interfaces LilyPond Scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-index" title="Section suivante dans l&rsquo;ordre de lecture" accesskey="n" rel="next">&nbsp;Index de LilyPond &gt; </a>]</td></tr></table>
<a name="gnu-free-documentation-license"></a>
<h1 class="appendix">A. GNU Free Documentation License</h1>
<p align="center"> Version 1.3, 3 November 2008
</p>

<table><tr><td>&nbsp;</td><td><pre class="display">Copyright &copy; 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.
<a href="http://fsf.org">http://fsf.org/</a>

Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
</pre></td></tr></table>

<ol>
<li>
PREAMBLE

<p>The purpose of this License is to make a manual, textbook, or other
functional and useful document <em>free</em> in the sense of freedom: to
assure everyone the effective freedom to copy and redistribute it,
with or without modifying it, either commercially or noncommercially.
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible
for modifications made by others.
</p>
<p>This License is a kind of &ldquo;copyleft&rdquo;, which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.
</p>
<p>We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.
</p>
</li><li>
APPLICABILITY AND DEFINITIONS

<p>This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License.  Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein.  The &ldquo;Document&rdquo;, below,
refers to any such manual or work.  Any member of the public is a
licensee, and is addressed as &ldquo;you&rdquo;.  You accept the license if you
copy, modify or distribute the work in a way requiring permission
under copyright law.
</p>
<p>A &ldquo;Modified Version&rdquo; of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.
</p>
<p>A &ldquo;Secondary Section&rdquo; is a named appendix or a front-matter section
of the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document&rsquo;s overall
subject (or to related matters) and contains nothing that could fall
directly within that overall subject.  (Thus, if the Document is in
part a textbook of mathematics, a Secondary Section may not explain
any mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.
</p>
<p>The &ldquo;Invariant Sections&rdquo; are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.  If a
section does not fit the above definition of Secondary then it is not
allowed to be designated as Invariant.  The Document may contain zero
Invariant Sections.  If the Document does not identify any Invariant
Sections then there are none.
</p>
<p>The &ldquo;Cover Texts&rdquo; are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.  A Front-Cover Text may
be at most 5 words, and a Back-Cover Text may be at most 25 words.
</p>
<p>A &ldquo;Transparent&rdquo; copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, that is suitable for revising the document
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup, or absence of markup, has been arranged to thwart
or discourage subsequent modification by readers is not Transparent.
An image format is not Transparent if used for any substantial amount
of text.  A copy that is not &ldquo;Transparent&rdquo; is called &ldquo;Opaque&rdquo;.
</p>
<p>Examples of suitable formats for Transparent copies include plain
<small>ASCII</small> without markup, Texinfo input format, LaTeX input
format, <acronym>SGML</acronym> or <acronym>XML</acronym> using a publicly available
<acronym>DTD</acronym>, and standard-conforming simple <acronym>HTML</acronym>,
PostScript or <acronym>PDF</acronym> designed for human modification.  Examples
of transparent image formats include <acronym>PNG</acronym>, <acronym>XCF</acronym> and
<acronym>JPG</acronym>.  Opaque formats include proprietary formats that can be
read and edited only by proprietary word processors, <acronym>SGML</acronym> or
<acronym>XML</acronym> for which the <acronym>DTD</acronym> and/or processing tools are
not generally available, and the machine-generated <acronym>HTML</acronym>,
PostScript or <acronym>PDF</acronym> produced by some word processors for
output purposes only.
</p>
<p>The &ldquo;Title Page&rdquo; means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, &ldquo;Title Page&rdquo; means
the text near the most prominent appearance of the work&rsquo;s title,
preceding the beginning of the body of the text.
</p>
<p>The &ldquo;publisher&rdquo; means any person or entity that distributes copies
of the Document to the public.
</p>
<p>A section &ldquo;Entitled XYZ&rdquo; means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language.  (Here XYZ stands for a
specific section name mentioned below, such as &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, &ldquo;Endorsements&rdquo;, or &ldquo;History&rdquo;.)  To &ldquo;Preserve the Title&rdquo;
of such a section when you modify the Document means that it remains a
section &ldquo;Entitled XYZ&rdquo; according to this definition.
</p>
<p>The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document.  These Warranty
Disclaimers are considered to be included by reference in this
License, but only as regards disclaiming warranties: any other
implication that these Warranty Disclaimers may have is void and has
no effect on the meaning of this License.
</p>
</li><li>
VERBATIM COPYING

<p>You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.
</p>
<p>You may also lend copies, under the same conditions stated above, and
you may publicly display copies.
</p>
</li><li>
COPYING IN QUANTITY

<p>If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document&rsquo;s license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.
</p>
<p>If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.
</p>
<p>If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a computer-network location from which the general network-using
public has access to download using public-standard network protocols
a complete Transparent copy of the Document, free of added material.
If you use the latter option, you must take reasonably prudent steps,
when you begin distribution of Opaque copies in quantity, to ensure
that this Transparent copy will remain thus accessible at the stated
location until at least one year after the last time you distribute an
Opaque copy (directly or through your agents or retailers) of that
edition to the public.
</p>
<p>It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.
</p>
</li><li>
MODIFICATIONS

<p>You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:
</p>
<ol>
<li>
Use in the Title Page (and on the covers, if any) a title distinct
from that of the Document, and from those of previous versions
(which should, if there were any, be listed in the History section
of the Document).  You may use the same title as a previous version
if the original publisher of that version gives permission.

</li><li>
List on the Title Page, as authors, one or more persons or entities
responsible for authorship of the modifications in the Modified
Version, together with at least five of the principal authors of the
Document (all of its principal authors, if it has fewer than five),
unless they release you from this requirement.

</li><li>
State on the Title page the name of the publisher of the
Modified Version, as the publisher.

</li><li>
Preserve all the copyright notices of the Document.

</li><li>
Add an appropriate copyright notice for your modifications
adjacent to the other copyright notices.

</li><li>
Include, immediately after the copyright notices, a license notice
giving the public permission to use the Modified Version under the
terms of this License, in the form shown in the Addendum below.

</li><li>
Preserve in that license notice the full lists of Invariant Sections
and required Cover Texts given in the Document&rsquo;s license notice.

</li><li>
Include an unaltered copy of this License.

</li><li>
Preserve the section Entitled &ldquo;History&rdquo;, Preserve its Title, and add
to it an item stating at least the title, year, new authors, and
publisher of the Modified Version as given on the Title Page.  If
there is no section Entitled &ldquo;History&rdquo; in the Document, create one
stating the title, year, authors, and publisher of the Document as
given on its Title Page, then add an item describing the Modified
Version as stated in the previous sentence.

</li><li>
Preserve the network location, if any, given in the Document for
public access to a Transparent copy of the Document, and likewise
the network locations given in the Document for previous versions
it was based on.  These may be placed in the &ldquo;History&rdquo; section.
You may omit a network location for a work that was published at
least four years before the Document itself, or if the original
publisher of the version it refers to gives permission.

</li><li>
For any section Entitled &ldquo;Acknowledgements&rdquo; or &ldquo;Dedications&rdquo;, Preserve
the Title of the section, and preserve in the section all the
substance and tone of each of the contributor acknowledgements and/or
dedications given therein.

</li><li>
Preserve all the Invariant Sections of the Document,
unaltered in their text and in their titles.  Section numbers
or the equivalent are not considered part of the section titles.

</li><li>
Delete any section Entitled &ldquo;Endorsements&rdquo;.  Such a section
may not be included in the Modified Version.

</li><li>
Do not retitle any existing section to be Entitled &ldquo;Endorsements&rdquo; or
to conflict in title with any Invariant Section.

</li><li>
Preserve any Warranty Disclaimers.
</li></ol>

<p>If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version&rsquo;s license notice.
These titles must be distinct from any other section titles.
</p>
<p>You may add a section Entitled &ldquo;Endorsements&rdquo;, provided it contains
nothing but endorsements of your Modified Version by various
parties&mdash;for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.
</p>
<p>You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.
</p>
<p>The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.
</p>
</li><li>
COMBINING DOCUMENTS

<p>You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice, and that you preserve all their Warranty Disclaimers.
</p>
<p>The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.
</p>
<p>In the combination, you must combine any sections Entitled &ldquo;History&rdquo;
in the various original documents, forming one section Entitled
&ldquo;History&rdquo;; likewise combine any sections Entitled &ldquo;Acknowledgements&rdquo;,
and any sections Entitled &ldquo;Dedications&rdquo;.  You must delete all
sections Entitled &ldquo;Endorsements.&rdquo;
</p>
</li><li>
COLLECTIONS OF DOCUMENTS

<p>You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.
</p>
<p>You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.
</p>
</li><li>
AGGREGATION WITH INDEPENDENT WORKS

<p>A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, is called an &ldquo;aggregate&rdquo; if the copyright
resulting from the compilation is not used to limit the legal rights
of the compilation&rsquo;s users beyond what the individual works permit.
When the Document is included in an aggregate, this License does not
apply to the other works in the aggregate which are not themselves
derivative works of the Document.
</p>
<p>If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one half of
the entire aggregate, the Document&rsquo;s Cover Texts may be placed on
covers that bracket the Document within the aggregate, or the
electronic equivalent of covers if the Document is in electronic form.
Otherwise they must appear on printed covers that bracket the whole
aggregate.
</p>
</li><li>
TRANSLATION

<p>Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License, and all the license notices in the
Document, and any Warranty Disclaimers, provided that you also include
the original English version of this License and the original versions
of those notices and disclaimers.  In case of a disagreement between
the translation and the original version of this License or a notice
or disclaimer, the original version will prevail.
</p>
<p>If a section in the Document is Entitled &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, or &ldquo;History&rdquo;, the requirement (section 4) to Preserve
its Title (section 1) will typically require changing the actual
title.
</p>
</li><li>
TERMINATION

<p>You may not copy, modify, sublicense, or distribute the Document
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense, or distribute it is void, and
will automatically terminate your rights under this License.
</p>
<p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.
</p>
<p>Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.
</p>
<p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, receipt of a copy of some or all of the same material does
not give you any rights to use it.
</p>
</li><li>
FUTURE REVISIONS OF THIS LICENSE

<p>The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
<a href="http://www.gnu.org/copyleft">http://www.gnu.org/copyleft/</a>.
</p>
<p>Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this
License &ldquo;or any later version&rdquo; applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.  If the Document
specifies that a proxy can decide which future versions of this
License can be used, that proxy&rsquo;s public statement of acceptance of a
version permanently authorizes you to choose that version for the
Document.
</p>
</li><li>
RELICENSING

<p>&ldquo;Massive Multiauthor Collaboration Site&rdquo; (or &ldquo;MMC Site&rdquo;) means any
World Wide Web server that publishes copyrightable works and also
provides prominent facilities for anybody to edit those works.  A
public wiki that anybody can edit is an example of such a server.  A
&ldquo;Massive Multiauthor Collaboration&rdquo; (or &ldquo;MMC&rdquo;) contained in the
site means any set of copyrightable works thus published on the MMC
site.
</p>
<p>&ldquo;CC-BY-SA&rdquo; means the Creative Commons Attribution-Share Alike 3.0
license published by Creative Commons Corporation, a not-for-profit
corporation with a principal place of business in San Francisco,
California, as well as future copyleft versions of that license
published by that same organization.
</p>
<p>&ldquo;Incorporate&rdquo; means to publish or republish a Document, in whole or
in part, as part of another Document.
</p>
<p>An MMC is &ldquo;eligible for relicensing&rdquo; if it is licensed under this
License, and if all works that were first published under this License
somewhere other than this MMC, and subsequently incorporated in whole
or in part into the MMC, (1) had no cover texts or invariant sections,
and (2) were thus incorporated prior to November 1, 2008.
</p>
<p>The operator of an MMC Site may republish an MMC contained in the site
under CC-BY-SA on the same site at any time before August 1, 2009,
provided the MMC is eligible for relicensing.
</p>
</li></ol>


<a name="ADDENDUM_003a-How-to-use-this-License-for-your-documents"></a>
<h2 class="heading">ADDENDUM: How to use this License for your documents</h2>

<p>To use this License in a document you have written, include a copy of
the License in the document and put the following copyright and
license notices just after the title page:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">  Copyright (C)  <var>year</var>  <var>your name</var>.
  Permission is granted to copy, distribute and/or modify this document
  under the terms of the GNU Free Documentation License, Version 1.3
  or any later version published by the Free Software Foundation;
  with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
  Texts.  A copy of the license is included in the section entitled ``GNU
  Free Documentation License''.
</pre></td></tr></table>

<p>If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
replace the &ldquo;with&hellip;Texts.&rdquo; line with this:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">    with the Invariant Sections being <var>list their titles</var>, with
    the Front-Cover Texts being <var>list</var>, and with the Back-Cover Texts
    being <var>list</var>.
</pre></td></tr></table>

<p>If you have Invariant Sections without Cover Texts, or some other
combination of the three, merge those two alternatives to suit the
situation.
</p>
<p>If your document contains nontrivial examples of program code, we
recommend releasing these examples in parallel under your choice of
free software license, such as the GNU General Public License,
to permit their use in free software.
</p>


<hr size="6">
<a name="Index-de-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#gnu-free-documentation-license" title="D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent"> &lt;&lt; GNU Free Documentation License&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[&nbsp; &gt;&gt; ]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#gnu-free-documentation-license" title="Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture" accesskey="p" rel="previous"> &lt; GNU Free Documentation License&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Section sup&eacute;rieure" accesskey="u" rel="up">&nbsp;Plus haut:&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[&nbsp; &gt; ]</td></tr></table>
<a name="lilypond-index"></a>
<h1 class="appendix">B. Index de LilyPond</h1>

<table><tr><th valign="top">Aller &agrave;: &nbsp; </th><td><a href="#lilypond-index_cp_symbol-1" class="summary-letter"><b>#</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_symbol-2" class="summary-letter"><b>$</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_symbol-3" class="summary-letter"><b>\</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_symbol-4" class="summary-letter"><b>É</b></a>
 &nbsp; 
<br>
<a href="#lilypond-index_cp_letter-A" class="summary-letter"><b>A</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-C" class="summary-letter"><b>C</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-D" class="summary-letter"><b>D</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-E" class="summary-letter"><b>E</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-F" class="summary-letter"><b>F</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-G" class="summary-letter"><b>G</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-I" class="summary-letter"><b>I</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-L" class="summary-letter"><b>L</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-M" class="summary-letter"><b>M</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-N" class="summary-letter"><b>N</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-O" class="summary-letter"><b>O</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-P" class="summary-letter"><b>P</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-R" class="summary-letter"><b>R</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-S" class="summary-letter"><b>S</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-T" class="summary-letter"><b>T</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-V" class="summary-letter"><b>V</b></a>
 &nbsp; 
</td></tr></table>
<table border="0" class="index-cp">
<tr><td></td><th align="left">Entr&eacute;e d&rsquo;index</th><th align="left"> Section</th></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_symbol-1">#</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023"><code>#</code></a></td><td valign="top"><a href="#lilypond-scheme-syntax">1.2.1 Syntaxe Scheme dans LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023-2"><code>#</code></a></td><td valign="top"><a href="#importing-scheme-in-lilypond">1.2.4 Import de code Scheme dans LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023-4"><code>#</code></a></td><td valign="top"><a href="#lilypond-code-blocks">2.1 Blocs de code LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0023f"><code>##f</code></a></td><td valign="top"><a href="#scheme-simple-data-types">1.1.3 Types de données Scheme simples</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0023t"><code>##t</code></a></td><td valign="top"><a href="#scheme-simple-data-types">1.1.3 Types de données Scheme simples</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0040"><code>#@</code></a></td><td valign="top"><a href="#lilypond-scheme-syntax">1.2.1 Syntaxe Scheme dans LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_0040-2"><code>#@</code></a></td><td valign="top"><a href="#importing-scheme-in-lilypond">1.2.4 Import de code Scheme dans LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0023_007b-_002e_002e_002e-_0023_007d"><code>#{ ... #}</code></a></td><td valign="top"><a href="#lilypond-code-blocks">2.1 Blocs de code LilyPond</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_symbol-2">$</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0024"><code>$</code></a></td><td valign="top"><a href="#lilypond-scheme-syntax">1.2.1 Syntaxe Scheme dans LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0024-2"><code>$</code></a></td><td valign="top"><a href="#importing-scheme-in-lilypond">1.2.4 Import de code Scheme dans LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0024-4"><code>$</code></a></td><td valign="top"><a href="#lilypond-code-blocks">2.1 Blocs de code LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0024_0040"><code>$@</code></a></td><td valign="top"><a href="#lilypond-scheme-syntax">1.2.1 Syntaxe Scheme dans LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0024_0040-2"><code>$@</code></a></td><td valign="top"><a href="#importing-scheme-in-lilypond">1.2.4 Import de code Scheme dans LilyPond</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_symbol-3">\</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005capplyContext"><code>\applyContext</code></a></td><td valign="top"><a href="#context-evaluation">2.6.1 Évaluation d&rsquo;un contexte</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005capplyOutput"><code>\applyOutput</code></a></td><td valign="top"><a href="#running-a-function-on-all-layout-objects">2.6.2 Application d&rsquo;une fonction à tous les objets de mise en forme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005cdisplayLilyMusic"><code>\displayLilyMusic</code></a></td><td valign="top"><a href="#music-properties">1.3.2 Propriétés musicales</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005cdisplayMusic"><code>\displayMusic</code></a></td><td valign="top"><a href="#displaying-music-expressions">1.3.1 Affichage d&rsquo;expressions musicales</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005cdisplayScheme"><code>\displayScheme</code></a></td><td valign="top"><a href="#markup-construction-in-scheme">2.5.1 Construction d&rsquo;un <em>markup</em> en Scheme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005cmarkup"><code>\markup</code></a></td><td valign="top"><a href="#markup-command-definition-syntax">Syntaxe d&rsquo;une commande <em>markup</em></a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005ctemporary"><code>\temporary</code></a></td><td valign="top"><a href="#intermediate-substitution-functions">2.3.4 Fonctions de substitution intermédiaires</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_005cvoid"><code>\void</code></a></td><td valign="top"><a href="#void-scheme-functions">2.2.3 Fonctions Scheme fantômes</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-acceder-a-Scheme">accéder à Scheme</a></td><td valign="top"><a href="#tutoriel-scheme">1. Tutoriel Scheme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-appel-de-code-durant-l_0027interpretation">appel de code durant l&rsquo;interprétation</a></td><td valign="top"><a href="#context-evaluation">2.6.1 Évaluation d&rsquo;un contexte</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-appel-de-code-sur-des-objets-de-mise-en-forme">appel de code sur des objets de mise en forme</a></td><td valign="top"><a href="#running-a-function-on-all-layout-objects">2.6.2 Application d&rsquo;une fonction à tous les objets de mise en forme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ApplyOutputEvent"><code>ApplyOutputEvent</code></a></td><td valign="top"><a href="#running-a-function-on-all-layout-objects">2.6.2 Application d&rsquo;une fonction à tous les objets de mise en forme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Autres-sources-de-documentation"><code>Autres sources de documentation</code></a></td><td valign="top"><a href="#scheme-sandbox">1.1.1 Le bac à sable de Scheme</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-code_002c-blocs-LilyPond">code, blocs LilyPond</a></td><td valign="top"><a href="#lilypond-code-blocks">2.1 Blocs de code LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Commandes-pour-markup"><code>Commandes pour markup</code></a></td><td valign="top"><a href="#a-complete-example">Exemple commenté</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002devent_002dfunction"><code>define-event-function</code></a></td><td valign="top"><a href="#event-functions">2.4 Fonctions événementielles</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dmarkup_002dlist_002dcommand"><code>define-markup-list-command</code></a></td><td valign="top"><a href="#new-markup-list-command-definition">2.5.4 Définition d&rsquo;une nouvelle commande de liste de <em>markups</em></a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dmusic_002dfunction"><code>define-music-function</code></a></td><td valign="top"><a href="#music-function-definitions">2.3.1 Définition de fonctions musicales</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dscheme_002dfunction"><code>define-scheme-function</code></a></td><td valign="top"><a href="#scheme-function-definitions">2.2.1 Définition de fonctions Scheme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dvoid_002dfunction"><code>define-void-function</code></a></td><td valign="top"><a href="#void-scheme-functions">2.2.3 Fonctions Scheme fantômes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-displayMusic">displayMusic</a></td><td valign="top"><a href="#displaying-music-expressions">1.3.1 Affichage d&rsquo;expressions musicales</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-definition-d_0027une-commande-markup">définition d&rsquo;une commande markup</a></td><td valign="top"><a href="#markup-construction-in-scheme">2.5.1 Construction d&rsquo;un <em>markup</em> en Scheme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-derogation-temporaire-_0028override_0029">dérogation temporaire (override)</a></td><td valign="top"><a href="#intermediate-substitution-functions">2.3.4 Fonctions de substitution intermédiaires</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Exemples-de-fonction-de-substitution"><code>Exemples de fonction de substitution</code></a></td><td valign="top"><a href="#simple-substitution-functions">2.3.3 Fonctions de substitution simple</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-expression-musicale_002c-affichage">expression musicale, affichage</a></td><td valign="top"><a href="#displaying-music-expressions">1.3.1 Affichage d&rsquo;expressions musicales</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-fantome_002c-fonction">fantôme, fonction</a></td><td valign="top"><a href="#void-scheme-functions">2.2.3 Fonctions Scheme fantômes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fonction-musicale_002c-definition">fonction musicale, définition</a></td><td valign="top"><a href="#music-function-definitions">2.3.1 Définition de fonctions musicales</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-G">G</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-GraceMusic"><code>GraceMusic</code></a></td><td valign="top"><a href="#internal-music-representation">1.2.7 Représentation interne de la musique</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-GUILE">GUILE</a></td><td valign="top"><a href="#tutoriel-scheme">1. Tutoriel Scheme</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-interpret_002dmarkup"><code>interpret-markup</code></a></td><td valign="top"><a href="#markup-command-definition-syntax">Syntaxe d&rsquo;une commande <em>markup</em></a></td></tr>
<tr><td></td><td valign="top"><a href="#index-interpret_002dmarkup_002dlist"><code>interpret-markup-list</code></a></td><td valign="top"><a href="#new-markup-list-command-definition">2.5.4 Définition d&rsquo;une nouvelle commande de liste de <em>markups</em></a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-L">L</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-LilyPond-grammar"><code>LilyPond grammar</code></a></td><td valign="top"><a href="#lilypond-scheme-syntax">1.2.1 Syntaxe Scheme dans LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-LilyPond_002c-bloc-de-code">LilyPond, bloc de code</a></td><td valign="top"><a href="#lilypond-code-blocks">2.1 Blocs de code LilyPond</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-LISP">LISP</a></td><td valign="top"><a href="#tutoriel-scheme">1. Tutoriel Scheme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-liste-de-markup_002c-definition-de-commande">liste de markup, définition de commande</a></td><td valign="top"><a href="#new-markup-list-command-definition">2.5.4 Définition d&rsquo;une nouvelle commande de liste de <em>markups</em></a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ly_003aassoc_002dget"><code>ly:assoc-get</code></a></td><td valign="top"><a href="#context-evaluation">2.6.1 Évaluation d&rsquo;un contexte</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ly_003acontext_002dgrob_002ddefinition"><code>ly:context-grob-definition</code></a></td><td valign="top"><a href="#context-evaluation">2.6.1 Évaluation d&rsquo;un contexte</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ly_003acontext_002dproperty"><code>ly:context-property</code></a></td><td valign="top"><a href="#context-evaluation">2.6.1 Évaluation d&rsquo;un contexte</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ly_003acontext_002dpushpop_002dproperty"><code>ly:context-pushpop-property</code></a></td><td valign="top"><a href="#context-evaluation">2.6.1 Évaluation d&rsquo;un contexte</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ly_003acontext_002dset_002dproperty_0021"><code>ly:context-set-property!</code></a></td><td valign="top"><a href="#context-evaluation">2.6.1 Évaluation d&rsquo;un contexte</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-macro-de-markup">macro de markup</a></td><td valign="top"><a href="#markup-command-definition-syntax">Syntaxe d&rsquo;une commande <em>markup</em></a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002dapply_002dcontext"><code>make-apply-context</code></a></td><td valign="top"><a href="#context-evaluation">2.6.1 Évaluation d&rsquo;un contexte</a></td></tr>
<tr><td></td><td valign="top"><a href="#index"><code>Manuels</code></a></td><td valign="top"><a href="#index">LilyPond &mdash; Extension des fonctionnalités</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Manuels"><code>Manuels</code></a></td><td valign="top"><a href="#index">LilyPond &mdash; Extension des fonctionnalités</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-markup-macro">markup macro</a></td><td valign="top"><a href="#markup-command-definition-syntax">Syntaxe d&rsquo;une commande <em>markup</em></a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Music-classes"><code>Music classes</code></a></td><td valign="top"><a href="#internal-music-representation">1.2.7 Représentation interne de la musique</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Music-expressions"><code>Music expressions</code></a></td><td valign="top"><a href="#internal-music-representation">1.2.7 Représentation interne de la musique</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Music-properties"><code>Music properties</code></a></td><td valign="top"><a href="#internal-music-representation">1.2.7 Représentation interne de la musique</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-musicale_002c-fonction">musicale, fonction</a></td><td valign="top"><a href="#music-functions">2.3 Fonctions musicales</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-N">N</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-NoteEvent"><code>NoteEvent</code></a></td><td valign="top"><a href="#internal-music-representation">1.2.7 Représentation interne de la musique</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-NoteEvent-1"><code>NoteEvent</code></a></td><td valign="top"><a href="#internal-music-representation">1.2.7 Représentation interne de la musique</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-NoteHead"><code>NoteHead</code></a></td><td valign="top"><a href="#running-a-function-on-all-layout-objects">2.6.2 Application d&rsquo;une fonction à tous les objets de mise en forme</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-O">O</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-objets-de-mise-en-forme_002c-appel-de-code">objets de mise en forme, appel de code</a></td><td valign="top"><a href="#running-a-function-on-all-layout-objects">2.6.2 Application d&rsquo;une fonction à tous les objets de mise en forme</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-proprietes-ou-variables">propriétés ou variables</a></td><td valign="top"><a href="#object-properties">1.2.5 Propriétés des objets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-proprietes_002c-retour-a-la-valeur-precedente">propriétés, retour à la valeur précédente</a></td><td valign="top"><a href="#intermediate-substitution-functions">2.3.4 Fonctions de substitution intermédiaires</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-R">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-RepeatedMusic"><code>RepeatedMusic</code></a></td><td valign="top"><a href="#internal-music-representation">1.2.7 Représentation interne de la musique</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-representation-interne_002c-affichage">représentation interne, affichage</a></td><td valign="top"><a href="#displaying-music-expressions">1.3.1 Affichage d&rsquo;expressions musicales</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Scheme">Scheme</a></td><td valign="top"><a href="#tutoriel-scheme">1. Tutoriel Scheme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Scheme_002c-fonctions-_0028syntaxe-LilyPond_0029">Scheme, fonctions (syntaxe LilyPond)</a></td><td valign="top"><a href="#scheme-functions">2.2 Fonctions Scheme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Scheme_002c-inclusion-de-code">Scheme, inclusion de code</a></td><td valign="top"><a href="#tutoriel-scheme">1. Tutoriel Scheme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-SequentialMusic"><code>SequentialMusic</code></a></td><td valign="top"><a href="#internal-music-representation">1.2.7 Représentation interne de la musique</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-SimultaneousMusic"><code>SimultaneousMusic</code></a></td><td valign="top"><a href="#internal-music-representation">1.2.7 Représentation interne de la musique</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Stem"><code>Stem</code></a></td><td valign="top"><a href="#running-a-function-on-all-layout-objects">2.6.2 Application d&rsquo;une fonction à tous les objets de mise en forme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-stockage-interne">stockage interne</a></td><td valign="top"><a href="#displaying-music-expressions">1.3.1 Affichage d&rsquo;expressions musicales</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-temporaire_002c-derogation-_0028override_0029">temporaire, dérogation (override)</a></td><td valign="top"><a href="#intermediate-substitution-functions">2.3.4 Fonctions de substitution intermédiaires</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Tie"><code>Tie</code></a></td><td valign="top"><a href="#difficult-tweaks">2.8 Retouches complexes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Types-de-predicats-predefinis"><code>Types de prédicats prédéfinis</code></a></td><td valign="top"><a href="#scheme-function-definitions">2.2.1 Définition de fonctions Scheme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Types-de-predicats-predefinis-1"><code>Types de prédicats prédéfinis</code></a></td><td valign="top"><a href="#Voir-aussi-2">Voir aussi</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Types-de-predicats-predefinis-2"><code>Types de prédicats prédéfinis</code></a></td><td valign="top"><a href="#music-function-definitions">2.3.1 Définition de fonctions musicales</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Types-de-predicats-predefinis-3"><code>Types de prédicats prédéfinis</code></a></td><td valign="top"><a href="#Voir-aussi">Voir aussi</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_letter-V">V</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-variables-ou-proprietes">variables ou propriétés</a></td><td valign="top"><a href="#object-properties">1.2.5 Propriétés des objets</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-void"><code>void</code></a></td><td valign="top"><a href="#displaying-music-expressions">1.3.1 Affichage d&rsquo;expressions musicales</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-void_002c-fonction"><em>void</em>, fonction</a></td><td valign="top"><a href="#void-scheme-functions">2.2.3 Fonctions Scheme fantômes</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="lilypond-index_cp_symbol-4">É</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-evaluation-Scheme">évaluation Scheme</a></td><td valign="top"><a href="#tutoriel-scheme">1. Tutoriel Scheme</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-evenementielle_002c-fonction">événementielle, fonction</a></td><td valign="top"><a href="#event-functions">2.4 Fonctions événementielles</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
</table>
<table><tr><th valign="top">Aller &agrave;: &nbsp; </th><td><a href="#lilypond-index_cp_symbol-1" class="summary-letter"><b>#</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_symbol-2" class="summary-letter"><b>$</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_symbol-3" class="summary-letter"><b>\</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_symbol-4" class="summary-letter"><b>É</b></a>
 &nbsp; 
<br>
<a href="#lilypond-index_cp_letter-A" class="summary-letter"><b>A</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-C" class="summary-letter"><b>C</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-D" class="summary-letter"><b>D</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-E" class="summary-letter"><b>E</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-F" class="summary-letter"><b>F</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-G" class="summary-letter"><b>G</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-I" class="summary-letter"><b>I</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-L" class="summary-letter"><b>L</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-M" class="summary-letter"><b>M</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-N" class="summary-letter"><b>N</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-O" class="summary-letter"><b>O</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-P" class="summary-letter"><b>P</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-R" class="summary-letter"><b>R</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-S" class="summary-letter"><b>S</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-T" class="summary-letter"><b>T</b></a>
 &nbsp; 
<a href="#lilypond-index_cp_letter-V" class="summary-letter"><b>V</b></a>
 &nbsp; 
</td></tr></table>

<hr size="6">
<a name="SEC_Contents"></a>
<table class="nav_table">
<tr><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td></tr></table>
<h1>Table des mati&egrave;res</h1>
<div class="contents">

<ul class="toc">
  <li><a name="toc-Tutoriel-Scheme-1" href="#tutoriel-scheme">1. Tutoriel Scheme</a>
  <ul class="toc">
    <li><a name="toc-Introduction-a-Scheme" href="#introduction-to-scheme">1.1 Introduction à Scheme</a>
    <ul class="toc">
      <li><a name="toc-Le-bac-a-sable-de-Scheme" href="#scheme-sandbox">1.1.1 Le bac à sable de Scheme</a></li>
      <li><a name="toc-Scheme-et-les-variables-1" href="#scheme-variables">1.1.2 Scheme et les variables</a></li>
      <li><a name="toc-Types-de-donnees-Scheme-simples" href="#scheme-simple-data-types">1.1.3 Types de données Scheme simples</a></li>
      <li><a name="toc-Types-de-donnees-Scheme-composites" href="#scheme-compound-data-types">1.1.4 Types de données Scheme composites</a>
      <ul class="toc">
        <li><a name="toc-Paires-1" href="#pairs">Paires</a></li>
        <li><a name="toc-Listes-1" href="#lists">Listes</a></li>
        <li><a name="toc-Listes-associatives-_0028alists_0029-1" href="#association-lists-_0028alists_0029">Listes associatives (alists)</a></li>
        <li><a name="toc-Tables-de-hachage-1" href="#hash-tables">Tables de hachage</a></li>
      </ul></li>
      <li><a name="toc-Scheme-et-les-calculs-1" href="#calculations-in-scheme">1.1.5 Scheme et les calculs</a></li>
      <li><a name="toc-Scheme-et-les-procedures" href="#scheme-procedures">1.1.6 Scheme et les procédures</a>
      <ul class="toc">
        <li><a name="toc-Definition-de-procedures" href="#defining-procedures">Définition de procédures</a></li>
        <li><a name="toc-Predicats" href="#predicates">Prédicats</a></li>
        <li><a name="toc-Valeurs-de-retour-1" href="#return-values">Valeurs de retour</a></li>
      </ul></li>
      <li><a name="toc-Scheme-et-les-conditions-1" href="#scheme-conditionals">1.1.7 Scheme et les conditions</a>
      <ul class="toc">
        <li><a name="toc-if-1" href="#if">if</a></li>
        <li><a name="toc-cond-1" href="#cond">cond</a></li>
      </ul>
</li>
    </ul></li>
    <li><a name="toc-Scheme-et-LilyPond-1" href="#scheme-in-lilypond">1.2 Scheme et LilyPond</a>
    <ul class="toc">
      <li><a name="toc-Syntaxe-Scheme-dans-LilyPond-1" href="#lilypond-scheme-syntax">1.2.1 Syntaxe Scheme dans LilyPond</a></li>
      <li><a name="toc-Variables-LilyPond-1" href="#lilypond-variables">1.2.2 Variables LilyPond</a></li>
      <li><a name="toc-Saisie-de-variables-et-Scheme-1" href="#input-variables-and-scheme">1.2.3 Saisie de variables et Scheme</a></li>
      <li><a name="toc-Import-de-code-Scheme-dans-LilyPond-1" href="#importing-scheme-in-lilypond">1.2.4 Import de code Scheme dans LilyPond</a></li>
      <li><a name="toc-Proprietes-des-objets" href="#object-properties">1.2.5 Propriétés des objets</a></li>
      <li><a name="toc-Variables-LilyPond-composites-1" href="#lilypond-compound-variables">1.2.6 Variables LilyPond composites</a>
      <ul class="toc">
        <li><a name="toc-Decalages-_0028offsets_0029" href="#offsets">Décalages (<em>offsets</em>)</a></li>
        <li><a name="toc-Fractions-1" href="#fractions">Fractions</a></li>
        <li><a name="toc-Etendues-_0028extents_0029" href="#extents">Étendues (<em>extents</em>)</a></li>
        <li><a name="toc-Propriete-en-alists" href="#property-alists">Propriété en <em>alists</em></a></li>
        <li><a name="toc-Chaines-d_0027alist" href="#alist-chains">Chaînes d&rsquo;<em>alist</em></a></li>
      </ul></li>
      <li><a name="toc-Representation-interne-de-la-musique" href="#internal-music-representation">1.2.7 Représentation interne de la musique</a></li>
    </ul></li>
    <li><a name="toc-Construction-de-fonctions-complexes-1" href="#building-complicated-functions">1.3 Construction de fonctions complexes</a>
    <ul class="toc">
      <li><a name="toc-Affichage-d_0027expressions-musicales-1" href="#displaying-music-expressions">1.3.1 Affichage d&rsquo;expressions musicales</a></li>
      <li><a name="toc-Proprietes-musicales" href="#music-properties">1.3.2 Propriétés musicales</a></li>
      <li><a name="toc-Doublement-d_0027une-note-avec-liaison-_0028exemple_0029-1" href="#doubling-a-note-with-slurs-_0028example_0029">1.3.3 Doublement d&rsquo;une note avec liaison (exemple)</a></li>
      <li><a name="toc-Ajout-d_0027articulation-a-des-notes-_0028exemple_0029" href="#adding-articulation-to-notes-_0028example_0029">1.3.4 Ajout d&rsquo;articulation à des notes (exemple)</a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="toc-Interfaces-pour-programmeurs-1" href="#interfaces-for-programmers">2. Interfaces pour programmeurs</a>
  <ul class="toc">
    <li><a name="toc-Blocs-de-code-LilyPond-1" href="#lilypond-code-blocks">2.1 Blocs de code LilyPond</a></li>
    <li><a name="toc-Fonctions-Scheme-1" href="#scheme-functions">2.2 Fonctions Scheme</a>
    <ul class="toc">
      <li><a name="toc-Definition-de-fonctions-Scheme" href="#scheme-function-definitions">2.2.1 Définition de fonctions Scheme</a></li>
      <li><a name="toc-Utilisation-de-fonctions-Scheme-1" href="#scheme-function-usage">2.2.2 Utilisation de fonctions Scheme</a></li>
      <li><a name="toc-Fonctions-Scheme-fantomes" href="#void-scheme-functions">2.2.3 Fonctions Scheme fantômes</a></li>
    </ul></li>
    <li><a name="toc-Fonctions-musicales-1" href="#music-functions">2.3 Fonctions musicales</a>
    <ul class="toc">
      <li><a name="toc-Definition-de-fonctions-musicales" href="#music-function-definitions">2.3.1 Définition de fonctions musicales</a></li>
      <li><a name="toc-Utilisation-de-fonctions-musicales-1" href="#music-function-usage">2.3.2 Utilisation de fonctions musicales</a></li>
      <li><a name="toc-Fonctions-de-substitution-simple-1" href="#simple-substitution-functions">2.3.3 Fonctions de substitution simple</a></li>
      <li><a name="toc-Fonctions-de-substitution-intermediaires" href="#intermediate-substitution-functions">2.3.4 Fonctions de substitution intermédiaires</a></li>
      <li><a name="toc-De-l_0027usage-des-mathematiques-dans-les-fonctions" href="#mathematics-in-functions">2.3.5 De l&rsquo;usage des mathématiques dans les fonctions</a></li>
      <li><a name="toc-Fonctions-depourvues-d_0027argument" href="#functions-without-arguments">2.3.6 Fonctions dépourvues d&rsquo;argument</a></li>
      <li><a name="toc-Fonctions-musicales-fantomes" href="#void-music-functions">2.3.7 Fonctions musicales fantômes</a></li>
    </ul></li>
    <li><a name="toc-Fonctions-evenementielles" href="#event-functions">2.4 Fonctions événementielles</a></li>
    <li><a name="toc-Fonctions-pour-markups-1" href="#markup-functions">2.5 Fonctions pour <em>markups</em></a>
    <ul class="toc">
      <li><a name="toc-Construction-d_0027un-markup-en-Scheme-1" href="#markup-construction-in-scheme">2.5.1 Construction d&rsquo;un <em>markup</em> en Scheme</a></li>
      <li><a name="toc-Fonctionnement-interne-des-markups-1" href="#how-markups-work-internally">2.5.2 Fonctionnement interne des <em>markups</em></a></li>
      <li><a name="toc-Definition-d_0027une-nouvelle-commande-de-markup" href="#new-markup-command-definition">2.5.3 Définition d&rsquo;une nouvelle commande de <em>markup</em></a>
      <ul class="toc">
        <li><a name="toc-Syntaxe-d_0027une-commande-markup-1" href="#markup-command-definition-syntax">Syntaxe d&rsquo;une commande <em>markup</em></a></li>
        <li><a name="toc-Attribution-de-proprietes" href="#on-properties">Attribution de propriétés</a></li>
        <li><a name="toc-Exemple-commente" href="#a-complete-example">Exemple commenté</a></li>
        <li><a name="toc-Adaptation-d_0027une-commande-incorporee" href="#adapting-builtin-commands">Adaptation d&rsquo;une commande incorporée</a></li>
      </ul></li>
      <li><a name="toc-Definition-d_0027une-nouvelle-commande-de-liste-de-markups" href="#new-markup-list-command-definition">2.5.4 Définition d&rsquo;une nouvelle commande de liste de <em>markups</em></a></li>
    </ul></li>
    <li><a name="toc-Contextes-pour-programmeurs-1" href="#contexts-for-programmers">2.6 Contextes pour programmeurs</a>
    <ul class="toc">
      <li><a name="toc-Evaluation-d_0027un-contexte" href="#context-evaluation">2.6.1 Évaluation d&rsquo;un contexte</a></li>
      <li><a name="toc-Application-d_0027une-fonction-a-tous-les-objets-de-mise-en-forme" href="#running-a-function-on-all-layout-objects">2.6.2 Application d&rsquo;une fonction à tous les objets de mise en forme</a></li>
    </ul></li>
    <li><a name="toc-Fonctions-de-rappel-1" href="#callback-functions">2.7 Fonctions de rappel</a></li>
    <li><a name="toc-Retouches-complexes-1" href="#difficult-tweaks">2.8 Retouches complexes</a></li>
  </ul></li>
  <li><a name="toc-Interfaces-LilyPond-Scheme-1" href="#lilypond-scheme-interfaces">3. Interfaces LilyPond Scheme</a></li>
  <li><a name="toc-GNU-Free-Documentation-License-1" href="#gnu-free-documentation-license">A. GNU Free Documentation License</a></li>
  <li><a name="toc-Index-de-LilyPond-1" href="#lilypond-index">B. Index de LilyPond</a></li>
</ul>
</div>
<hr size="1">
<a name="SEC_About"></a>
<table class="nav_table">
<tr><td valign="middle" align="center" colspan="3">[<a href="#index" title="Couverture (top) du document" rel="start">Racine</a>][<a href="#SEC_Contents" title="Table des mati&egrave;res" rel="contents">Table des mati&egrave;res</a>][<a href="#lilypond-index" title="Index" rel="index">Index</a>][<a href="#SEC_About" title="A propos (page d&rsquo;aide)" rel="help"> ? </a>]</td></tr></table>
<h1>A propos de ce document</h1>
<p>
  Ce document a &eacute;t&eacute; g&eacute;n&eacute;r&eacute; le <em>le 6 ao&ucirc;t 2017</em> par <em>GUB</em> en utilisant <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
</p>
<p>
  Les boutons de navigation ont la signification suivante :
</p>
<table border="1">
  <tr>
    <th> Bouton </th>
    <th> Nom </th>
    <th> Aller &agrave; </th>
    <th> Depuis 1.2.3 aller &agrave;</th>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [ &lt;&lt; ] </td>
    <td align="center">RetourRapide</td>
    <td>D&eacute;but de ce chapitre ou chapitre pr&eacute;c&eacute;dent</td>
    <td>1</td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [Racine] </td>
    <td align="center">Racine</td>
    <td>Couverture (top) du document</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Table des mati&egrave;res] </td>
    <td align="center">Table des mati&egrave;res</td>
    <td>Table des mati&egrave;res</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Index] </td>
    <td align="center">Index</td>
    <td>Index</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [ ? ] </td>
    <td align="center">A propos</td>
    <td>A propos (page d&rsquo;aide)</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [ &gt;&gt; ] </td>
    <td align="center">AvanceRapide</td>
    <td>Chapitre suivant</td>
    <td>2</td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [ &lt; ] </td>
    <td align="center">Retour</td>
    <td>Section pr&eacute;c&eacute;dente dans l&rsquo;ordre de lecture</td>
    <td>1.2.2</td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [Plus haut] </td>
    <td align="center">Monter</td>
    <td>Section sup&eacute;rieure</td>
    <td>1.2</td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [ &gt; ] </td>
    <td align="center">Avant</td>
    <td>Section suivante dans l&rsquo;ordre de lecture</td>
    <td>1.2.4</td>
  </tr>
</table>

<p>
  Dans cet exemple on est &agrave; <strong> Sous sous section un-deux-trois </strong> dans un document dont la structure est :
</p>

<ul>
  <li> 1. Section un
    <ul>
      <li>1.1 Sous section un-un
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.2 Sous section un-deux
        <ul>
          <li>1.2.1 Sous sous section un-deux-un</li>
          <li>1.2.2 Sous sous section un-deux-deux</li>
          <li>1.2.3 Sous sous section un-deux-trois &nbsp; &nbsp;
            <strong>&lt;== Position </strong></li>
          <li>1.2.4 Sous sous section un-deux-quatre</li>
        </ul>
      </li>
      <li>1.3 Sous section un-trois
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.4 Sous section un-quatre</li>
    </ul>
  </li>
</ul>

<hr size="1">
<!-- footer_tag -->
<div class="footer">
<!-- This footer was autogenerated by /home/gub/NewGub/gub/target/linux-x86/build/lilypond-git.sv.gnu.org--lilypond.git-release-unstable/scripts/build/out/www_post -->
<p class="footer_version">
Cette page documente LilyPond-2.19.65 (branche de développement).
</p>
<p class="footer_report">
Vos <a href="http://lilypond.org/help-us.html">suggestions</a> sont les bienvenues ; signalez tout bogue en français à la <a href="http://n2.nabble.com/LilyPond-French-Users-f1298960.html">liste francophone des utilisateurs</a> ou en anglais à la <a href="http://post.gmane.org/post.php?group=gmane.comp.gnu.lilypond.bugs">liste des utilisateurs</a>.
</p>
</div>


<p id="languages">
<!-- These links were autogenerated by /home/gub/NewGub/gub/target/linux-x86/build/lilypond-git.sv.gnu.org--lilypond.git-release-unstable/scripts/build/out/www_post -->
 Autres langues&nbsp;: <a href="extending-big-page.html">English</a>, <a href="extending-big-page.de.html">deutsch</a>, <a href="extending-big-page.es.html">español</a>.
 <br>
 About <a href="http://www.lilypond.org/website/misc/browser-language">automatic language selection</a>.
</p>

<!-- FOOTER -->

<!-- end div#main here -->
</div>



<div id="tocframe">
<p class="toc_uplink"><a href="../Documentation/web/manuals.fr.html"
         title="Documentation Index">&lt;&lt; Retour à l'accueil de la documentation</a></p>
<h4 class="toc_header"> <a href="#index" title="Start of the manual">LilyPond &mdash; Extension des fonctionnalités  v2.19.65 (branche de développement). </a></h4>
<div class="contents">
<ul class="toc">
  <li class=""><a name="toc-Tutoriel-Scheme-1" href="extending-big-page.fr.html#tutoriel-scheme">1. Tutoriel Scheme</a>
  <ul class="toc">
    <li class=""><a name="toc-Introduction-a-Scheme" href="extending-big-page.fr.html#introduction-to-scheme">1.1 Introduction à Scheme</a>    </li>
    <li class=""><a name="toc-Scheme-et-LilyPond-1" href="extending-big-page.fr.html#scheme-in-lilypond">1.2 Scheme et LilyPond</a>    </li>
    <li class=""><a name="toc-Construction-de-fonctions-complexes-1" href="extending-big-page.fr.html#building-complicated-functions">1.3 Construction de fonctions complexes</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Interfaces-pour-programmeurs-1" href="extending-big-page.fr.html#interfaces-for-programmers">2. Interfaces pour programmeurs</a>
  <ul class="toc">
    <li class=""><a name="toc-Blocs-de-code-LilyPond-1" href="extending-big-page.fr.html#lilypond-code-blocks">2.1 Blocs de code LilyPond</a>    </li>
    <li class=""><a name="toc-Fonctions-Scheme-1" href="extending-big-page.fr.html#scheme-functions">2.2 Fonctions Scheme</a>    </li>
    <li class=""><a name="toc-Fonctions-musicales-1" href="extending-big-page.fr.html#music-functions">2.3 Fonctions musicales</a>    </li>
    <li class=""><a name="toc-Fonctions-evenementielles" href="extending-big-page.fr.html#event-functions">2.4 Fonctions événementielles</a>    </li>
    <li class=""><a name="toc-Fonctions-pour-markups-1" href="extending-big-page.fr.html#markup-functions">2.5 Fonctions pour <em>markups</em></a>    </li>
    <li class=""><a name="toc-Contextes-pour-programmeurs-1" href="extending-big-page.fr.html#contexts-for-programmers">2.6 Contextes pour programmeurs</a>    </li>
    <li class=""><a name="toc-Fonctions-de-rappel-1" href="extending-big-page.fr.html#callback-functions">2.7 Fonctions de rappel</a>    </li>
    <li class=""><a name="toc-Retouches-complexes-1" href="extending-big-page.fr.html#difficult-tweaks">2.8 Retouches complexes</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Interfaces-LilyPond-Scheme-1" href="extending-big-page.fr.html#lilypond-scheme-interfaces">3. Interfaces LilyPond Scheme</a>  </li>
  <li class=""><a name="toc-GNU-Free-Documentation-License-1" href="extending-big-page.fr.html#gnu-free-documentation-license">A. GNU Free Documentation License</a>  </li>
  <li class=""><a name="toc-Index-de-LilyPond-1" href="extending-big-page.fr.html#lilypond-index">B. Index de LilyPond</a>  </li>
<li>
<!--
    Translation of GIT committish: febe2e4ff91dda9227e85274ae045e23c6b4ec28

    When revising a translation, copy the HEAD committish of the
    version that you are working on.  See TRANSLATION for details.
-->

<!--
we depend on an external entity here, which we cannot control.  Suppose
we go from 2.15.x to 2.17.x and put the documentation under "v2.17".
For some time, Google won't have the new location in its index, so the
search would get nothing.  It would be better to keep "v2.15" in the
search for a while and have a redirection from "v2.15" to "v2.17".
-->

<form action="http://google.com/search"
      method="get"
      name="search"
      onSubmit="search.q.value='site:lilypond.org/doc/v2.19 '
		+ search.brute_query.value"
      onMouseMove="search.q.value='site:lilypond.org/doc/v2.19 '
		   + search.brute_query.value"
      onKeyUp="search.q.value='site:lilypond.org/doc/v2.19 '
	       + search.brute_query.value">
  <input type="hidden" name="btnG" value="Recherche sur Google">
  <input type="text" name="brute_query" onfocus="this.value=''" value="Rechercher">
  <input type="hidden" name="q" value="">
</form>
</li>
</ul>
</div>
</div>

</body>
</html>
